var pe=Object.defineProperty;var ye=(n,e,t)=>e in n?pe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var w=(n,e,t)=>ye(n,typeof e!="symbol"?e+"":e,t);import{c as commonjsGlobal,g as getDefaultExportFromCjs}from"./react-vendor-BR7QfZNm.js";var scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(k,N){var U=k.length;k.push(N);e:for(;0<U;){var P=U-1>>>1,F=k[P];if(0<s(F,N))k[P]=N,k[U]=F,U=P;else break e}}function t(k){return k.length===0?null:k[0]}function r(k){if(k.length===0)return null;var N=k[0],U=k.pop();if(U!==N){k[0]=U;e:for(var P=0,F=k.length,D=F>>>1;P<D;){var j=2*(P+1)-1,V=k[j],K=j+1,z=k[K];if(0>s(V,U))K<F&&0>s(z,V)?(k[P]=z,k[K]=U,P=K):(k[P]=V,k[j]=U,P=j);else if(K<F&&0>s(z,U))k[P]=z,k[K]=U,P=K;else break e}}return N}function s(k,N){var U=k.sortIndex-N.sortIndex;return U!==0?U:k.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var a=Date,c=a.now();n.unstable_now=function(){return a.now()-c}}var l=[],u=[],f=1,h=null,p=3,g=!1,y=!1,m=!1,b=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I(k){for(var N=t(u);N!==null;){if(N.callback===null)r(u);else if(N.startTime<=k)r(u),N.sortIndex=N.expirationTime,e(l,N);else break;N=t(u)}}function O(k){if(m=!1,I(k),!y)if(t(l)!==null)y=!0,E(M);else{var N=t(u);N!==null&&C(O,N.startTime-k)}}function M(k,N){y=!1,m&&(m=!1,v(B),B=-1),g=!0;var U=p;try{for(I(N),h=t(l);h!==null&&(!(h.expirationTime>N)||k&&!x());){var P=h.callback;if(typeof P=="function"){h.callback=null,p=h.priorityLevel;var F=P(h.expirationTime<=N);N=n.unstable_now(),typeof F=="function"?h.callback=F:h===t(l)&&r(l),I(N)}else r(l);h=t(l)}if(h!==null)var D=!0;else{var j=t(u);j!==null&&C(O,j.startTime-N),D=!1}return D}finally{h=null,p=U,g=!1}}var L=!1,T=null,B=-1,H=5,q=-1;function x(){return!(n.unstable_now()-q<H)}function S(){if(T!==null){var k=n.unstable_now();q=k;var N=!0;try{N=T(!0,k)}finally{N?A():(L=!1,T=null)}}else L=!1}var A;if(typeof $=="function")A=function(){$(S)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,_=R.port2;R.port1.onmessage=S,A=function(){_.postMessage(null)}}else A=function(){b(S,0)};function E(k){T=k,L||(L=!0,A())}function C(k,N){B=b(function(){k(n.unstable_now())},N)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_continueExecution=function(){y||g||(y=!0,E(M))},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(k){switch(p){case 1:case 2:case 3:var N=3;break;default:N=p}var U=p;p=N;try{return k()}finally{p=U}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(k,N){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var U=p;p=k;try{return N()}finally{p=U}},n.unstable_scheduleCallback=function(k,N,U){var P=n.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?P+U:P):U=P,k){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=U+F,k={id:f++,callback:N,priorityLevel:k,startTime:U,expirationTime:F,sortIndex:-1},U>P?(k.sortIndex=U,e(u,k),t(l)===null&&k===t(u)&&(m?(v(B),B=-1):m=!0,C(O,U-P))):(k.sortIndex=F,e(l,k),y||g||(y=!0,E(M))),k},n.unstable_shouldYield=x,n.unstable_wrapCallback=function(k){var N=p;return function(){var U=p;p=N;try{return k.apply(this,arguments)}finally{p=U}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;const consoleLogger={type:"logger",log(n){this.output("log",n)},warn(n){this.output("warn",n)},error(n){this.output("error",n)},output(n,e){console&&console[n]&&console[n].apply(console,e)}};class Logger{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||consoleLogger,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,r,s){return s&&!this.debug?null:(typeof e[0]=="string"&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new Logger(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Logger(this.logger,e)}}var baseLogger=new Logger;let EventEmitter$1=class{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const s=this.observers[r].get(t)||0;this.observers[r].set(t,s+1)}),this}off(e,t){if(this.observers[e]){if(!t){delete this.observers[e];return}this.observers[e].delete(t)}}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(a=>{let[c,l]=a;for(let u=0;u<l;u++)c(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(a=>{let[c,l]=a;for(let u=0;u<l;u++)c.apply(c,[e,...r])})}};const defer=()=>{let n,e;const t=new Promise((r,s)=>{n=r,e=s});return t.resolve=n,t.reject=e,t},makeString=n=>n==null?"":""+n,copy=(n,e,t)=>{n.forEach(r=>{e[r]&&(t[r]=e[r])})},lastOfPathSeparatorRegExp=/###/g,cleanKey=n=>n&&n.indexOf("###")>-1?n.replace(lastOfPathSeparatorRegExp,"."):n,canNotTraverseDeeper=n=>!n||typeof n=="string",getLastOfPath=(n,e,t)=>{const r=typeof e!="string"?e:e.split(".");let s=0;for(;s<r.length-1;){if(canNotTraverseDeeper(n))return{};const o=cleanKey(r[s]);!n[o]&&t&&(n[o]=new t),Object.prototype.hasOwnProperty.call(n,o)?n=n[o]:n={},++s}return canNotTraverseDeeper(n)?{}:{obj:n,k:cleanKey(r[s])}},setPath=(n,e,t)=>{const{obj:r,k:s}=getLastOfPath(n,e,Object);if(r!==void 0||e.length===1){r[s]=t;return}let o=e[e.length-1],a=e.slice(0,e.length-1),c=getLastOfPath(n,a,Object);for(;c.obj===void 0&&a.length;)o=`${a[a.length-1]}.${o}`,a=a.slice(0,a.length-1),c=getLastOfPath(n,a,Object),c&&c.obj&&typeof c.obj[`${c.k}.${o}`]<"u"&&(c.obj=void 0);c.obj[`${c.k}.${o}`]=t},pushPath=(n,e,t,r)=>{const{obj:s,k:o}=getLastOfPath(n,e,Object);s[o]=s[o]||[],s[o].push(t)},getPath=(n,e)=>{const{obj:t,k:r}=getLastOfPath(n,e);if(t)return t[r]},getPathWithDefaults=(n,e,t)=>{const r=getPath(n,t);return r!==void 0?r:getPath(e,t)},deepExtend=(n,e,t)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in n?typeof n[r]=="string"||n[r]instanceof String||typeof e[r]=="string"||e[r]instanceof String?t&&(n[r]=e[r]):deepExtend(n[r],e[r],t):n[r]=e[r]);return n},regexEscape=n=>n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var _entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const escape=n=>typeof n=="string"?n.replace(/[&<>"'\/]/g,e=>_entityMap[e]):n;class RegExpCache{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(t!==void 0)return t;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const chars=[" ",",","?","!",";"],looksLikeObjectPathRegExpCache=new RegExpCache(20),looksLikeObjectPath=(n,e,t)=>{e=e||"",t=t||"";const r=chars.filter(a=>e.indexOf(a)<0&&t.indexOf(a)<0);if(r.length===0)return!0;const s=looksLikeObjectPathRegExpCache.getRegExp(`(${r.map(a=>a==="?"?"\\?":a).join("|")})`);let o=!s.test(n);if(!o){const a=n.indexOf(t);a>0&&!s.test(n.substring(0,a))&&(o=!0)}return o},deepFind=function(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!n)return;if(n[e])return n[e];const r=e.split(t);let s=n;for(let o=0;o<r.length;){if(!s||typeof s!="object")return;let a,c="";for(let l=o;l<r.length;++l)if(l!==o&&(c+=t),c+=r[l],a=s[c],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&l<r.length-1)continue;o+=l-o+1;break}s=a}return s},getCleanedCode=n=>n&&n.replace("_","-");class ResourceStore extends EventEmitter$1{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator,a=s.ignoreJSONStructure!==void 0?s.ignoreJSONStructure:this.options.ignoreJSONStructure;let c;e.indexOf(".")>-1?c=e.split("."):(c=[e,t],r&&(Array.isArray(r)?c.push(...r):typeof r=="string"&&o?c.push(...r.split(o)):c.push(r)));const l=getPath(this.data,c);return!l&&!t&&!r&&e.indexOf(".")>-1&&(e=c[0],t=c[1],r=c.slice(2).join(".")),l||!a||typeof r!="string"?l:deepFind(this.data&&this.data[e]&&this.data[e][t],r,o)}addResource(e,t,r,s){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const a=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator;let c=[e,t];r&&(c=c.concat(a?r.split(a):r)),e.indexOf(".")>-1&&(c=e.split("."),s=t,t=c[1]),this.addNamespaces(t),setPath(this.data,c,s),o.silent||this.emit("added",e,t,r,s)}addResources(e,t,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const o in r)(typeof r[o]=="string"||Array.isArray(r[o]))&&this.addResource(e,t,o,r[o],{silent:!0});s.silent||this.emit("added",e,t,r)}addResourceBundle(e,t,r,s,o){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},c=[e,t];e.indexOf(".")>-1&&(c=e.split("."),s=r,r=t,t=c[1]),this.addNamespaces(t);let l=getPath(this.data,c)||{};a.skipCopy||(r=JSON.parse(JSON.stringify(r))),s?deepExtend(l,r,o):l={...l,...r},setPath(this.data,c,l),a.silent||this.emit("added",e,t,r)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return this.getResource(e,t)!==void 0}getResourceBundle(e,t){return t||(t=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find(s=>t[s]&&Object.keys(t[s]).length>0)}toJSON(){return this.data}}var postProcessor={processors:{},addPostProcessor(n){this.processors[n.name]=n},handle(n,e,t,r,s){return n.forEach(o=>{this.processors[o]&&(e=this.processors[o].process(e,t,r,s))}),e}};const checkedLoadedFor={};class Translator extends EventEmitter$1{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),copy(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=t,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=baseLogger.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const r=this.resolve(e,t);return r&&r.res!==void 0}extractFromKey(e,t){let r=t.nsSeparator!==void 0?t.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const s=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator;let o=t.ns||this.options.defaultNS||[];const a=r&&e.indexOf(r)>-1,c=!this.options.userDefinedKeySeparator&&!t.keySeparator&&!this.options.userDefinedNsSeparator&&!t.nsSeparator&&!looksLikeObjectPath(e,r,s);if(a&&!c){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:o};const u=e.split(r);(r!==s||r===s&&this.options.ns.indexOf(u[0])>-1)&&(o=u.shift()),e=u.join(s)}return typeof o=="string"&&(o=[o]),{key:e,namespaces:o}}translate(e,t,r){if(typeof t!="object"&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),typeof t=="object"&&(t={...t}),t||(t={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const s=t.returnDetails!==void 0?t.returnDetails:this.options.returnDetails,o=t.keySeparator!==void 0?t.keySeparator:this.options.keySeparator,{key:a,namespaces:c}=this.extractFromKey(e[e.length-1],t),l=c[c.length-1],u=t.lng||this.language,f=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(u&&u.toLowerCase()==="cimode"){if(f){const O=t.nsSeparator||this.options.nsSeparator;return s?{res:`${l}${O}${a}`,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:`${l}${O}${a}`}return s?{res:a,usedKey:a,exactUsedKey:a,usedLng:u,usedNS:l,usedParams:this.getUsedParamsDetails(t)}:a}const h=this.resolve(e,t);let p=h&&h.res;const g=h&&h.usedKey||a,y=h&&h.exactUsedKey||a,m=Object.prototype.toString.apply(p),b=["[object Number]","[object Function]","[object RegExp]"],v=t.joinArrays!==void 0?t.joinArrays:this.options.joinArrays,$=!this.i18nFormat||this.i18nFormat.handleAsObject;if($&&p&&(typeof p!="string"&&typeof p!="boolean"&&typeof p!="number")&&b.indexOf(m)<0&&!(typeof v=="string"&&Array.isArray(p))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const O=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,p,{...t,ns:c}):`key '${a} (${this.language})' returned an object instead of string.`;return s?(h.res=O,h.usedParams=this.getUsedParamsDetails(t),h):O}if(o){const O=Array.isArray(p),M=O?[]:{},L=O?y:g;for(const T in p)if(Object.prototype.hasOwnProperty.call(p,T)){const B=`${L}${o}${T}`;M[T]=this.translate(B,{...t,joinArrays:!1,ns:c}),M[T]===B&&(M[T]=p[T])}p=M}}else if($&&typeof v=="string"&&Array.isArray(p))p=p.join(v),p&&(p=this.extendTranslation(p,e,t,r));else{let O=!1,M=!1;const L=t.count!==void 0&&typeof t.count!="string",T=Translator.hasDefaultValue(t),B=L?this.pluralResolver.getSuffix(u,t.count,t):"",H=t.ordinal&&L?this.pluralResolver.getSuffix(u,t.count,{ordinal:!1}):"",q=L&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),x=q&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${B}`]||t[`defaultValue${H}`]||t.defaultValue;!this.isValidLookup(p)&&T&&(O=!0,p=x),this.isValidLookup(p)||(M=!0,p=a);const A=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&M?void 0:p,R=T&&x!==p&&this.options.updateMissing;if(M||O||R){if(this.logger.log(R?"updateKey":"missingKey",u,l,a,R?x:p),o){const k=this.resolve(a,{...t,keySeparator:!1});k&&k.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let _=[];const E=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if(this.options.saveMissingTo==="fallback"&&E&&E[0])for(let k=0;k<E.length;k++)_.push(E[k]);else this.options.saveMissingTo==="all"?_=this.languageUtils.toResolveHierarchy(t.lng||this.language):_.push(t.lng||this.language);const C=(k,N,U)=>{const P=T&&U!==p?U:A;this.options.missingKeyHandler?this.options.missingKeyHandler(k,l,N,P,R,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(k,l,N,P,R,t),this.emit("missingKey",k,l,N,p)};this.options.saveMissing&&(this.options.saveMissingPlurals&&L?_.forEach(k=>{const N=this.pluralResolver.getSuffixes(k,t);q&&t[`defaultValue${this.options.pluralSeparator}zero`]&&N.indexOf(`${this.options.pluralSeparator}zero`)<0&&N.push(`${this.options.pluralSeparator}zero`),N.forEach(U=>{C([k],a+U,t[`defaultValue${U}`]||x)})}):C(_,a,x))}p=this.extendTranslation(p,e,t,h,r),M&&p===a&&this.options.appendNamespaceToMissingKey&&(p=`${l}:${a}`),(M||O)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?p=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${a}`:a,O?p:void 0):p=this.options.parseMissingKeyHandler(p))}return s?(h.res=p,h.usedParams=this.getUsedParamsDetails(t),h):p}extendTranslation(e,t,r,s,o){var a=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||s.usedLng,s.usedNS,s.usedKey,{resolved:s});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const u=typeof e=="string"&&(r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let f;if(u){const p=e.match(this.interpolator.nestingRegexp);f=p&&p.length}let h=r.replace&&typeof r.replace!="string"?r.replace:r;if(this.options.interpolation.defaultVariables&&(h={...this.options.interpolation.defaultVariables,...h}),e=this.interpolator.interpolate(e,h,r.lng||this.language||s.usedLng,r),u){const p=e.match(this.interpolator.nestingRegexp),g=p&&p.length;f<g&&(r.nest=!1)}!r.lng&&this.options.compatibilityAPI!=="v1"&&s&&s.res&&(r.lng=this.language||s.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var p=arguments.length,g=new Array(p),y=0;y<p;y++)g[y]=arguments[y];return o&&o[0]===g[0]&&!r.context?(a.logger.warn(`It seems you are nesting recursively key: ${g[0]} in key: ${t[0]}`),null):a.translate(...g,t)},r)),r.interpolation&&this.interpolator.reset()}const c=r.postProcess||this.options.postProcess,l=typeof c=="string"?[c]:c;return e!=null&&l&&l.length&&r.applyPostProcessor!==!1&&(e=postProcessor.handle(l,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...s,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r,s,o,a,c;return typeof e=="string"&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(r))return;const u=this.extractFromKey(l,t),f=u.key;s=f;let h=u.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));const p=t.count!==void 0&&typeof t.count!="string",g=p&&!t.ordinal&&t.count===0&&this.pluralResolver.shouldUseIntlApi(),y=t.context!==void 0&&(typeof t.context=="string"||typeof t.context=="number")&&t.context!=="",m=t.lngs?t.lngs:this.languageUtils.toResolveHierarchy(t.lng||this.language,t.fallbackLng);h.forEach(b=>{this.isValidLookup(r)||(c=b,!checkedLoadedFor[`${m[0]}-${b}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(c)&&(checkedLoadedFor[`${m[0]}-${b}`]=!0,this.logger.warn(`key "${s}" for languages "${m.join(", ")}" won't get resolved as namespace "${c}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),m.forEach(v=>{if(this.isValidLookup(r))return;a=v;const $=[f];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys($,f,v,b,t);else{let O;p&&(O=this.pluralResolver.getSuffix(v,t.count,t));const M=`${this.options.pluralSeparator}zero`,L=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(p&&($.push(f+O),t.ordinal&&O.indexOf(L)===0&&$.push(f+O.replace(L,this.options.pluralSeparator)),g&&$.push(f+M)),y){const T=`${f}${this.options.contextSeparator}${t.context}`;$.push(T),p&&($.push(T+O),t.ordinal&&O.indexOf(L)===0&&$.push(T+O.replace(L,this.options.pluralSeparator)),g&&$.push(T+M))}}let I;for(;I=$.pop();)this.isValidLookup(r)||(o=I,r=this.getResource(v,b,I,t))}))})}),{res:r,usedKey:s,exactUsedKey:o,usedLng:a,usedNS:c}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,t,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,r,s):this.resourceStore.getResource(e,t,r,s)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&typeof e.replace!="string";let s=r?e.replace:e;if(r&&typeof e.count<"u"&&(s.count=e.count),this.options.interpolation.defaultVariables&&(s={...this.options.interpolation.defaultVariables,...s}),!r){s={...s};for(const o of t)delete s[o]}return s}static hasDefaultValue(e){const t="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,t.length)&&e[r]!==void 0)return!0;return!1}}const capitalize=n=>n.charAt(0).toUpperCase()+n.slice(1);class LanguageUtil{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=baseLogger.create("languageUtils")}getScriptPartFromCode(e){if(e=getCleanedCode(e),!e||e.indexOf("-")<0)return null;const t=e.split("-");return t.length===2||(t.pop(),t[t.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(t.join("-"))}getLanguagePartFromCode(e){if(e=getCleanedCode(e),!e||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if(typeof e=="string"&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let s=Intl.getCanonicalLocales(e)[0];if(s&&this.options.lowerCaseLng&&(s=s.toLowerCase()),s)return s}catch{}const t=["hans","hant","latn","cyrl","cans","mong","arab"];let r=e.split("-");return this.options.lowerCaseLng?r=r.map(s=>s.toLowerCase()):r.length===2?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=capitalize(r[1].toLowerCase()))):r.length===3&&(r[0]=r[0].toLowerCase(),r[1].length===2&&(r[1]=r[1].toUpperCase()),r[0]!=="sgn"&&r[2].length===2&&(r[2]=r[2].toUpperCase()),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=capitalize(r[1].toLowerCase())),t.indexOf(r[2].toLowerCase())>-1&&(r[2]=capitalize(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach(r=>{if(t)return;const s=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(s))&&(t=s)}),!t&&this.options.supportedLngs&&e.forEach(r=>{if(t)return;const s=this.getLanguagePartFromCode(r);if(this.isSupportedCode(s))return t=s;t=this.options.supportedLngs.find(o=>{if(o===s)return o;if(!(o.indexOf("-")<0&&s.indexOf("-")<0)&&(o.indexOf("-")>0&&s.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===s||o.indexOf(s)===0&&s.length>1))return o})}),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if(typeof e=="function"&&(e=e(t)),typeof e=="string"&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}toResolveHierarchy(e,t){const r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),s=[],o=a=>{a&&(this.isSupportedCode(a)?s.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return typeof e=="string"&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&o(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&o(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&o(this.getLanguagePartFromCode(e))):typeof e=="string"&&o(this.formatLanguageCode(e)),r.forEach(a=>{s.indexOf(a)<0&&o(this.formatLanguageCode(a))}),s}}let sets=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],_rulesPluralsTypes={1:n=>+(n>1),2:n=>+(n!=1),3:n=>0,4:n=>n%10==1&&n%100!=11?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,5:n=>n==0?0:n==1?1:n==2?2:n%100>=3&&n%100<=10?3:n%100>=11?4:5,6:n=>n==1?0:n>=2&&n<=4?1:2,7:n=>n==1?0:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?1:2,8:n=>n==1?0:n==2?1:n!=8&&n!=11?2:3,9:n=>+(n>=2),10:n=>n==1?0:n==2?1:n<7?2:n<11?3:4,11:n=>n==1||n==11?0:n==2||n==12?1:n>2&&n<20?2:3,12:n=>+(n%10!=1||n%100==11),13:n=>+(n!==0),14:n=>n==1?0:n==2?1:n==3?2:3,15:n=>n%10==1&&n%100!=11?0:n%10>=2&&(n%100<10||n%100>=20)?1:2,16:n=>n%10==1&&n%100!=11?0:n!==0?1:2,17:n=>n==1||n%10==1&&n%100!=11?0:1,18:n=>n==0?0:n==1?1:2,19:n=>n==1?0:n==0||n%100>1&&n%100<11?1:n%100>10&&n%100<20?2:3,20:n=>n==1?0:n==0||n%100>0&&n%100<20?1:2,21:n=>n%100==1?1:n%100==2?2:n%100==3||n%100==4?3:0,22:n=>n==1?0:n==2?1:(n<0||n>10)&&n%10==0?2:3};const nonIntlVersions=["v1","v2","v3"],intlVersions=["v4"],suffixesOrder={zero:0,one:1,two:2,few:3,many:4,other:5},createRules=()=>{const n={};return sets.forEach(e=>{e.lngs.forEach(t=>{n[t]={numbers:e.nr,plurals:_rulesPluralsTypes[e.fc]}})}),n};class PluralResolver{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=baseLogger.create("pluralResolver"),(!this.options.compatibilityJSON||intlVersions.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=createRules(),this.pluralRulesCache={}}addRule(e,t){this.rules[e]=t}clearCache(){this.pluralRulesCache={}}getRule(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi())try{const r=getCleanedCode(e==="dev"?"en":e),s=t.ordinal?"ordinal":"cardinal",o=JSON.stringify({cleanedCode:r,type:s});if(o in this.pluralRulesCache)return this.pluralRulesCache[o];const a=new Intl.PluralRules(r,{type:s});return this.pluralRulesCache[o]=a,a}catch{return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.getRule(e,t);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}getPluralFormsOfKey(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,r).map(s=>`${t}${s}`)}getSuffixes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.getRule(e,t);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort((s,o)=>suffixesOrder[s]-suffixesOrder[o]).map(s=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${s}`):r.numbers.map(s=>this.getSuffix(e,s,t)):[]}getSuffix(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=this.getRule(e,r);return s?this.shouldUseIntlApi()?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${s.select(t)}`:this.getSuffixRetroCompatible(s,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const r=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let s=e.numbers[r];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(s===2?s="plural":s===1&&(s=""));const o=()=>this.options.prepend&&s.toString()?this.options.prepend+s.toString():s.toString();return this.options.compatibilityJSON==="v1"?s===1?"":typeof s=="number"?`_plural_${s.toString()}`:o():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?o():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}shouldUseIntlApi(){return!nonIntlVersions.includes(this.options.compatibilityJSON)}}const deepFindWithDefaults=function(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=getPathWithDefaults(n,e,t);return!o&&s&&typeof t=="string"&&(o=deepFind(n,t,r),o===void 0&&(o=deepFind(e,t,r))),o},regexSafe=n=>n.replace(/\$/g,"$$$$");class Interpolator{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=baseLogger.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(t=>t),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:r,useRawValueToEscape:s,prefix:o,prefixEscaped:a,suffix:c,suffixEscaped:l,formatSeparator:u,unescapeSuffix:f,unescapePrefix:h,nestingPrefix:p,nestingPrefixEscaped:g,nestingSuffix:y,nestingSuffixEscaped:m,nestingOptionsSeparator:b,maxReplaces:v,alwaysFormat:$}=e.interpolation;this.escape=t!==void 0?t:escape,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=s!==void 0?s:!1,this.prefix=o?regexEscape(o):a||"{{",this.suffix=c?regexEscape(c):l||"}}",this.formatSeparator=u||",",this.unescapePrefix=f?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":f||"",this.nestingPrefix=p?regexEscape(p):g||regexEscape("$t("),this.nestingSuffix=y?regexEscape(y):m||regexEscape(")"),this.nestingOptionsSeparator=b||",",this.maxReplaces=v||1e3,this.alwaysFormat=$!==void 0?$:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(t,r)=>t&&t.source===r?(t.lastIndex=0,t):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,r,s){let o,a,c;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=g=>{if(g.indexOf(this.formatSeparator)<0){const v=deepFindWithDefaults(t,l,g,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(v,void 0,r,{...s,...t,interpolationkey:g}):v}const y=g.split(this.formatSeparator),m=y.shift().trim(),b=y.join(this.formatSeparator).trim();return this.format(deepFindWithDefaults(t,l,m,this.options.keySeparator,this.options.ignoreJSONStructure),b,r,{...s,...t,interpolationkey:m})};this.resetRegExp();const f=s&&s.missingInterpolationHandler||this.options.missingInterpolationHandler,h=s&&s.interpolation&&s.interpolation.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:g=>regexSafe(g)},{regex:this.regexp,safeValue:g=>this.escapeValue?regexSafe(this.escape(g)):regexSafe(g)}].forEach(g=>{for(c=0;o=g.regex.exec(e);){const y=o[1].trim();if(a=u(y),a===void 0)if(typeof f=="function"){const b=f(e,o,s);a=typeof b=="string"?b:""}else if(s&&Object.prototype.hasOwnProperty.call(s,y))a="";else if(h){a=o[0];continue}else this.logger.warn(`missed to pass in variable ${y} for interpolating ${e}`),a="";else typeof a!="string"&&!this.useRawValueToEscape&&(a=makeString(a));const m=g.safeValue(a);if(e=e.replace(o[0],m),h?(g.regex.lastIndex+=a.length,g.regex.lastIndex-=o[0].length):g.regex.lastIndex=0,c++,c>=this.maxReplaces)break}}),e}nest(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s,o,a;const c=(l,u)=>{const f=this.nestingOptionsSeparator;if(l.indexOf(f)<0)return l;const h=l.split(new RegExp(`${f}[ ]*{`));let p=`{${h[1]}`;l=h[0],p=this.interpolate(p,a);const g=p.match(/'/g),y=p.match(/"/g);(g&&g.length%2===0&&!y||y.length%2!==0)&&(p=p.replace(/'/g,'"'));try{a=JSON.parse(p),u&&(a={...u,...a})}catch(m){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,m),`${l}${f}${p}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,l};for(;s=this.nestingRegexp.exec(e);){let l=[];a={...r},a=a.replace&&typeof a.replace!="string"?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;let u=!1;if(s[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(s[1])){const f=s[1].split(this.formatSeparator).map(h=>h.trim());s[1]=f.shift(),l=f,u=!0}if(o=t(c.call(this,s[1].trim(),a),a),o&&s[0]===e&&typeof o!="string")return o;typeof o!="string"&&(o=makeString(o)),o||(this.logger.warn(`missed to resolve ${s[1]} for nesting ${e}`),o=""),u&&(o=l.reduce((f,h)=>this.format(f,h,r.lng,{...r,interpolationkey:s[1].trim()}),o.trim())),e=e.replace(s[0],o),this.regexp.lastIndex=0}return e}}const parseFormatStr=n=>{let e=n.toLowerCase().trim();const t={};if(n.indexOf("(")>-1){const r=n.split("(");e=r[0].toLowerCase().trim();const s=r[1].substring(0,r[1].length-1);e==="currency"&&s.indexOf(":")<0?t.currency||(t.currency=s.trim()):e==="relativetime"&&s.indexOf(":")<0?t.range||(t.range=s.trim()):s.split(";").forEach(a=>{if(a){const[c,...l]=a.split(":"),u=l.join(":").trim().replace(/^'+|'+$/g,""),f=c.trim();t[f]||(t[f]=u),u==="false"&&(t[f]=!1),u==="true"&&(t[f]=!0),isNaN(u)||(t[f]=parseInt(u,10))}})}return{formatName:e,formatOptions:t}},createCachedFormatter=n=>{const e={};return(t,r,s)=>{let o=s;s&&s.interpolationkey&&s.formatParams&&s.formatParams[s.interpolationkey]&&s[s.interpolationkey]&&(o={...o,[s.interpolationkey]:void 0});const a=r+JSON.stringify(o);let c=e[a];return c||(c=n(getCleanedCode(r),s),e[a]=c),c(t)}};class Formatter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=baseLogger.create("formatter"),this.options=e,this.formats={number:createCachedFormatter((t,r)=>{const s=new Intl.NumberFormat(t,{...r});return o=>s.format(o)}),currency:createCachedFormatter((t,r)=>{const s=new Intl.NumberFormat(t,{...r,style:"currency"});return o=>s.format(o)}),datetime:createCachedFormatter((t,r)=>{const s=new Intl.DateTimeFormat(t,{...r});return o=>s.format(o)}),relativetime:createCachedFormatter((t,r)=>{const s=new Intl.RelativeTimeFormat(t,{...r});return o=>s.format(o,r.range||"day")}),list:createCachedFormatter((t,r)=>{const s=new Intl.ListFormat(t,{...r});return o=>s.format(o)})},this.init(e)}init(e){const r=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=r.formatSeparator?r.formatSeparator:r.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=createCachedFormatter(t)}format(e,t,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const o=t.split(this.formatSeparator);if(o.length>1&&o[0].indexOf("(")>1&&o[0].indexOf(")")<0&&o.find(c=>c.indexOf(")")>-1)){const c=o.findIndex(l=>l.indexOf(")")>-1);o[0]=[o[0],...o.splice(1,c)].join(this.formatSeparator)}return o.reduce((c,l)=>{const{formatName:u,formatOptions:f}=parseFormatStr(l);if(this.formats[u]){let h=c;try{const p=s&&s.formatParams&&s.formatParams[s.interpolationkey]||{},g=p.locale||p.lng||s.locale||s.lng||r;h=this.formats[u](c,g,{...f,...s,...p})}catch(p){this.logger.warn(p)}return h}else this.logger.warn(`there was no format function for ${u}`);return c},e)}}const removePending=(n,e)=>{n.pending[e]!==void 0&&(delete n.pending[e],n.pendingCount--)};class Connector extends EventEmitter$1{constructor(e,t,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=r,this.languageUtils=r.languageUtils,this.options=s,this.logger=baseLogger.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=s.maxParallelReads||10,this.readingCalls=0,this.maxRetries=s.maxRetries>=0?s.maxRetries:5,this.retryTimeout=s.retryTimeout>=1?s.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(r,s.backend,s)}queueLoad(e,t,r,s){const o={},a={},c={},l={};return e.forEach(u=>{let f=!0;t.forEach(h=>{const p=`${u}|${h}`;!r.reload&&this.store.hasResourceBundle(u,h)?this.state[p]=2:this.state[p]<0||(this.state[p]===1?a[p]===void 0&&(a[p]=!0):(this.state[p]=1,f=!1,a[p]===void 0&&(a[p]=!0),o[p]===void 0&&(o[p]=!0),l[h]===void 0&&(l[h]=!0)))}),f||(c[u]=!0)}),(Object.keys(o).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:s}),{toLoad:Object.keys(o),pending:Object.keys(a),toLoadLanguages:Object.keys(c),toLoadNamespaces:Object.keys(l)}}loaded(e,t,r){const s=e.split("|"),o=s[0],a=s[1];t&&this.emit("failedLoading",o,a,t),!t&&r&&this.store.addResourceBundle(o,a,r,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2,t&&r&&(this.state[e]=0);const c={};this.queue.forEach(l=>{pushPath(l.loaded,[o],a),removePending(l,e),t&&l.errors.push(t),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(u=>{c[u]||(c[u]={});const f=l.loaded[u];f.length&&f.forEach(h=>{c[u][h]===void 0&&(c[u][h]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",c),this.queue=this.queue.filter(l=>!l.done)}read(e,t,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:t,fcName:r,tried:s,wait:o,callback:a});return}this.readingCalls++;const c=(u,f)=>{if(this.readingCalls--,this.waitingReads.length>0){const h=this.waitingReads.shift();this.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}if(u&&f&&s<this.maxRetries){setTimeout(()=>{this.read.call(this,e,t,r,s+1,o*2,a)},o);return}a(u,f)},l=this.backend[r].bind(this.backend);if(l.length===2){try{const u=l(e,t);u&&typeof u.then=="function"?u.then(f=>c(null,f)).catch(c):c(null,u)}catch(u){c(u)}return}return l(e,t,c)}prepareLoading(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();typeof e=="string"&&(e=this.languageUtils.toResolveHierarchy(e)),typeof t=="string"&&(t=[t]);const o=this.queueLoad(e,t,r,s);if(!o.toLoad.length)return o.pending.length||s(),null;o.toLoad.forEach(a=>{this.loadOne(a)})}load(e,t,r){this.prepareLoading(e,t,{},r)}reload(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}loadOne(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=e.split("|"),s=r[0],o=r[1];this.read(s,o,"read",void 0,void 0,(a,c)=>{a&&this.logger.warn(`${t}loading namespace ${o} for language ${s} failed`,a),!a&&c&&this.logger.log(`${t}loaded namespace ${o} for language ${s}`,c),this.loaded(e,a,c)})}saveMissing(e,t,r,s,o){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},c=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)){this.logger.warn(`did not save key "${r}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend&&this.backend.create){const l={...a,isUpdate:o},u=this.backend.create.bind(this.backend);if(u.length<6)try{let f;u.length===5?f=u(e,t,r,s,l):f=u(e,t,r,s),f&&typeof f.then=="function"?f.then(h=>c(null,h)).catch(c):c(null,f)}catch(f){c(f)}else u(e,t,r,s,c,l)}!e||!e[0]||this.store.addResource(e[0],t,r,s)}}}const get=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:n=>{let e={};if(typeof n[1]=="object"&&(e=n[1]),typeof n[1]=="string"&&(e.defaultValue=n[1]),typeof n[2]=="string"&&(e.tDescription=n[2]),typeof n[2]=="object"||typeof n[3]=="object"){const t=n[3]||n[2];Object.keys(t).forEach(r=>{e[r]=t[r]})}return e},interpolation:{escapeValue:!0,format:n=>n,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),transformOptions=n=>(typeof n.ns=="string"&&(n.ns=[n.ns]),typeof n.fallbackLng=="string"&&(n.fallbackLng=[n.fallbackLng]),typeof n.fallbackNS=="string"&&(n.fallbackNS=[n.fallbackNS]),n.supportedLngs&&n.supportedLngs.indexOf("cimode")<0&&(n.supportedLngs=n.supportedLngs.concat(["cimode"])),n),noop=()=>{},bindMemberFunctions=n=>{Object.getOwnPropertyNames(Object.getPrototypeOf(n)).forEach(t=>{typeof n[t]=="function"&&(n[t]=n[t].bind(n))})};class I18n extends EventEmitter$1{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(super(),this.options=transformOptions(e),this.services={},this.logger=baseLogger,this.modules={external:[]},bindMemberFunctions(this),t&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,t),this;setTimeout(()=>{this.init(e,t)},0)}}init(){var e=this;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof t=="function"&&(r=t,t={}),!t.defaultNS&&t.defaultNS!==!1&&t.ns&&(typeof t.ns=="string"?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const s=get();this.options={...s,...this.options,...transformOptions(t)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...s.interpolation,...this.options.interpolation}),t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const o=f=>f?typeof f=="function"?new f:f:null;if(!this.options.isClone){this.modules.logger?baseLogger.init(o(this.modules.logger),this.options):baseLogger.init(null,this.options);let f;this.modules.formatter?f=this.modules.formatter:typeof Intl<"u"&&(f=Formatter);const h=new LanguageUtil(this.options);this.store=new ResourceStore(this.options.resources,this.options);const p=this.services;p.logger=baseLogger,p.resourceStore=this.store,p.languageUtils=h,p.pluralResolver=new PluralResolver(h,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),f&&(!this.options.interpolation.format||this.options.interpolation.format===s.interpolation.format)&&(p.formatter=o(f),p.formatter.init(p,this.options),this.options.interpolation.format=p.formatter.format.bind(p.formatter)),p.interpolator=new Interpolator(this.options),p.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},p.backendConnector=new Connector(o(this.modules.backend),p.resourceStore,p,this.options),p.backendConnector.on("*",function(g){for(var y=arguments.length,m=new Array(y>1?y-1:0),b=1;b<y;b++)m[b-1]=arguments[b];e.emit(g,...m)}),this.modules.languageDetector&&(p.languageDetector=o(this.modules.languageDetector),p.languageDetector.init&&p.languageDetector.init(p,this.options.detection,this.options)),this.modules.i18nFormat&&(p.i18nFormat=o(this.modules.i18nFormat),p.i18nFormat.init&&p.i18nFormat.init(this)),this.translator=new Translator(this.services,this.options),this.translator.on("*",function(g){for(var y=arguments.length,m=new Array(y>1?y-1:0),b=1;b<y;b++)m[b-1]=arguments[b];e.emit(g,...m)}),this.modules.external.forEach(g=>{g.init&&g.init(this)})}if(this.format=this.options.interpolation.format,r||(r=noop),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const f=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);f.length>0&&f[0]!=="dev"&&(this.options.lng=f[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(f=>{this[f]=function(){return e.store[f](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(f=>{this[f]=function(){return e.store[f](...arguments),e}});const l=defer(),u=()=>{const f=(h,p)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(p),r(h,p)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return f(null,this.t.bind(this));this.changeLanguage(this.options.lng,f)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),l}loadResources(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:noop;const s=typeof e=="string"?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(s&&s.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const o=[],a=c=>{if(!c||c==="cimode")return;this.services.languageUtils.toResolveHierarchy(c).forEach(u=>{u!=="cimode"&&o.indexOf(u)<0&&o.push(u)})};s?a(s):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>a(l)),this.options.preload&&this.options.preload.forEach(c=>a(c)),this.services.backendConnector.load(o,this.options.ns,c=>{!c&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(c)})}else r(null)}reloadResources(e,t,r){const s=defer();return typeof e=="function"&&(r=e,e=void 0),typeof t=="function"&&(r=t,t=void 0),e||(e=this.languages),t||(t=this.options.ns),r||(r=noop),this.services.backendConnector.reload(e,t,o=>{s.resolve(),r(o)}),s}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&postProcessor.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let t=0;t<this.languages.length;t++){const r=this.languages[t];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}changeLanguage(e,t){var r=this;this.isLanguageChangingTo=e;const s=defer();this.emit("languageChanging",e);const o=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},a=(l,u)=>{u?(o(u),this.translator.changeLanguage(u),this.isLanguageChangingTo=void 0,this.emit("languageChanged",u),this.logger.log("languageChanged",u)):this.isLanguageChangingTo=void 0,s.resolve(function(){return r.t(...arguments)}),t&&t(l,function(){return r.t(...arguments)})},c=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const u=typeof l=="string"?l:this.services.languageUtils.getBestMatchFromCodes(l);u&&(this.language||o(u),this.translator.language||this.translator.changeLanguage(u),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(u)),this.loadResources(u,f=>{a(f,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?c(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(c):this.services.languageDetector.detect(c):c(e),s}getFixedT(e,t,r){var s=this;const o=function(a,c){let l;if(typeof c!="object"){for(var u=arguments.length,f=new Array(u>2?u-2:0),h=2;h<u;h++)f[h-2]=arguments[h];l=s.options.overloadTranslationOptionHandler([a,c].concat(f))}else l={...c};l.lng=l.lng||o.lng,l.lngs=l.lngs||o.lngs,l.ns=l.ns||o.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||r||o.keyPrefix);const p=s.options.keySeparator||".";let g;return l.keyPrefix&&Array.isArray(a)?g=a.map(y=>`${l.keyPrefix}${p}${y}`):g=l.keyPrefix?`${l.keyPrefix}${p}${a}`:a,s.t(g,l)};return typeof e=="string"?o.lng=e:o.lngs=e,o.ns=t,o.keyPrefix=r,o}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=t.lng||this.resolvedLanguage||this.languages[0],s=this.options?this.options.fallbackLng:!1,o=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const a=(c,l)=>{const u=this.services.backendConnector.state[`${c}|${l}`];return u===-1||u===0||u===2};if(t.precheck){const c=t.precheck(this,a);if(c!==void 0)return c}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(r,e)&&(!s||a(o,e)))}loadNamespaces(e,t){const r=defer();return this.options.ns?(typeof e=="string"&&(e=[e]),e.forEach(s=>{this.options.ns.indexOf(s)<0&&this.options.ns.push(s)}),this.loadResources(s=>{r.resolve(),t&&t(s)}),r):(t&&t(),Promise.resolve())}loadLanguages(e,t){const r=defer();typeof e=="string"&&(e=[e]);const s=this.options.preload||[],o=e.filter(a=>s.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return o.length?(this.options.preload=s.concat(o),this.loadResources(a=>{r.resolve(),t&&t(a)}),r):(t&&t(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const t=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services&&this.services.languageUtils||new LanguageUtil(get());return t.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new I18n(e,t)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:noop;const r=e.forkResourceStore;r&&delete e.forkResourceStore;const s={...this.options,...e,isClone:!0},o=new I18n(s);return(e.debug!==void 0||e.prefix!==void 0)&&(o.logger=o.logger.clone(e)),["store","services","language"].forEach(c=>{o[c]=this[c]}),o.services={...this.services},o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},r&&(o.store=new ResourceStore(this.store.data,s),o.services.resourceStore=o.store),o.translator=new Translator(o.services,s),o.translator.on("*",function(c){for(var l=arguments.length,u=new Array(l>1?l-1:0),f=1;f<l;f++)u[f-1]=arguments[f];o.emit(c,...u)}),o.init(s,t),o.translator.options=s,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const instance=I18n.createInstance();instance.createInstance=I18n.createInstance;instance.createInstance;instance.dir;instance.init;instance.loadResources;instance.reloadResources;instance.use;instance.changeLanguage;instance.getFixedT;instance.t;instance.exists;instance.setDefaultNamespace;instance.hasLoadedNamespace;instance.loadNamespaces;instance.loadLanguages;const{slice,forEach}=[];function defaults(n){return forEach.call(slice.call(arguments,1),e=>{if(e)for(const t in e)n[t]===void 0&&(n[t]=e[t])}),n}const fieldContentRegExp=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,serializeCookie=(n,e,t)=>{const r=t||{};r.path=r.path||"/";const s=encodeURIComponent(e);let o=`${n}=${s}`;if(r.maxAge>0){const a=r.maxAge-0;if(Number.isNaN(a))throw new Error("maxAge should be a Number");o+=`; Max-Age=${Math.floor(a)}`}if(r.domain){if(!fieldContentRegExp.test(r.domain))throw new TypeError("option domain is invalid");o+=`; Domain=${r.domain}`}if(r.path){if(!fieldContentRegExp.test(r.path))throw new TypeError("option path is invalid");o+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");o+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(o+="; HttpOnly"),r.secure&&(o+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return o},cookie={create(n,e,t,r){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};t&&(s.expires=new Date,s.expires.setTime(s.expires.getTime()+t*60*1e3)),r&&(s.domain=r),document.cookie=serializeCookie(n,encodeURIComponent(e),s)},read(n){const e=`${n}=`,t=document.cookie.split(";");for(let r=0;r<t.length;r++){let s=t[r];for(;s.charAt(0)===" ";)s=s.substring(1,s.length);if(s.indexOf(e)===0)return s.substring(e.length,s.length)}return null},remove(n){this.create(n,"",-1)}};var cookie$1={name:"cookie",lookup(n){let{lookupCookie:e}=n;if(e&&typeof document<"u")return cookie.read(e)||void 0},cacheUserLanguage(n,e){let{lookupCookie:t,cookieMinutes:r,cookieDomain:s,cookieOptions:o}=e;t&&typeof document<"u"&&cookie.create(t,n,r,s,o)}},querystring={name:"querystring",lookup(n){var r;let{lookupQuerystring:e}=n,t;if(typeof window<"u"){let{search:s}=window.location;!window.location.search&&((r=window.location.hash)==null?void 0:r.indexOf("?"))>-1&&(s=window.location.hash.substring(window.location.hash.indexOf("?")));const a=s.substring(1).split("&");for(let c=0;c<a.length;c++){const l=a[c].indexOf("=");l>0&&a[c].substring(0,l)===e&&(t=a[c].substring(l+1))}}return t}};let hasLocalStorageSupport=null;const localStorageAvailable=()=>{if(hasLocalStorageSupport!==null)return hasLocalStorageSupport;try{hasLocalStorageSupport=window!=="undefined"&&window.localStorage!==null;const n="i18next.translate.boo";window.localStorage.setItem(n,"foo"),window.localStorage.removeItem(n)}catch{hasLocalStorageSupport=!1}return hasLocalStorageSupport};var localStorage$1={name:"localStorage",lookup(n){let{lookupLocalStorage:e}=n;if(e&&localStorageAvailable())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupLocalStorage:t}=e;t&&localStorageAvailable()&&window.localStorage.setItem(t,n)}};let hasSessionStorageSupport=null;const sessionStorageAvailable=()=>{if(hasSessionStorageSupport!==null)return hasSessionStorageSupport;try{hasSessionStorageSupport=window!=="undefined"&&window.sessionStorage!==null;const n="i18next.translate.boo";window.sessionStorage.setItem(n,"foo"),window.sessionStorage.removeItem(n)}catch{hasSessionStorageSupport=!1}return hasSessionStorageSupport};var sessionStorage={name:"sessionStorage",lookup(n){let{lookupSessionStorage:e}=n;if(e&&sessionStorageAvailable())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(n,e){let{lookupSessionStorage:t}=e;t&&sessionStorageAvailable()&&window.sessionStorage.setItem(t,n)}},navigator$1={name:"navigator",lookup(n){const e=[];if(typeof navigator<"u"){const{languages:t,userLanguage:r,language:s}=navigator;if(t)for(let o=0;o<t.length;o++)e.push(t[o]);r&&e.push(r),s&&e.push(s)}return e.length>0?e:void 0}},htmlTag={name:"htmlTag",lookup(n){let{htmlTag:e}=n,t;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(t=r.getAttribute("lang")),t}},path={name:"path",lookup(n){var s;let{lookupFromPathIndex:e}=n;if(typeof window>"u")return;const t=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(t)?(s=t[typeof e=="number"?e:0])==null?void 0:s.replace("/",""):void 0}},subdomain={name:"subdomain",lookup(n){var s,o;let{lookupFromSubdomainIndex:e}=n;const t=typeof e=="number"?e+1:1,r=typeof window<"u"&&((o=(s=window.location)==null?void 0:s.hostname)==null?void 0:o.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(r)return r[t]}};function getDefaults(){return{order:["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"],lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:n=>n}}class Browser{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,t)}init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e||{languageUtils:{}},this.options=defaults(t,this.options||{},getDefaults()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=s=>s.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(cookie$1),this.addDetector(querystring),this.addDetector(localStorage$1),this.addDetector(sessionStorage),this.addDetector(navigator$1),this.addDetector(htmlTag),this.addDetector(path),this.addDetector(subdomain)}addDetector(e){return this.detectors[e.name]=e,this}detect(e){e||(e=this.options.order);let t=[];return e.forEach(r=>{if(this.detectors[r]){let s=this.detectors[r].lookup(this.options);s&&typeof s=="string"&&(s=[s]),s&&(t=t.concat(s))}}),t=t.map(r=>this.options.convertDetectedLanguage(r)),this.services.languageUtils.getBestMatchFromCodes?t:t.length>0?t[0]:null}cacheUserLanguage(e,t){t||(t=this.options.caches),t&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||t.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}Browser.type="languageDetector";function number$3(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`Wrong positive integer: ${n}`)}function bytes$3(n,...e){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(n.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${n.length}`)}function hash$3(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$3(n.outputLen),number$3(n.blockLen)}function exists$2(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function output$2(n,e){bytes$3(n);const t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const crypto$3=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a$2=n=>n instanceof Uint8Array,createView$2=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),rotr$2=(n,e)=>n<<32-e|n>>>e,isLE$2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$2)throw new Error("Non little-endian hardware is not supported");function utf8ToBytes$4(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function toBytes$2(n){if(typeof n=="string"&&(n=utf8ToBytes$4(n)),!u8a$2(n))throw new Error(`expected Uint8Array, got ${typeof n}`);return n}function concatBytes$4(...n){const e=new Uint8Array(n.reduce((r,s)=>r+s.length,0));let t=0;return n.forEach(r=>{if(!u8a$2(r))throw new Error("Uint8Array expected");e.set(r,t),t+=r.length}),e}let Hash$2=class{clone(){return this._cloneInto()}};function wrapConstructor$2(n){const e=r=>n().update(toBytes$2(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function randomBytes$2(n=32){if(crypto$3&&typeof crypto$3.getRandomValues=="function")return crypto$3.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function setBigUint64$2(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),c=Number(t&o),l=r?4:0,u=r?0:4;n.setUint32(e+l,a,r),n.setUint32(e+u,c,r)}let SHA2$1=class extends Hash$2{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$2(this.buffer)}update(e){exists$2(this);const{view:t,buffer:r,blockLen:s}=this;e=toBytes$2(e);const o=e.length;for(let a=0;a<o;){const c=Math.min(s-this.pos,o-a);if(c===s){const l=createView$2(e);for(;s<=o-a;a+=s)this.process(l,a);continue}r.set(e.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists$2(this),output$2(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)t[h]=0;setBigUint64$2(r,s-8,BigInt(this.length*8),o),this.process(r,0);const c=createView$2(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=l/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)c.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:o,destroyed:a,pos:c}=this;return e.length=s,e.pos=c,e.finished=o,e.destroyed=a,s%t&&e.buffer.set(r),e}};const Chi$2=(n,e,t)=>n&e^~n&t,Maj$2=(n,e,t)=>n&e^n&t^e&t,SHA256_K$2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV$1=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$2=new Uint32Array(64);let SHA256$2=class extends SHA2$1{constructor(){super(64,32,8,!1),this.A=IV$1[0]|0,this.B=IV$1[1]|0,this.C=IV$1[2]|0,this.D=IV$1[3]|0,this.E=IV$1[4]|0,this.F=IV$1[5]|0,this.G=IV$1[6]|0,this.H=IV$1[7]|0}get(){const{A:e,B:t,C:r,D:s,E:o,F:a,G:c,H:l}=this;return[e,t,r,s,o,a,c,l]}set(e,t,r,s,o,a,c,l){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=c|0,this.H=l|0}process(e,t){for(let h=0;h<16;h++,t+=4)SHA256_W$2[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=SHA256_W$2[h-15],g=SHA256_W$2[h-2],y=rotr$2(p,7)^rotr$2(p,18)^p>>>3,m=rotr$2(g,17)^rotr$2(g,19)^g>>>10;SHA256_W$2[h]=m+SHA256_W$2[h-7]+y+SHA256_W$2[h-16]|0}let{A:r,B:s,C:o,D:a,E:c,F:l,G:u,H:f}=this;for(let h=0;h<64;h++){const p=rotr$2(c,6)^rotr$2(c,11)^rotr$2(c,25),g=f+p+Chi$2(c,l,u)+SHA256_K$2[h]+SHA256_W$2[h]|0,m=(rotr$2(r,2)^rotr$2(r,13)^rotr$2(r,22))+Maj$2(r,s,o)|0;f=u,u=l,l=c,c=a+g|0,a=o,o=s,s=r,r=g+m|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,c=c+this.E|0,l=l+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,s,o,a,c,l,u,f)}roundClean(){SHA256_W$2.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const sha256$2=wrapConstructor$2(()=>new SHA256$2);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$9=BigInt(0),_1n$9=BigInt(1),_2n$5=BigInt(2),u8a$1=n=>n instanceof Uint8Array,hexes$3=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$3(n){if(!u8a$1(n))throw new Error("Uint8Array expected");let e="";for(let t=0;t<n.length;t++)e+=hexes$3[n[t]];return e}function numberToHexUnpadded$1(n){const e=n.toString(16);return e.length&1?`0${e}`:e}function hexToNumber$1(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}function hexToBytes$3(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let r=0;r<t.length;r++){const s=r*2,o=n.slice(s,s+2),a=Number.parseInt(o,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");t[r]=a}return t}function bytesToNumberBE$1(n){return hexToNumber$1(bytesToHex$3(n))}function bytesToNumberLE$1(n){if(!u8a$1(n))throw new Error("Uint8Array expected");return hexToNumber$1(bytesToHex$3(Uint8Array.from(n).reverse()))}function numberToBytesBE$1(n,e){return hexToBytes$3(n.toString(16).padStart(e*2,"0"))}function numberToBytesLE$1(n,e){return numberToBytesBE$1(n,e).reverse()}function numberToVarBytesBE$1(n){return hexToBytes$3(numberToHexUnpadded$1(n))}function ensureBytes$1(n,e,t){let r;if(typeof e=="string")try{r=hexToBytes$3(e)}catch(o){throw new Error(`${n} must be valid hex string, got "${e}". Cause: ${o}`)}else if(u8a$1(e))r=Uint8Array.from(e);else throw new Error(`${n} must be hex string or Uint8Array`);const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(`${n} expected ${t} bytes, got ${s}`);return r}function concatBytes$3(...n){const e=new Uint8Array(n.reduce((r,s)=>r+s.length,0));let t=0;return n.forEach(r=>{if(!u8a$1(r))throw new Error("Uint8Array expected");e.set(r,t),t+=r.length}),e}function equalBytes$2(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function utf8ToBytes$3(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function bitLen$1(n){let e;for(e=0;n>_0n$9;n>>=_1n$9,e+=1);return e}function bitGet$1(n,e){return n>>BigInt(e)&_1n$9}const bitSet$1=(n,e,t)=>n|(t?_1n$9:_0n$9)<<BigInt(e),bitMask$1=n=>(_2n$5<<BigInt(n-1))-_1n$9,u8n$1=n=>new Uint8Array(n),u8fr$1=n=>Uint8Array.from(n);function createHmacDrbg$1(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=u8n$1(n),s=u8n$1(n),o=0;const a=()=>{r.fill(1),s.fill(0),o=0},c=(...h)=>t(s,r,...h),l=(h=u8n$1())=>{s=c(u8fr$1([0]),h),r=c(),h.length!==0&&(s=c(u8fr$1([1]),h),r=c())},u=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){r=c();const g=r.slice();p.push(g),h+=r.length}return concatBytes$3(...p)};return(h,p)=>{a(),l(h);let g;for(;!(g=p(u()));)l();return a(),g}}const validatorFns$1={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||n instanceof Uint8Array,isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function validateObject$1(n,e,t={}){const r=(s,o,a)=>{const c=validatorFns$1[o];if(typeof c!="function")throw new Error(`Invalid validator "${o}", expected function`);const l=n[s];if(!(a&&l===void 0)&&!c(l,n))throw new Error(`Invalid param ${String(s)}=${l} (${typeof l}), expected ${o}`)};for(const[s,o]of Object.entries(e))r(s,o,!1);for(const[s,o]of Object.entries(t))r(s,o,!0);return n}const ut$1=Object.freeze(Object.defineProperty({__proto__:null,bitGet:bitGet$1,bitLen:bitLen$1,bitMask:bitMask$1,bitSet:bitSet$1,bytesToHex:bytesToHex$3,bytesToNumberBE:bytesToNumberBE$1,bytesToNumberLE:bytesToNumberLE$1,concatBytes:concatBytes$3,createHmacDrbg:createHmacDrbg$1,ensureBytes:ensureBytes$1,equalBytes:equalBytes$2,hexToBytes:hexToBytes$3,hexToNumber:hexToNumber$1,numberToBytesBE:numberToBytesBE$1,numberToBytesLE:numberToBytesLE$1,numberToHexUnpadded:numberToHexUnpadded$1,numberToVarBytesBE:numberToVarBytesBE$1,utf8ToBytes:utf8ToBytes$3,validateObject:validateObject$1},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$8=BigInt(0),_1n$8=BigInt(1),_2n$4=BigInt(2),_3n$3=BigInt(3),_4n$1=BigInt(4),_5n$1=BigInt(5),_8n$1=BigInt(8);BigInt(9);BigInt(16);function mod$1(n,e){const t=n%e;return t>=_0n$8?t:e+t}function pow$1(n,e,t){if(t<=_0n$8||e<_0n$8)throw new Error("Expected power/modulo > 0");if(t===_1n$8)return _0n$8;let r=_1n$8;for(;e>_0n$8;)e&_1n$8&&(r=r*n%t),n=n*n%t,e>>=_1n$8;return r}function pow2$1(n,e,t){let r=n;for(;e-- >_0n$8;)r*=r,r%=t;return r}function invert$1(n,e){if(n===_0n$8||e<=_0n$8)throw new Error(`invert: expected positive integers, got n=${n} mod=${e}`);let t=mod$1(n,e),r=e,s=_0n$8,o=_1n$8;for(;t!==_0n$8;){const c=r/t,l=r%t,u=s-o*c;r=t,t=l,s=o,o=u}if(r!==_1n$8)throw new Error("invert: does not exist");return mod$1(s,e)}function tonelliShanks$1(n){const e=(n-_1n$8)/_2n$4;let t,r,s;for(t=n-_1n$8,r=0;t%_2n$4===_0n$8;t/=_2n$4,r++);for(s=_2n$4;s<n&&pow$1(s,e,n)!==n-_1n$8;s++);if(r===1){const a=(n+_1n$8)/_4n$1;return function(l,u){const f=l.pow(u,a);if(!l.eql(l.sqr(f),u))throw new Error("Cannot find square root");return f}}const o=(t+_1n$8)/_2n$4;return function(c,l){if(c.pow(l,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=r,f=c.pow(c.mul(c.ONE,s),t),h=c.pow(l,o),p=c.pow(l,t);for(;!c.eql(p,c.ONE);){if(c.eql(p,c.ZERO))return c.ZERO;let g=1;for(let m=c.sqr(p);g<u&&!c.eql(m,c.ONE);g++)m=c.sqr(m);const y=c.pow(f,_1n$8<<BigInt(u-g-1));f=c.sqr(y),h=c.mul(h,y),p=c.mul(p,f),u=g}return h}}function FpSqrt$1(n){if(n%_4n$1===_3n$3){const e=(n+_1n$8)/_4n$1;return function(r,s){const o=r.pow(s,e);if(!r.eql(r.sqr(o),s))throw new Error("Cannot find square root");return o}}if(n%_8n$1===_5n$1){const e=(n-_5n$1)/_8n$1;return function(r,s){const o=r.mul(s,_2n$4),a=r.pow(o,e),c=r.mul(s,a),l=r.mul(r.mul(c,_2n$4),a),u=r.mul(c,r.sub(l,r.ONE));if(!r.eql(r.sqr(u),s))throw new Error("Cannot find square root");return u}}return tonelliShanks$1(n)}const FIELD_FIELDS$1=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField$1(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=FIELD_FIELDS$1.reduce((r,s)=>(r[s]="function",r),e);return validateObject$1(n,t)}function FpPow$1(n,e,t){if(t<_0n$8)throw new Error("Expected power > 0");if(t===_0n$8)return n.ONE;if(t===_1n$8)return e;let r=n.ONE,s=e;for(;t>_0n$8;)t&_1n$8&&(r=n.mul(r,s)),s=n.sqr(s),t>>=_1n$8;return r}function FpInvertBatch$1(n,e){const t=new Array(e.length),r=e.reduce((o,a,c)=>n.is0(a)?o:(t[c]=o,n.mul(o,a)),n.ONE),s=n.inv(r);return e.reduceRight((o,a,c)=>n.is0(a)?o:(t[c]=n.mul(o,t[c]),n.mul(o,a)),s),t}function nLength$1(n,e){const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function Field$1(n,e,t=!1,r={}){if(n<=_0n$8)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:s,nByteLength:o}=nLength$1(n,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=FpSqrt$1(n),c=Object.freeze({ORDER:n,BITS:s,BYTES:o,MASK:bitMask$1(s),ZERO:_0n$8,ONE:_1n$8,create:l=>mod$1(l,n),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return _0n$8<=l&&l<n},is0:l=>l===_0n$8,isOdd:l=>(l&_1n$8)===_1n$8,neg:l=>mod$1(-l,n),eql:(l,u)=>l===u,sqr:l=>mod$1(l*l,n),add:(l,u)=>mod$1(l+u,n),sub:(l,u)=>mod$1(l-u,n),mul:(l,u)=>mod$1(l*u,n),pow:(l,u)=>FpPow$1(c,l,u),div:(l,u)=>mod$1(l*invert$1(u,n),n),sqrN:l=>l*l,addN:(l,u)=>l+u,subN:(l,u)=>l-u,mulN:(l,u)=>l*u,inv:l=>invert$1(l,n),sqrt:r.sqrt||(l=>a(c,l)),invertBatch:l=>FpInvertBatch$1(c,l),cmov:(l,u,f)=>f?u:l,toBytes:l=>t?numberToBytesLE$1(l,o):numberToBytesBE$1(l,o),fromBytes:l=>{if(l.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${l.length}`);return t?bytesToNumberLE$1(l):bytesToNumberBE$1(l)}});return Object.freeze(c)}function getFieldBytesLength$1(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function getMinHashLength$1(n){const e=getFieldBytesLength$1(n);return e+Math.ceil(e/2)}function mapHashToField$1(n,e,t=!1){const r=n.length,s=getFieldBytesLength$1(e),o=getMinHashLength$1(e);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const a=t?bytesToNumberBE$1(n):bytesToNumberLE$1(n),c=mod$1(a,e-_1n$8)+_1n$8;return t?numberToBytesLE$1(c,s):numberToBytesBE$1(c,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$7=BigInt(0),_1n$7=BigInt(1);function wNAF$1(n,e){const t=(s,o)=>{const a=o.negate();return s?a:o},r=s=>{const o=Math.ceil(e/s)+1,a=2**(s-1);return{windows:o,windowSize:a}};return{constTimeNegate:t,unsafeLadder(s,o){let a=n.ZERO,c=s;for(;o>_0n$7;)o&_1n$7&&(a=a.add(c)),c=c.double(),o>>=_1n$7;return a},precomputeWindow(s,o){const{windows:a,windowSize:c}=r(o),l=[];let u=s,f=u;for(let h=0;h<a;h++){f=u,l.push(f);for(let p=1;p<c;p++)f=f.add(u),l.push(f);u=f.double()}return l},wNAF(s,o,a){const{windows:c,windowSize:l}=r(s);let u=n.ZERO,f=n.BASE;const h=BigInt(2**s-1),p=2**s,g=BigInt(s);for(let y=0;y<c;y++){const m=y*l;let b=Number(a&h);a>>=g,b>l&&(b-=p,a+=_1n$7);const v=m,$=m+Math.abs(b)-1,I=y%2!==0,O=b<0;b===0?f=f.add(t(I,o[v])):u=u.add(t(O,o[$]))}return{p:u,f}},wNAFCached(s,o,a,c){const l=s._WINDOW_SIZE||1;let u=o.get(s);return u||(u=this.precomputeWindow(s,l),l!==1&&o.set(s,c(u))),this.wNAF(l,u,a)}}}function validateBasic$1(n){return validateField$1(n.Fp),validateObject$1(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength$1(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validatePointOpts$1(n){const e=validateBasic$1(n);validateObject$1(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:r,a:s}=e;if(t){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n$1,hexToBytes:h2b$1}=ut$1,DER$1={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(n){const{Err:e}=DER$1;if(n.length<2||n[0]!==2)throw new e("Invalid signature integer tag");const t=n[1],r=n.subarray(2,t+2);if(!t||r.length!==t)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:b2n$1(r),l:n.subarray(t+2)}},toSig(n){const{Err:e}=DER$1,t=typeof n=="string"?h2b$1(n):n;if(!(t instanceof Uint8Array))throw new Error("ui8a expected");let r=t.length;if(r<2||t[0]!=48)throw new e("Invalid signature tag");if(t[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:s,l:o}=DER$1._parseInt(t.subarray(2)),{d:a,l:c}=DER$1._parseInt(o);if(c.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:a}},hexFromSig(n){const e=u=>Number.parseInt(u[0],16)&8?"00"+u:u,t=u=>{const f=u.toString(16);return f.length&1?`0${f}`:f},r=e(t(n.s)),s=e(t(n.r)),o=r.length/2,a=s.length/2,c=t(o),l=t(a);return`30${t(a+o+4)}02${l}${s}02${c}${r}`}},_0n$6=BigInt(0),_1n$6=BigInt(1);BigInt(2);const _3n$2=BigInt(3);BigInt(4);function weierstrassPoints$1(n){const e=validatePointOpts$1(n),{Fp:t}=e,r=e.toBytes||((y,m,b)=>{const v=m.toAffine();return concatBytes$3(Uint8Array.from([4]),t.toBytes(v.x),t.toBytes(v.y))}),s=e.fromBytes||(y=>{const m=y.subarray(1),b=t.fromBytes(m.subarray(0,t.BYTES)),v=t.fromBytes(m.subarray(t.BYTES,2*t.BYTES));return{x:b,y:v}});function o(y){const{a:m,b}=e,v=t.sqr(y),$=t.mul(v,y);return t.add(t.add($,t.mul(y,m)),b)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(y){return typeof y=="bigint"&&_0n$6<y&&y<e.n}function c(y){if(!a(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(y){const{allowedPrivateKeyLengths:m,nByteLength:b,wrapPrivateKey:v,n:$}=e;if(m&&typeof y!="bigint"){if(y instanceof Uint8Array&&(y=bytesToHex$3(y)),typeof y!="string"||!m.includes(y.length))throw new Error("Invalid key");y=y.padStart(b*2,"0")}let I;try{I=typeof y=="bigint"?y:bytesToNumberBE$1(ensureBytes$1("private key",y,b))}catch{throw new Error(`private key must be ${b} bytes, hex or bigint, not ${typeof y}`)}return v&&(I=mod$1(I,$)),c(I),I}const u=new Map;function f(y){if(!(y instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(m,b,v){if(this.px=m,this.py=b,this.pz=v,m==null||!t.isValid(m))throw new Error("x required");if(b==null||!t.isValid(b))throw new Error("y required");if(v==null||!t.isValid(v))throw new Error("z required")}static fromAffine(m){const{x:b,y:v}=m||{};if(!m||!t.isValid(b)||!t.isValid(v))throw new Error("invalid affine point");if(m instanceof h)throw new Error("projective point not allowed");const $=I=>t.eql(I,t.ZERO);return $(b)&&$(v)?h.ZERO:new h(b,v,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(m){const b=t.invertBatch(m.map(v=>v.pz));return m.map((v,$)=>v.toAffine(b[$])).map(h.fromAffine)}static fromHex(m){const b=h.fromAffine(s(ensureBytes$1("pointHex",m)));return b.assertValidity(),b}static fromPrivateKey(m){return h.BASE.multiply(l(m))}_setWindowSize(m){this._WINDOW_SIZE=m,u.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:m,y:b}=this.toAffine();if(!t.isValid(m)||!t.isValid(b))throw new Error("bad point: x or y not FE");const v=t.sqr(b),$=o(m);if(!t.eql(v,$))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:m}=this.toAffine();if(t.isOdd)return!t.isOdd(m);throw new Error("Field doesn't support isOdd")}equals(m){f(m);const{px:b,py:v,pz:$}=this,{px:I,py:O,pz:M}=m,L=t.eql(t.mul(b,M),t.mul(I,$)),T=t.eql(t.mul(v,M),t.mul(O,$));return L&&T}negate(){return new h(this.px,t.neg(this.py),this.pz)}double(){const{a:m,b}=e,v=t.mul(b,_3n$2),{px:$,py:I,pz:O}=this;let M=t.ZERO,L=t.ZERO,T=t.ZERO,B=t.mul($,$),H=t.mul(I,I),q=t.mul(O,O),x=t.mul($,I);return x=t.add(x,x),T=t.mul($,O),T=t.add(T,T),M=t.mul(m,T),L=t.mul(v,q),L=t.add(M,L),M=t.sub(H,L),L=t.add(H,L),L=t.mul(M,L),M=t.mul(x,M),T=t.mul(v,T),q=t.mul(m,q),x=t.sub(B,q),x=t.mul(m,x),x=t.add(x,T),T=t.add(B,B),B=t.add(T,B),B=t.add(B,q),B=t.mul(B,x),L=t.add(L,B),q=t.mul(I,O),q=t.add(q,q),B=t.mul(q,x),M=t.sub(M,B),T=t.mul(q,H),T=t.add(T,T),T=t.add(T,T),new h(M,L,T)}add(m){f(m);const{px:b,py:v,pz:$}=this,{px:I,py:O,pz:M}=m;let L=t.ZERO,T=t.ZERO,B=t.ZERO;const H=e.a,q=t.mul(e.b,_3n$2);let x=t.mul(b,I),S=t.mul(v,O),A=t.mul($,M),R=t.add(b,v),_=t.add(I,O);R=t.mul(R,_),_=t.add(x,S),R=t.sub(R,_),_=t.add(b,$);let E=t.add(I,M);return _=t.mul(_,E),E=t.add(x,A),_=t.sub(_,E),E=t.add(v,$),L=t.add(O,M),E=t.mul(E,L),L=t.add(S,A),E=t.sub(E,L),B=t.mul(H,_),L=t.mul(q,A),B=t.add(L,B),L=t.sub(S,B),B=t.add(S,B),T=t.mul(L,B),S=t.add(x,x),S=t.add(S,x),A=t.mul(H,A),_=t.mul(q,_),S=t.add(S,A),A=t.sub(x,A),A=t.mul(H,A),_=t.add(_,A),x=t.mul(S,_),T=t.add(T,x),x=t.mul(E,_),L=t.mul(R,L),L=t.sub(L,x),x=t.mul(R,S),B=t.mul(E,B),B=t.add(B,x),new h(L,T,B)}subtract(m){return this.add(m.negate())}is0(){return this.equals(h.ZERO)}wNAF(m){return g.wNAFCached(this,u,m,b=>{const v=t.invertBatch(b.map($=>$.pz));return b.map(($,I)=>$.toAffine(v[I])).map(h.fromAffine)})}multiplyUnsafe(m){const b=h.ZERO;if(m===_0n$6)return b;if(c(m),m===_1n$6)return this;const{endo:v}=e;if(!v)return g.unsafeLadder(this,m);let{k1neg:$,k1:I,k2neg:O,k2:M}=v.splitScalar(m),L=b,T=b,B=this;for(;I>_0n$6||M>_0n$6;)I&_1n$6&&(L=L.add(B)),M&_1n$6&&(T=T.add(B)),B=B.double(),I>>=_1n$6,M>>=_1n$6;return $&&(L=L.negate()),O&&(T=T.negate()),T=new h(t.mul(T.px,v.beta),T.py,T.pz),L.add(T)}multiply(m){c(m);let b=m,v,$;const{endo:I}=e;if(I){const{k1neg:O,k1:M,k2neg:L,k2:T}=I.splitScalar(b);let{p:B,f:H}=this.wNAF(M),{p:q,f:x}=this.wNAF(T);B=g.constTimeNegate(O,B),q=g.constTimeNegate(L,q),q=new h(t.mul(q.px,I.beta),q.py,q.pz),v=B.add(q),$=H.add(x)}else{const{p:O,f:M}=this.wNAF(b);v=O,$=M}return h.normalizeZ([v,$])[0]}multiplyAndAddUnsafe(m,b,v){const $=h.BASE,I=(M,L)=>L===_0n$6||L===_1n$6||!M.equals($)?M.multiplyUnsafe(L):M.multiply(L),O=I(this,b).add(I(m,v));return O.is0()?void 0:O}toAffine(m){const{px:b,py:v,pz:$}=this,I=this.is0();m==null&&(m=I?t.ONE:t.inv($));const O=t.mul(b,m),M=t.mul(v,m),L=t.mul($,m);if(I)return{x:t.ZERO,y:t.ZERO};if(!t.eql(L,t.ONE))throw new Error("invZ was invalid");return{x:O,y:M}}isTorsionFree(){const{h:m,isTorsionFree:b}=e;if(m===_1n$6)return!0;if(b)return b(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:m,clearCofactor:b}=e;return m===_1n$6?this:b?b(h,this):this.multiplyUnsafe(e.h)}toRawBytes(m=!0){return this.assertValidity(),r(h,this,m)}toHex(m=!0){return bytesToHex$3(this.toRawBytes(m))}}h.BASE=new h(e.Gx,e.Gy,t.ONE),h.ZERO=new h(t.ZERO,t.ONE,t.ZERO);const p=e.nBitLength,g=wNAF$1(h,e.endo?Math.ceil(p/2):p);return{CURVE:e,ProjectivePoint:h,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:a}}function validateOpts$1(n){const e=validateBasic$1(n);return validateObject$1(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass$1(n){const e=validateOpts$1(n),{Fp:t,n:r}=e,s=t.BYTES+1,o=2*t.BYTES+1;function a(_){return _0n$6<_&&_<t.ORDER}function c(_){return mod$1(_,r)}function l(_){return invert$1(_,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:f,weierstrassEquation:h,isWithinCurveOrder:p}=weierstrassPoints$1({...e,toBytes(_,E,C){const k=E.toAffine(),N=t.toBytes(k.x),U=concatBytes$3;return C?U(Uint8Array.from([E.hasEvenY()?2:3]),N):U(Uint8Array.from([4]),N,t.toBytes(k.y))},fromBytes(_){const E=_.length,C=_[0],k=_.subarray(1);if(E===s&&(C===2||C===3)){const N=bytesToNumberBE$1(k);if(!a(N))throw new Error("Point is not on curve");const U=h(N);let P=t.sqrt(U);const F=(P&_1n$6)===_1n$6;return(C&1)===1!==F&&(P=t.neg(P)),{x:N,y:P}}else if(E===o&&C===4){const N=t.fromBytes(k.subarray(0,t.BYTES)),U=t.fromBytes(k.subarray(t.BYTES,2*t.BYTES));return{x:N,y:U}}else throw new Error(`Point of length ${E} was invalid. Expected ${s} compressed bytes or ${o} uncompressed bytes`)}}),g=_=>bytesToHex$3(numberToBytesBE$1(_,e.nByteLength));function y(_){const E=r>>_1n$6;return _>E}function m(_){return y(_)?c(-_):_}const b=(_,E,C)=>bytesToNumberBE$1(_.slice(E,C));class v{constructor(E,C,k){this.r=E,this.s=C,this.recovery=k,this.assertValidity()}static fromCompact(E){const C=e.nByteLength;return E=ensureBytes$1("compactSignature",E,C*2),new v(b(E,0,C),b(E,C,2*C))}static fromDER(E){const{r:C,s:k}=DER$1.toSig(ensureBytes$1("DER",E));return new v(C,k)}assertValidity(){if(!p(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!p(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new v(this.r,this.s,E)}recoverPublicKey(E){const{r:C,s:k,recovery:N}=this,U=T(ensureBytes$1("msgHash",E));if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");const P=N===2||N===3?C+e.n:C;if(P>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const F=N&1?"03":"02",D=u.fromHex(F+g(P)),j=l(P),V=c(-U*j),K=c(k*j),z=u.BASE.multiplyAndAddUnsafe(D,V,K);if(!z)throw new Error("point at infinify");return z.assertValidity(),z}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes$3(this.toDERHex())}toDERHex(){return DER$1.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes$3(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}const $={isValidPrivateKey(_){try{return f(_),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const _=getMinHashLength$1(e.n);return mapHashToField$1(e.randomBytes(_),e.n)},precompute(_=8,E=u.BASE){return E._setWindowSize(_),E.multiply(BigInt(3)),E}};function I(_,E=!0){return u.fromPrivateKey(_).toRawBytes(E)}function O(_){const E=_ instanceof Uint8Array,C=typeof _=="string",k=(E||C)&&_.length;return E?k===s||k===o:C?k===2*s||k===2*o:_ instanceof u}function M(_,E,C=!0){if(O(_))throw new Error("first arg must be private key");if(!O(E))throw new Error("second arg must be public key");return u.fromHex(E).multiply(f(_)).toRawBytes(C)}const L=e.bits2int||function(_){const E=bytesToNumberBE$1(_),C=_.length*8-e.nBitLength;return C>0?E>>BigInt(C):E},T=e.bits2int_modN||function(_){return c(L(_))},B=bitMask$1(e.nBitLength);function H(_){if(typeof _!="bigint")throw new Error("bigint expected");if(!(_0n$6<=_&&_<B))throw new Error(`bigint expected < 2^${e.nBitLength}`);return numberToBytesBE$1(_,e.nByteLength)}function q(_,E,C=x){if(["recovered","canonical"].some(Y=>Y in C))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:N}=e;let{lowS:U,prehash:P,extraEntropy:F}=C;U==null&&(U=!0),_=ensureBytes$1("msgHash",_),P&&(_=ensureBytes$1("prehashed msgHash",k(_)));const D=T(_),j=f(E),V=[H(j),H(D)];if(F!=null){const Y=F===!0?N(t.BYTES):F;V.push(ensureBytes$1("extraEntropy",Y))}const K=concatBytes$3(...V),z=D;function Z(Y){const J=L(Y);if(!p(J))return;const X=l(J),G=u.BASE.multiply(J).toAffine(),W=c(G.x);if(W===_0n$6)return;const Q=c(X*c(z+W*j));if(Q===_0n$6)return;let se=(G.x===W?0:2)|Number(G.y&_1n$6),oe=Q;return U&&y(Q)&&(oe=m(Q),se^=1),new v(W,oe,se)}return{seed:K,k2sig:Z}}const x={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};function A(_,E,C=x){const{seed:k,k2sig:N}=q(_,E,C),U=e;return createHmacDrbg$1(U.hash.outputLen,U.nByteLength,U.hmac)(k,N)}u.BASE._setWindowSize(8);function R(_,E,C,k=S){var G;const N=_;if(E=ensureBytes$1("msgHash",E),C=ensureBytes$1("publicKey",C),"strict"in k)throw new Error("options.strict was renamed to lowS");const{lowS:U,prehash:P}=k;let F,D;try{if(typeof N=="string"||N instanceof Uint8Array)try{F=v.fromDER(N)}catch(W){if(!(W instanceof DER$1.Err))throw W;F=v.fromCompact(N)}else if(typeof N=="object"&&typeof N.r=="bigint"&&typeof N.s=="bigint"){const{r:W,s:Q}=N;F=new v(W,Q)}else throw new Error("PARSE");D=u.fromHex(C)}catch(W){if(W.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(U&&F.hasHighS())return!1;P&&(E=e.hash(E));const{r:j,s:V}=F,K=T(E),z=l(V),Z=c(K*z),Y=c(j*z),J=(G=u.BASE.multiplyAndAddUnsafe(D,Z,Y))==null?void 0:G.toAffine();return J?c(J.x)===j:!1}return{CURVE:e,getPublicKey:I,getSharedSecret:M,sign:A,verify:R,ProjectivePoint:u,Signature:v,utils:$}}let HMAC$2=class extends Hash$2{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,hash$3(e);const r=toBytes$2(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return exists$2(this),this.iHash.update(e),this}digestInto(e){exists$2(this),bytes$3(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:o,blockLen:a,outputLen:c}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=c,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$2=(n,e,t)=>new HMAC$2(n,e).update(t).digest();hmac$2.create=(n,e)=>new HMAC$2(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash$1(n){return{hash:n,hmac:(e,...t)=>hmac$2(n,e,concatBytes$4(...t)),randomBytes:randomBytes$2}}function createCurve$1(n,e){const t=r=>weierstrass$1({...n,...getHash$1(r)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P$1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N$1=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n$5=BigInt(1),_2n$3=BigInt(2),divNearest$1=(n,e)=>(n+e/_2n$3)/e;function sqrtMod$1(n){const e=secp256k1P$1,t=BigInt(3),r=BigInt(6),s=BigInt(11),o=BigInt(22),a=BigInt(23),c=BigInt(44),l=BigInt(88),u=n*n*n%e,f=u*u*n%e,h=pow2$1(f,t,e)*f%e,p=pow2$1(h,t,e)*f%e,g=pow2$1(p,_2n$3,e)*u%e,y=pow2$1(g,s,e)*g%e,m=pow2$1(y,o,e)*y%e,b=pow2$1(m,c,e)*m%e,v=pow2$1(b,l,e)*b%e,$=pow2$1(v,c,e)*m%e,I=pow2$1($,t,e)*f%e,O=pow2$1(I,a,e)*y%e,M=pow2$1(O,r,e)*u%e,L=pow2$1(M,_2n$3,e);if(!Fp$1.eql(Fp$1.sqr(L),n))throw new Error("Cannot find square root");return L}const Fp$1=Field$1(secp256k1P$1,void 0,void 0,{sqrt:sqrtMod$1}),secp256k1$1=createCurve$1({a:BigInt(0),b:BigInt(7),Fp:Fp$1,n:secp256k1N$1,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const e=secp256k1N$1,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-_1n$5*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=t,a=BigInt("0x100000000000000000000000000000000"),c=divNearest$1(o*n,e),l=divNearest$1(-r*n,e);let u=mod$1(n-c*t-l*s,e),f=mod$1(-c*r-l*o,e);const h=u>a,p=f>a;if(h&&(u=e-u),p&&(f=e-f),u>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:h,k1:u,k2neg:p,k2:f}}}},sha256$2),_0n$5=BigInt(0),fe=n=>typeof n=="bigint"&&_0n$5<n&&n<secp256k1P$1,ge=n=>typeof n=="bigint"&&_0n$5<n&&n<secp256k1N$1,TAGGED_HASH_PREFIXES$1={};function taggedHash$1(n,...e){let t=TAGGED_HASH_PREFIXES$1[n];if(t===void 0){const r=sha256$2(Uint8Array.from(n,s=>s.charCodeAt(0)));t=concatBytes$3(r,r),TAGGED_HASH_PREFIXES$1[n]=t}return sha256$2(concatBytes$3(t,...e))}const pointToBytes$1=n=>n.toRawBytes(!0).slice(1),numTo32b$1=n=>numberToBytesBE$1(n,32),modP$1=n=>mod$1(n,secp256k1P$1),modN$1=n=>mod$1(n,secp256k1N$1),Point$1=secp256k1$1.ProjectivePoint,GmulAdd$1=(n,e,t)=>Point$1.BASE.multiplyAndAddUnsafe(n,e,t);function schnorrGetExtPubKey$1(n){let e=secp256k1$1.utils.normPrivateKeyToScalar(n),t=Point$1.fromPrivateKey(e);return{scalar:t.hasEvenY()?e:modN$1(-e),bytes:pointToBytes$1(t)}}function lift_x$1(n){if(!fe(n))throw new Error("bad x: need 0 < x < p");const e=modP$1(n*n),t=modP$1(e*n+BigInt(7));let r=sqrtMod$1(t);r%_2n$3!==_0n$5&&(r=modP$1(-r));const s=new Point$1(n,r,_1n$5);return s.assertValidity(),s}function challenge$1(...n){return modN$1(bytesToNumberBE$1(taggedHash$1("BIP0340/challenge",...n)))}function schnorrGetPublicKey$1(n){return schnorrGetExtPubKey$1(n).bytes}function schnorrSign$1(n,e,t=randomBytes$2(32)){const r=ensureBytes$1("message",n),{bytes:s,scalar:o}=schnorrGetExtPubKey$1(e),a=ensureBytes$1("auxRand",t,32),c=numTo32b$1(o^bytesToNumberBE$1(taggedHash$1("BIP0340/aux",a))),l=taggedHash$1("BIP0340/nonce",c,s,r),u=modN$1(bytesToNumberBE$1(l));if(u===_0n$5)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=schnorrGetExtPubKey$1(u),p=challenge$1(f,s,r),g=new Uint8Array(64);if(g.set(f,0),g.set(numTo32b$1(modN$1(h+p*o)),32),!schnorrVerify$1(g,r,s))throw new Error("sign: Invalid signature produced");return g}function schnorrVerify$1(n,e,t){const r=ensureBytes$1("signature",n,64),s=ensureBytes$1("message",e),o=ensureBytes$1("publicKey",t,32);try{const a=lift_x$1(bytesToNumberBE$1(o)),c=bytesToNumberBE$1(r.subarray(0,32));if(!fe(c))return!1;const l=bytesToNumberBE$1(r.subarray(32,64));if(!ge(l))return!1;const u=challenge$1(numTo32b$1(c),pointToBytes$1(a),s),f=GmulAdd$1(a,l,modN$1(-u));return!(!f||!f.hasEvenY()||f.toAffine().x!==c)}catch{return!1}}const schnorr$1={getPublicKey:schnorrGetPublicKey$1,sign:schnorrSign$1,verify:schnorrVerify$1,utils:{randomPrivateKey:secp256k1$1.utils.randomPrivateKey,lift_x:lift_x$1,pointToBytes:pointToBytes$1,numberToBytesBE:numberToBytesBE$1,bytesToNumberBE:bytesToNumberBE$1,taggedHash:taggedHash$1,mod:mod$1}},crypto$2=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const u8a=n=>n instanceof Uint8Array,createView$1=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),rotr$1=(n,e)=>n<<32-e|n>>>e,isLE$1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE$1)throw new Error("Non little-endian hardware is not supported");const hexes$2=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$2(n){if(!u8a(n))throw new Error("Uint8Array expected");let e="";for(let t=0;t<n.length;t++)e+=hexes$2[n[t]];return e}function hexToBytes$2(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let r=0;r<t.length;r++){const s=r*2,o=n.slice(s,s+2),a=Number.parseInt(o,16);if(Number.isNaN(a)||a<0)throw new Error("Invalid byte sequence");t[r]=a}return t}function utf8ToBytes$2(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function toBytes$1(n){if(typeof n=="string"&&(n=utf8ToBytes$2(n)),!u8a(n))throw new Error(`expected Uint8Array, got ${typeof n}`);return n}function concatBytes$2(...n){const e=new Uint8Array(n.reduce((r,s)=>r+s.length,0));let t=0;return n.forEach(r=>{if(!u8a(r))throw new Error("Uint8Array expected");e.set(r,t),t+=r.length}),e}let Hash$1=class{clone(){return this._cloneInto()}};function wrapConstructor$1(n){const e=r=>n().update(toBytes$1(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function randomBytes$1(n=32){if(crypto$2&&typeof crypto$2.getRandomValues=="function")return crypto$2.getRandomValues(new Uint8Array(n));throw new Error("crypto.getRandomValues must be defined")}function number$2(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`Wrong positive integer: ${n}`)}function bool$1(n){if(typeof n!="boolean")throw new Error(`Expected boolean, not ${n}`)}function bytes$2(n,...e){if(!(n instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(n.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${n.length}`)}function hash$2(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number$2(n.outputLen),number$2(n.blockLen)}function exists$1(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function output$1(n,e){bytes$2(n);const t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const assert={number:number$2,bool:bool$1,bytes:bytes$2,hash:hash$2,exists:exists$1,output:output$1};function setBigUint64$1(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),c=Number(t&o),l=r?4:0,u=r?0:4;n.setUint32(e+l,a,r),n.setUint32(e+u,c,r)}class SHA2 extends Hash$1{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView$1(this.buffer)}update(e){assert.exists(this);const{view:t,buffer:r,blockLen:s}=this;e=toBytes$1(e);const o=e.length;for(let a=0;a<o;){const c=Math.min(s-this.pos,o-a);if(c===s){const l=createView$1(e);for(;s<=o-a;a+=s)this.process(l,a);continue}r.set(e.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){assert.exists(this),assert.output(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)t[h]=0;setBigUint64$1(r,s-8,BigInt(this.length*8),o),this.process(r,0);const c=createView$1(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=l/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)c.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:o,destroyed:a,pos:c}=this;return e.length=s,e.pos=c,e.finished=o,e.destroyed=a,s%t&&e.buffer.set(r),e}}const Chi$1=(n,e,t)=>n&e^~n&t,Maj$1=(n,e,t)=>n&e^n&t^e&t,SHA256_K$1=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W$1=new Uint32Array(64);let SHA256$1=class extends SHA2{constructor(){super(64,32,8,!1),this.A=IV[0]|0,this.B=IV[1]|0,this.C=IV[2]|0,this.D=IV[3]|0,this.E=IV[4]|0,this.F=IV[5]|0,this.G=IV[6]|0,this.H=IV[7]|0}get(){const{A:e,B:t,C:r,D:s,E:o,F:a,G:c,H:l}=this;return[e,t,r,s,o,a,c,l]}set(e,t,r,s,o,a,c,l){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=c|0,this.H=l|0}process(e,t){for(let h=0;h<16;h++,t+=4)SHA256_W$1[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=SHA256_W$1[h-15],g=SHA256_W$1[h-2],y=rotr$1(p,7)^rotr$1(p,18)^p>>>3,m=rotr$1(g,17)^rotr$1(g,19)^g>>>10;SHA256_W$1[h]=m+SHA256_W$1[h-7]+y+SHA256_W$1[h-16]|0}let{A:r,B:s,C:o,D:a,E:c,F:l,G:u,H:f}=this;for(let h=0;h<64;h++){const p=rotr$1(c,6)^rotr$1(c,11)^rotr$1(c,25),g=f+p+Chi$1(c,l,u)+SHA256_K$1[h]+SHA256_W$1[h]|0,m=(rotr$1(r,2)^rotr$1(r,13)^rotr$1(r,22))+Maj$1(r,s,o)|0;f=u,u=l,l=c,c=a+g|0,a=o,o=s,s=r,r=g+m|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,c=c+this.E|0,l=l+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,s,o,a,c,l,u,f)}roundClean(){SHA256_W$1.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};class SHA224 extends SHA256$1{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const sha256$1=wrapConstructor$1(()=>new SHA256$1);wrapConstructor$1(()=>new SHA224);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function assertNumber(n){if(!Number.isSafeInteger(n))throw new Error(`Wrong integer: ${n}`)}function chain$1(...n){const e=(s,o)=>a=>s(o(a)),t=Array.from(n).reverse().reduce((s,o)=>s?e(s,o.encode):o.encode,void 0),r=n.reduce((s,o)=>s?e(s,o.decode):o.decode,void 0);return{encode:t,decode:r}}function alphabet$1(n){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(t=>{if(assertNumber(t),t<0||t>=n.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${n.length})`);return n[t]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(t=>{if(typeof t!="string")throw new Error(`alphabet.decode: not string element=${t}`);const r=n.indexOf(t);if(r===-1)throw new Error(`Unknown letter: "${t}". Allowed: ${n}`);return r})}}}function join$1(n=""){if(typeof n!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let t of e)if(typeof t!="string")throw new Error(`join.encode: non-string input=${t}`);return e.join(n)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(n)}}}function padding(n,e="="){if(assertNumber(n),typeof e!="string")throw new Error("padding chr should be string");return{encode(t){if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of t)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;t.length*n%8;)t.push(e);return t},decode(t){if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of t)if(typeof s!="string")throw new Error(`padding.decode: non-string input=${s}`);let r=t.length;if(r*n%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&t[r-1]===e;r--)if(!((r-1)*n%8))throw new Error("Invalid padding: string has too much padding");return t.slice(0,r)}}}function normalize$1(n){if(typeof n!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>n(e)}}function convertRadix(n,e,t){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(t<2)throw new Error(`convertRadix: wrong to=${t}, base cannot be less than 2`);if(!Array.isArray(n))throw new Error("convertRadix: data should be array");if(!n.length)return[];let r=0;const s=[],o=Array.from(n);for(o.forEach(a=>{if(assertNumber(a),a<0||a>=e)throw new Error(`Wrong integer: ${a}`)});;){let a=0,c=!0;for(let l=r;l<o.length;l++){const u=o[l],f=e*a+u;if(!Number.isSafeInteger(f)||e*a/e!==a||f-u!==e*a)throw new Error("convertRadix: carry overflow");if(a=f%t,o[l]=Math.floor(f/t),!Number.isSafeInteger(o[l])||o[l]*t+a!==f)throw new Error("convertRadix: carry overflow");if(c)o[l]?c=!1:r=l;else continue}if(s.push(a),c)break}for(let a=0;a<n.length-1&&n[a]===0;a++)s.push(0);return s.reverse()}const gcd$1=(n,e)=>e?gcd$1(e,n%e):n,radix2carry$1=(n,e)=>n+(e-gcd$1(n,e));function convertRadix2$1(n,e,t,r){if(!Array.isArray(n))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(radix2carry$1(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${radix2carry$1(e,t)}`);let s=0,o=0;const a=2**t-1,c=[];for(const l of n){if(assertNumber(l),l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(s=s<<e|l,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=t;o-=t)c.push((s>>o-t&a)>>>0);s&=2**o-1}if(s=s<<t-o&a,!r&&o>=e)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&o>0&&c.push(s>>>0),c}function radix(n){return assertNumber(n),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return convertRadix(Array.from(e),2**8,n)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(convertRadix(e,n,2**8))}}}function radix2$1(n,e=!1){if(assertNumber(n),n<=0||n>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry$1(8,n)>32||radix2carry$1(n,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2$1(Array.from(t),8,n,!e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(convertRadix2$1(t,n,8,e))}}}function unsafeWrapper$1(n){if(typeof n!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return n.apply(null,e)}catch{}}}const base16=chain$1(radix2$1(4),alphabet$1("0123456789ABCDEF"),join$1("")),base32=chain$1(radix2$1(5),alphabet$1("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),padding(5),join$1(""));chain$1(radix2$1(5),alphabet$1("0123456789ABCDEFGHIJKLMNOPQRSTUV"),padding(5),join$1(""));chain$1(radix2$1(5),alphabet$1("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),join$1(""),normalize$1(n=>n.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const base64=chain$1(radix2$1(6),alphabet$1("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),padding(6),join$1("")),base64url=chain$1(radix2$1(6),alphabet$1("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),padding(6),join$1("")),genBase58=n=>chain$1(radix(58),alphabet$1(n),join$1("")),base58=genBase58("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");genBase58("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");genBase58("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const XMR_BLOCK_LEN=[0,2,3,5,6,7,9,10,11],base58xmr={encode(n){let e="";for(let t=0;t<n.length;t+=8){const r=n.subarray(t,t+8);e+=base58.encode(r).padStart(XMR_BLOCK_LEN[r.length],"1")}return e},decode(n){let e=[];for(let t=0;t<n.length;t+=11){const r=n.slice(t,t+11),s=XMR_BLOCK_LEN.indexOf(r.length),o=base58.decode(r);for(let a=0;a<o.length-s;a++)if(o[a]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(o.slice(o.length-s)))}return Uint8Array.from(e)}},BECH_ALPHABET$1=chain$1(alphabet$1("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join$1("")),POLYMOD_GENERATORS$1=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod$1(n){const e=n>>25;let t=(n&33554431)<<5;for(let r=0;r<POLYMOD_GENERATORS$1.length;r++)(e>>r&1)===1&&(t^=POLYMOD_GENERATORS$1[r]);return t}function bechChecksum$1(n,e,t=1){const r=n.length;let s=1;for(let o=0;o<r;o++){const a=n.charCodeAt(o);if(a<33||a>126)throw new Error(`Invalid prefix (${n})`);s=bech32Polymod$1(s)^a>>5}s=bech32Polymod$1(s);for(let o=0;o<r;o++)s=bech32Polymod$1(s)^n.charCodeAt(o)&31;for(let o of e)s=bech32Polymod$1(s)^o;for(let o=0;o<6;o++)s=bech32Polymod$1(s);return s^=t,BECH_ALPHABET$1.encode(convertRadix2$1([s%2**30],30,5,!1))}function genBech32$1(n){const e=n==="bech32"?1:734539939,t=radix2$1(5),r=t.decode,s=t.encode,o=unsafeWrapper$1(r);function a(f,h,p=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(h)||h.length&&typeof h[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof h}`);const g=f.length+7+h.length;if(p!==!1&&g>p)throw new TypeError(`Length ${g} exceeds limit ${p}`);return f=f.toLowerCase(),`${f}1${BECH_ALPHABET$1.encode(h)}${bechChecksum$1(f,h,e)}`}function c(f,h=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||h!==!1&&f.length>h)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${h})`);const p=f.toLowerCase();if(f!==p&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=p;const g=f.lastIndexOf("1");if(g===0||g===-1)throw new Error('Letter "1" must be present between prefix and data only');const y=f.slice(0,g),m=f.slice(g+1);if(m.length<6)throw new Error("Data must be at least 6 characters long");const b=BECH_ALPHABET$1.decode(m).slice(0,-6),v=bechChecksum$1(y,b,e);if(!m.endsWith(v))throw new Error(`Invalid checksum in ${f}: expected "${v}"`);return{prefix:y,words:b}}const l=unsafeWrapper$1(c);function u(f){const{prefix:h,words:p}=c(f,!1);return{prefix:h,words:p,bytes:r(p)}}return{encode:a,decode:c,decodeToBytes:u,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:o,toWords:s}}const bech32$1=genBech32$1("bech32");genBech32$1("bech32m");const utf8={encode:n=>new TextDecoder().decode(n),decode:n=>new TextEncoder().encode(n)},hex=chain$1(radix2$1(4),alphabet$1("0123456789abcdef"),join$1(""),normalize$1(n=>{if(typeof n!="string"||n.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof n} with length ${n.length}`);return n.toLowerCase()})),CODERS={utf8,hex,base16,base32,base64,base64url,base58,base58xmr};`${Object.keys(CODERS).join(", ")}`;function number$1(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function bool(n){if(typeof n!="boolean")throw new Error(`boolean expected, not ${n}`)}function isBytes$3(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function bytes$1(n,...e){if(!isBytes$3(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${n.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const u32=n=>new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4)),isLE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!isLE)throw new Error("Non little-endian hardware is not supported");function checkOpts(n,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(n,e)}function equalBytes$1(n,e){if(n.length!==e.length)return!1;let t=0;for(let r=0;r<n.length;r++)t|=n[r]^e[r];return t===0}const wrapCipher=(n,e)=>(Object.assign(e,n),e),BLOCK_SIZE=16,POLY=283;function mul2(n){return n<<1^POLY&-(n>>7)}function mul(n,e){let t=0;for(;e>0;e>>=1)t^=n&-(e&1),n=mul2(n);return t}const sbox=(()=>{let n=new Uint8Array(256);for(let t=0,r=1;t<256;t++,r^=mul2(r))n[t]=r;const e=new Uint8Array(256);e[0]=99;for(let t=0;t<255;t++){let r=n[255-t];r|=r<<8,e[n[t]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),invSbox=sbox.map((n,e)=>sbox.indexOf(e)),rotr32_8=n=>n<<24|n>>>8,rotl32_8=n=>n<<8|n>>>24;function genTtable(n,e){if(n.length!==256)throw new Error("Wrong sbox length");const t=new Uint32Array(256).map((u,f)=>e(n[f])),r=t.map(rotl32_8),s=r.map(rotl32_8),o=s.map(rotl32_8),a=new Uint32Array(256*256),c=new Uint32Array(256*256),l=new Uint16Array(256*256);for(let u=0;u<256;u++)for(let f=0;f<256;f++){const h=u*256+f;a[h]=t[u]^r[f],c[h]=s[u]^o[f],l[h]=n[u]<<8|n[f]}return{sbox:n,sbox2:l,T0:t,T1:r,T2:s,T3:o,T01:a,T23:c}}const tableEncoding=genTtable(sbox,n=>mul(n,3)<<24|n<<16|n<<8|mul(n,2)),tableDecoding=genTtable(invSbox,n=>mul(n,11)<<24|mul(n,13)<<16|mul(n,9)<<8|mul(n,14)),xPowers=(()=>{const n=new Uint8Array(16);for(let e=0,t=1;e<16;e++,t=mul2(t))n[e]=t;return n})();function expandKeyLE(n){bytes$1(n);const e=n.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:t}=tableEncoding,r=u32(n),s=r.length,o=c=>applySbox(t,c,c,c,c),a=new Uint32Array(e+28);a.set(r);for(let c=s;c<a.length;c++){let l=a[c-1];c%s===0?l=o(rotr32_8(l))^xPowers[c/s-1]:s>6&&c%s===4&&(l=o(l)),a[c]=a[c-s]^l}return a}function expandKeyDecLE(n){const e=expandKeyLE(n),t=e.slice(),r=e.length,{sbox2:s}=tableEncoding,{T0:o,T1:a,T2:c,T3:l}=tableDecoding;for(let u=0;u<r;u+=4)for(let f=0;f<4;f++)t[u+f]=e[r-u-4+f];e.fill(0);for(let u=4;u<r-4;u++){const f=t[u],h=applySbox(s,f,f,f,f);t[u]=o[h&255]^a[h>>>8&255]^c[h>>>16&255]^l[h>>>24]}return t}function apply0123(n,e,t,r,s,o){return n[t<<8&65280|r>>>8&255]^e[s>>>8&65280|o>>>24&255]}function applySbox(n,e,t,r,s){return n[e&255|t&65280]|n[r>>>16&255|s>>>16&65280]<<16}function encrypt$2(n,e,t,r,s){const{sbox2:o,T01:a,T23:c}=tableEncoding;let l=0;e^=n[l++],t^=n[l++],r^=n[l++],s^=n[l++];const u=n.length/4-2;for(let y=0;y<u;y++){const m=n[l++]^apply0123(a,c,e,t,r,s),b=n[l++]^apply0123(a,c,t,r,s,e),v=n[l++]^apply0123(a,c,r,s,e,t),$=n[l++]^apply0123(a,c,s,e,t,r);e=m,t=b,r=v,s=$}const f=n[l++]^applySbox(o,e,t,r,s),h=n[l++]^applySbox(o,t,r,s,e),p=n[l++]^applySbox(o,r,s,e,t),g=n[l++]^applySbox(o,s,e,t,r);return{s0:f,s1:h,s2:p,s3:g}}function decrypt$2(n,e,t,r,s){const{sbox2:o,T01:a,T23:c}=tableDecoding;let l=0;e^=n[l++],t^=n[l++],r^=n[l++],s^=n[l++];const u=n.length/4-2;for(let y=0;y<u;y++){const m=n[l++]^apply0123(a,c,e,s,r,t),b=n[l++]^apply0123(a,c,t,e,s,r),v=n[l++]^apply0123(a,c,r,t,e,s),$=n[l++]^apply0123(a,c,s,r,t,e);e=m,t=b,r=v,s=$}const f=n[l++]^applySbox(o,e,s,r,t),h=n[l++]^applySbox(o,t,e,s,r),p=n[l++]^applySbox(o,r,t,e,s),g=n[l++]^applySbox(o,s,r,t,e);return{s0:f,s1:h,s2:p,s3:g}}function getDst(n,e){if(!e)return new Uint8Array(n);if(bytes$1(e),e.length<n)throw new Error(`aes: wrong destination length, expected at least ${n}, got: ${e.length}`);return e}function validateBlockDecrypt(n){if(bytes$1(n),n.length%BLOCK_SIZE!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${BLOCK_SIZE}`)}function validateBlockEncrypt(n,e,t){let r=n.length;const s=r%BLOCK_SIZE;if(!e&&s!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const o=u32(n);if(e){let l=BLOCK_SIZE-s;l||(l=BLOCK_SIZE),r=r+l}const a=getDst(r,t),c=u32(a);return{b:o,o:c,out:a}}function validatePCKS(n,e){if(!e)return n;const t=n.length;if(!t)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=n[t-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const s=n.subarray(0,-r);for(let o=0;o<r;o++)if(n[t-o-1]!==r)throw new Error("aes/pcks5: wrong padding");return s}function padPCKS(n){const e=new Uint8Array(16),t=u32(e);e.set(n);const r=BLOCK_SIZE-n.length;for(let s=BLOCK_SIZE-r;s<BLOCK_SIZE;s++)e[s]=r;return t}const cbc=wrapCipher({blockSize:16,nonceLength:16},function(e,t,r={}){bytes$1(e),bytes$1(t,16);const s=!r.disablePadding;return{encrypt:(o,a)=>{const c=expandKeyLE(e),{b:l,o:u,out:f}=validateBlockEncrypt(o,s,a),h=u32(t);let p=h[0],g=h[1],y=h[2],m=h[3],b=0;for(;b+4<=l.length;)p^=l[b+0],g^=l[b+1],y^=l[b+2],m^=l[b+3],{s0:p,s1:g,s2:y,s3:m}=encrypt$2(c,p,g,y,m),u[b++]=p,u[b++]=g,u[b++]=y,u[b++]=m;if(s){const v=padPCKS(o.subarray(b*4));p^=v[0],g^=v[1],y^=v[2],m^=v[3],{s0:p,s1:g,s2:y,s3:m}=encrypt$2(c,p,g,y,m),u[b++]=p,u[b++]=g,u[b++]=y,u[b++]=m}return c.fill(0),f},decrypt:(o,a)=>{validateBlockDecrypt(o);const c=expandKeyDecLE(e),l=u32(t),u=getDst(o.length,a),f=u32(o),h=u32(u);let p=l[0],g=l[1],y=l[2],m=l[3];for(let b=0;b+4<=f.length;){const v=p,$=g,I=y,O=m;p=f[b+0],g=f[b+1],y=f[b+2],m=f[b+3];const{s0:M,s1:L,s2:T,s3:B}=decrypt$2(c,p,g,y,m);h[b++]=M^v,h[b++]=L^$,h[b++]=T^I,h[b++]=B^O}return c.fill(0),validatePCKS(u,s)}}}),_utf8ToBytes=n=>Uint8Array.from(n.split("").map(e=>e.charCodeAt(0))),sigma16=_utf8ToBytes("expand 16-byte k"),sigma32=_utf8ToBytes("expand 32-byte k"),sigma16_32=u32(sigma16),sigma32_32=u32(sigma32);sigma32_32.slice();function rotl(n,e){return n<<e|n>>>32-e}function isAligned32(n){return n.byteOffset%4===0}const BLOCK_LEN=64,BLOCK_LEN32=16,MAX_COUNTER=2**32-1,U32_EMPTY=new Uint32Array;function runCipher(n,e,t,r,s,o,a,c){const l=s.length,u=new Uint8Array(BLOCK_LEN),f=u32(u),h=isAligned32(s)&&isAligned32(o),p=h?u32(s):U32_EMPTY,g=h?u32(o):U32_EMPTY;for(let y=0;y<l;a++){if(n(e,t,r,f,a,c),a>=MAX_COUNTER)throw new Error("arx: counter overflow");const m=Math.min(BLOCK_LEN,l-y);if(h&&m===BLOCK_LEN){const b=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let v=0,$;v<BLOCK_LEN32;v++)$=b+v,g[$]=p[$]^f[v];y+=BLOCK_LEN;continue}for(let b=0,v;b<m;b++)v=y+b,o[v]=s[v]^u[b];y+=m}}function createCipher(n,e){const{allowShortKeys:t,extendNonceFn:r,counterLength:s,counterRight:o,rounds:a}=checkOpts({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof n!="function")throw new Error("core must be a function");return number$1(s),number$1(a),bool(o),bool(t),(c,l,u,f,h=0)=>{bytes$1(c),bytes$1(l),bytes$1(u);const p=u.length;if(f||(f=new Uint8Array(p)),bytes$1(f),number$1(h),h<0||h>=MAX_COUNTER)throw new Error("arx: counter overflow");if(f.length<p)throw new Error(`arx: output (${f.length}) is shorter than data (${p})`);const g=[];let y=c.length,m,b;if(y===32)m=c.slice(),g.push(m),b=sigma32_32;else if(y===16&&t)m=new Uint8Array(32),m.set(c),m.set(c,16),b=sigma16_32,g.push(m);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);isAligned32(l)||(l=l.slice(),g.push(l));const v=u32(m);if(r){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(b,v,u32(l.subarray(0,16)),v),l=l.subarray(16)}const $=16-s;if($!==l.length)throw new Error(`arx: nonce must be ${$} or 16 bytes`);if($!==12){const O=new Uint8Array(12);O.set(l,o?0:12-l.length),l=O,g.push(l)}const I=u32(l);for(runCipher(n,b,v,I,u,f,h,a);g.length>0;)g.pop().fill(0);return f}}function chachaCore(n,e,t,r,s,o=20){let a=n[0],c=n[1],l=n[2],u=n[3],f=e[0],h=e[1],p=e[2],g=e[3],y=e[4],m=e[5],b=e[6],v=e[7],$=s,I=t[0],O=t[1],M=t[2],L=a,T=c,B=l,H=u,q=f,x=h,S=p,A=g,R=y,_=m,E=b,C=v,k=$,N=I,U=O,P=M;for(let D=0;D<o;D+=2)L=L+q|0,k=rotl(k^L,16),R=R+k|0,q=rotl(q^R,12),L=L+q|0,k=rotl(k^L,8),R=R+k|0,q=rotl(q^R,7),T=T+x|0,N=rotl(N^T,16),_=_+N|0,x=rotl(x^_,12),T=T+x|0,N=rotl(N^T,8),_=_+N|0,x=rotl(x^_,7),B=B+S|0,U=rotl(U^B,16),E=E+U|0,S=rotl(S^E,12),B=B+S|0,U=rotl(U^B,8),E=E+U|0,S=rotl(S^E,7),H=H+A|0,P=rotl(P^H,16),C=C+P|0,A=rotl(A^C,12),H=H+A|0,P=rotl(P^H,8),C=C+P|0,A=rotl(A^C,7),L=L+x|0,P=rotl(P^L,16),E=E+P|0,x=rotl(x^E,12),L=L+x|0,P=rotl(P^L,8),E=E+P|0,x=rotl(x^E,7),T=T+S|0,k=rotl(k^T,16),C=C+k|0,S=rotl(S^C,12),T=T+S|0,k=rotl(k^T,8),C=C+k|0,S=rotl(S^C,7),B=B+A|0,N=rotl(N^B,16),R=R+N|0,A=rotl(A^R,12),B=B+A|0,N=rotl(N^B,8),R=R+N|0,A=rotl(A^R,7),H=H+q|0,U=rotl(U^H,16),_=_+U|0,q=rotl(q^_,12),H=H+q|0,U=rotl(U^H,8),_=_+U|0,q=rotl(q^_,7);let F=0;r[F++]=a+L|0,r[F++]=c+T|0,r[F++]=l+B|0,r[F++]=u+H|0,r[F++]=f+q|0,r[F++]=h+x|0,r[F++]=p+S|0,r[F++]=g+A|0,r[F++]=y+R|0,r[F++]=m+_|0,r[F++]=b+E|0,r[F++]=v+C|0,r[F++]=$+k|0,r[F++]=I+N|0,r[F++]=O+U|0,r[F++]=M+P|0}const chacha20=createCipher(chachaCore,{counterRight:!1,counterLength:4,allowShortKeys:!1});let HMAC$1=class extends Hash$1{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,assert.hash(e);const r=toBytes$1(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return assert.exists(this),this.iHash.update(e),this}digestInto(e){assert.exists(this),assert.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:o,blockLen:a,outputLen:c}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=c,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const hmac$1=(n,e,t)=>new HMAC$1(n,e).update(t).digest();hmac$1.create=(n,e)=>new HMAC$1(n,e);function extract(n,e,t){return assert.hash(n),hmac$1(n,toBytes$1(t),toBytes$1(e))}const HKDF_COUNTER=new Uint8Array([0]),EMPTY_BUFFER=new Uint8Array;function expand(n,e,t,r=32){if(assert.hash(n),assert.number(r),r>255*n.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/n.outputLen);t===void 0&&(t=EMPTY_BUFFER);const o=new Uint8Array(s*n.outputLen),a=hmac$1.create(n,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)HKDF_COUNTER[0]=u+1,c.update(u===0?EMPTY_BUFFER:l).update(t).update(HKDF_COUNTER).digestInto(l),o.set(l,n.outputLen*u),a._cloneInto(c);return a.destroy(),c.destroy(),l.fill(0),HKDF_COUNTER.fill(0),o.slice(0,r)}var __defProp=Object.defineProperty,__export=(n,e)=>{for(var t in e)__defProp(n,t,{get:e[t],enumerable:!0})},verifiedSymbol=Symbol("verified"),isRecord=n=>n instanceof Object;function validateEvent(n){if(!isRecord(n)||typeof n.kind!="number"||typeof n.content!="string"||typeof n.created_at!="number"||typeof n.pubkey!="string"||!n.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(n.tags))return!1;for(let e=0;e<n.tags.length;e++){let t=n.tags[e];if(!Array.isArray(t))return!1;for(let r=0;r<t.length;r++)if(typeof t[r]=="object")return!1}return!0}var utils_exports={};__export(utils_exports,{Queue:()=>Queue$1,QueueNode:()=>QueueNode,binarySearch:()=>binarySearch,insertEventIntoAscendingList:()=>insertEventIntoAscendingList,insertEventIntoDescendingList:()=>insertEventIntoDescendingList,normalizeURL:()=>normalizeURL,utf8Decoder:()=>utf8Decoder,utf8Encoder:()=>utf8Encoder});var utf8Decoder=new TextDecoder("utf-8"),utf8Encoder=new TextEncoder;function normalizeURL(n){n.indexOf("://")===-1&&(n="wss://"+n);let e=new URL(n);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function insertEventIntoDescendingList(n,e){const[t,r]=binarySearch(n,s=>e.id===s.id?0:e.created_at===s.created_at?-1:s.created_at-e.created_at);return r||n.splice(t,0,e),n}function insertEventIntoAscendingList(n,e){const[t,r]=binarySearch(n,s=>e.id===s.id?0:e.created_at===s.created_at?-1:e.created_at-s.created_at);return r||n.splice(t,0,e),n}function binarySearch(n,e){let t=0,r=n.length-1;for(;t<=r;){const s=Math.floor((t+r)/2),o=e(n[s]);if(o===0)return[s,!0];o<0?r=s-1:t=s+1}return[t,!1]}var QueueNode=class{constructor(n){w(this,"value");w(this,"next",null);w(this,"prev",null);this.value=n}},Queue$1=class{constructor(){w(this,"first");w(this,"last");this.first=null,this.last=null}enqueue(e){const t=new QueueNode(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,e.value}},JS=class{generateSecretKey(){return schnorr$1.utils.randomPrivateKey()}getPublicKey(n){return bytesToHex$2(schnorr$1.getPublicKey(n))}finalizeEvent(n,e){const t=n;return t.pubkey=bytesToHex$2(schnorr$1.getPublicKey(e)),t.id=getEventHash$1(t),t.sig=bytesToHex$2(schnorr$1.sign(getEventHash$1(t),e)),t[verifiedSymbol]=!0,t}verifyEvent(n){if(typeof n[verifiedSymbol]=="boolean")return n[verifiedSymbol];const e=getEventHash$1(n);if(e!==n.id)return n[verifiedSymbol]=!1,!1;try{const t=schnorr$1.verify(n.sig,e,n.pubkey);return n[verifiedSymbol]=t,t}catch{return n[verifiedSymbol]=!1,!1}}};function serializeEvent(n){if(!validateEvent(n))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,n.pubkey,n.created_at,n.kind,n.tags,n.content])}function getEventHash$1(n){let e=sha256$1(utf8Encoder.encode(serializeEvent(n)));return bytesToHex$2(e)}var i=new JS,generateSecretKey=i.generateSecretKey,getPublicKey=i.getPublicKey,finalizeEvent=i.finalizeEvent,verifyEvent=i.verifyEvent,kinds_exports={};__export(kinds_exports,{Application:()=>Application,BadgeAward:()=>BadgeAward,BadgeDefinition:()=>BadgeDefinition,BlockedRelaysList:()=>BlockedRelaysList,BookmarkList:()=>BookmarkList,Bookmarksets:()=>Bookmarksets,Calendar:()=>Calendar,CalendarEventRSVP:()=>CalendarEventRSVP,ChannelCreation:()=>ChannelCreation,ChannelHideMessage:()=>ChannelHideMessage,ChannelMessage:()=>ChannelMessage,ChannelMetadata:()=>ChannelMetadata,ChannelMuteUser:()=>ChannelMuteUser,ClassifiedListing:()=>ClassifiedListing,ClientAuth:()=>ClientAuth,CommunitiesList:()=>CommunitiesList,CommunityDefinition:()=>CommunityDefinition,CommunityPostApproval:()=>CommunityPostApproval,Contacts:()=>Contacts,CreateOrUpdateProduct:()=>CreateOrUpdateProduct,CreateOrUpdateStall:()=>CreateOrUpdateStall,Curationsets:()=>Curationsets,Date:()=>Date2,DirectMessageRelaysList:()=>DirectMessageRelaysList,DraftClassifiedListing:()=>DraftClassifiedListing,DraftLong:()=>DraftLong,Emojisets:()=>Emojisets,EncryptedDirectMessage:()=>EncryptedDirectMessage,EventDeletion:()=>EventDeletion,FileMetadata:()=>FileMetadata,FileServerPreference:()=>FileServerPreference,Followsets:()=>Followsets,GenericRepost:()=>GenericRepost,Genericlists:()=>Genericlists,GiftWrap:()=>GiftWrap,HTTPAuth:()=>HTTPAuth,Handlerinformation:()=>Handlerinformation,Handlerrecommendation:()=>Handlerrecommendation,Highlights:()=>Highlights,InterestsList:()=>InterestsList,Interestsets:()=>Interestsets,JobFeedback:()=>JobFeedback,JobRequest:()=>JobRequest,JobResult:()=>JobResult,Label:()=>Label,LightningPubRPC:()=>LightningPubRPC,LiveChatMessage:()=>LiveChatMessage,LiveEvent:()=>LiveEvent,LongFormArticle:()=>LongFormArticle,Metadata:()=>Metadata,Mutelist:()=>Mutelist,NWCWalletInfo:()=>NWCWalletInfo,NWCWalletRequest:()=>NWCWalletRequest,NWCWalletResponse:()=>NWCWalletResponse,NostrConnect:()=>NostrConnect,OpenTimestamps:()=>OpenTimestamps,Pinlist:()=>Pinlist,PrivateDirectMessage:()=>PrivateDirectMessage,ProblemTracker:()=>ProblemTracker,ProfileBadges:()=>ProfileBadges,PublicChatsList:()=>PublicChatsList,Reaction:()=>Reaction,RecommendRelay:()=>RecommendRelay,RelayList:()=>RelayList,Relaysets:()=>Relaysets,Report:()=>Report,Reporting:()=>Reporting,Repost:()=>Repost,Seal:()=>Seal,SearchRelaysList:()=>SearchRelaysList,ShortTextNote:()=>ShortTextNote,Time:()=>Time,UserEmojiList:()=>UserEmojiList,UserStatuses:()=>UserStatuses,Zap:()=>Zap,ZapGoal:()=>ZapGoal,ZapRequest:()=>ZapRequest,classifyKind:()=>classifyKind,isEphemeralKind:()=>isEphemeralKind,isKind:()=>isKind,isParameterizedReplaceableKind:()=>isParameterizedReplaceableKind,isRegularKind:()=>isRegularKind,isReplaceableKind:()=>isReplaceableKind});function isRegularKind(n){return 1e3<=n&&n<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(n)}function isReplaceableKind(n){return[0,3].includes(n)||1e4<=n&&n<2e4}function isEphemeralKind(n){return 2e4<=n&&n<3e4}function isParameterizedReplaceableKind(n){return 3e4<=n&&n<4e4}function classifyKind(n){return isRegularKind(n)?"regular":isReplaceableKind(n)?"replaceable":isEphemeralKind(n)?"ephemeral":isParameterizedReplaceableKind(n)?"parameterized":"unknown"}function isKind(n,e){const t=e instanceof Array?e:[e];return validateEvent(n)&&t.includes(n.kind)||!1}var Metadata=0,ShortTextNote=1,RecommendRelay=2,Contacts=3,EncryptedDirectMessage=4,EventDeletion=5,Repost=6,Reaction=7,BadgeAward=8,Seal=13,PrivateDirectMessage=14,GenericRepost=16,ChannelCreation=40,ChannelMetadata=41,ChannelMessage=42,ChannelHideMessage=43,ChannelMuteUser=44,OpenTimestamps=1040,GiftWrap=1059,FileMetadata=1063,LiveChatMessage=1311,ProblemTracker=1971,Report=1984,Reporting=1984,Label=1985,CommunityPostApproval=4550,JobRequest=5999,JobResult=6999,JobFeedback=7e3,ZapGoal=9041,ZapRequest=9734,Zap=9735,Highlights=9802,Mutelist=1e4,Pinlist=10001,RelayList=10002,BookmarkList=10003,CommunitiesList=10004,PublicChatsList=10005,BlockedRelaysList=10006,SearchRelaysList=10007,InterestsList=10015,UserEmojiList=10030,DirectMessageRelaysList=10050,FileServerPreference=10096,NWCWalletInfo=13194,LightningPubRPC=21e3,ClientAuth=22242,NWCWalletRequest=23194,NWCWalletResponse=23195,NostrConnect=24133,HTTPAuth=27235,Followsets=3e4,Genericlists=30001,Relaysets=30002,Bookmarksets=30003,Curationsets=30004,ProfileBadges=30008,BadgeDefinition=30009,Interestsets=30015,CreateOrUpdateStall=30017,CreateOrUpdateProduct=30018,LongFormArticle=30023,DraftLong=30024,Emojisets=30030,Application=30078,LiveEvent=30311,UserStatuses=30315,ClassifiedListing=30402,DraftClassifiedListing=30403,Date2=31922,Time=31923,Calendar=31924,CalendarEventRSVP=31925,Handlerrecommendation=31989,Handlerinformation=31990,CommunityDefinition=34550;function matchFilter(n,e){if(n.ids&&n.ids.indexOf(e.id)===-1||n.kinds&&n.kinds.indexOf(e.kind)===-1||n.authors&&n.authors.indexOf(e.pubkey)===-1)return!1;for(let t in n)if(t[0]==="#"){let r=t.slice(1),s=n[`#${r}`];if(s&&!e.tags.find(([o,a])=>o===t.slice(1)&&s.indexOf(a)!==-1))return!1}return!(n.since&&e.created_at<n.since||n.until&&e.created_at>n.until)}function matchFilters(n,e){for(let t=0;t<n.length;t++)if(matchFilter(n[t],e))return!0;return!1}var fakejson_exports={};__export(fakejson_exports,{getHex64:()=>getHex64,getInt:()=>getInt,getSubscriptionId:()=>getSubscriptionId,matchEventId:()=>matchEventId,matchEventKind:()=>matchEventKind,matchEventPubkey:()=>matchEventPubkey});function getHex64(n,e){let t=e.length+3,r=n.indexOf(`"${e}":`)+t,s=n.slice(r).indexOf('"')+r+1;return n.slice(s,s+64)}function getInt(n,e){let t=e.length,r=n.indexOf(`"${e}":`)+t+3,s=n.slice(r),o=Math.min(s.indexOf(","),s.indexOf("}"));return parseInt(s.slice(0,o),10)}function getSubscriptionId(n){let e=n.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let t=n.slice(e+7+1).indexOf('"');if(t===-1)return null;let r=e+7+1+t,s=n.slice(r+1,80).indexOf('"');if(s===-1)return null;let o=r+1+s;return n.slice(r+1,o)}function matchEventId(n,e){return e===getHex64(n,"id")}function matchEventPubkey(n,e){return e===getHex64(n,"pubkey")}function matchEventKind(n,e){return e===getInt(n,"kind")}var nip42_exports={};__export(nip42_exports,{makeAuthEvent:()=>makeAuthEvent});function makeAuthEvent(n,e){return{kind:ClientAuth,created_at:Math.floor(Date.now()/1e3),tags:[["relay",n],["challenge",e]],content:""}}var _WebSocket;try{_WebSocket=WebSocket}catch{}var _WebSocket2;try{_WebSocket2=WebSocket}catch{}var nip19_exports={};__export(nip19_exports,{BECH32_REGEX:()=>BECH32_REGEX$1,Bech32MaxSize:()=>Bech32MaxSize,NostrTypeGuard:()=>NostrTypeGuard,decode:()=>decode,encodeBytes:()=>encodeBytes,naddrEncode:()=>naddrEncode,neventEncode:()=>neventEncode,noteEncode:()=>noteEncode,nprofileEncode:()=>nprofileEncode,npubEncode:()=>npubEncode,nsecEncode:()=>nsecEncode});var NostrTypeGuard={isNProfile:n=>/^nprofile1[a-z\d]+$/.test(n||""),isNEvent:n=>/^nevent1[a-z\d]+$/.test(n||""),isNAddr:n=>/^naddr1[a-z\d]+$/.test(n||""),isNSec:n=>/^nsec1[a-z\d]{58}$/.test(n||""),isNPub:n=>/^npub1[a-z\d]{58}$/.test(n||""),isNote:n=>/^note1[a-z\d]+$/.test(n||""),isNcryptsec:n=>/^ncryptsec1[a-z\d]+$/.test(n||"")},Bech32MaxSize=5e3,BECH32_REGEX$1=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function integerToUint8Array(n){const e=new Uint8Array(4);return e[0]=n>>24&255,e[1]=n>>16&255,e[2]=n>>8&255,e[3]=n&255,e}function decode(n){var s,o,a,c,l,u,f;let{prefix:e,words:t}=bech32$1.decode(n,Bech32MaxSize),r=new Uint8Array(bech32$1.fromWords(t));switch(e){case"nprofile":{let h=parseTLV(r);if(!((s=h[0])!=null&&s[0]))throw new Error("missing TLV 0 for nprofile");if(h[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:bytesToHex$2(h[0][0]),relays:h[1]?h[1].map(p=>utf8Decoder.decode(p)):[]}}}case"nevent":{let h=parseTLV(r);if(!((o=h[0])!=null&&o[0]))throw new Error("missing TLV 0 for nevent");if(h[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(h[2]&&h[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(h[3]&&h[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:bytesToHex$2(h[0][0]),relays:h[1]?h[1].map(p=>utf8Decoder.decode(p)):[],author:(a=h[2])!=null&&a[0]?bytesToHex$2(h[2][0]):void 0,kind:(c=h[3])!=null&&c[0]?parseInt(bytesToHex$2(h[3][0]),16):void 0}}}case"naddr":{let h=parseTLV(r);if(!((l=h[0])!=null&&l[0]))throw new Error("missing TLV 0 for naddr");if(!((u=h[2])!=null&&u[0]))throw new Error("missing TLV 2 for naddr");if(h[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((f=h[3])!=null&&f[0]))throw new Error("missing TLV 3 for naddr");if(h[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:utf8Decoder.decode(h[0][0]),pubkey:bytesToHex$2(h[2][0]),kind:parseInt(bytesToHex$2(h[3][0]),16),relays:h[1]?h[1].map(p=>utf8Decoder.decode(p)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:bytesToHex$2(r)};default:throw new Error(`unknown prefix ${e}`)}}function parseTLV(n){let e={},t=n;for(;t.length>0;){let r=t[0],s=t[1],o=t.slice(2,2+s);if(t=t.slice(2+s),o.length<s)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(o)}return e}function nsecEncode(n){return encodeBytes("nsec",n)}function npubEncode(n){return encodeBytes("npub",hexToBytes$2(n))}function noteEncode(n){return encodeBytes("note",hexToBytes$2(n))}function encodeBech32(n,e){let t=bech32$1.toWords(e);return bech32$1.encode(n,t,Bech32MaxSize)}function encodeBytes(n,e){return encodeBech32(n,e)}function nprofileEncode(n){let e=encodeTLV({0:[hexToBytes$2(n.pubkey)],1:(n.relays||[]).map(t=>utf8Encoder.encode(t))});return encodeBech32("nprofile",e)}function neventEncode(n){let e;n.kind!==void 0&&(e=integerToUint8Array(n.kind));let t=encodeTLV({0:[hexToBytes$2(n.id)],1:(n.relays||[]).map(r=>utf8Encoder.encode(r)),2:n.author?[hexToBytes$2(n.author)]:[],3:e?[new Uint8Array(e)]:[]});return encodeBech32("nevent",t)}function naddrEncode(n){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,n.kind,!1);let t=encodeTLV({0:[utf8Encoder.encode(n.identifier)],1:(n.relays||[]).map(r=>utf8Encoder.encode(r)),2:[hexToBytes$2(n.pubkey)],3:[new Uint8Array(e)]});return encodeBech32("naddr",t)}function encodeTLV(n){let e=[];return Object.entries(n).reverse().forEach(([t,r])=>{r.forEach(s=>{let o=new Uint8Array(s.length+2);o.set([parseInt(t)],0),o.set([s.length],1),o.set(s,2),e.push(o)})}),concatBytes$2(...e)}var nip04_exports={};__export(nip04_exports,{decrypt:()=>decrypt$1,encrypt:()=>encrypt$1});async function encrypt$1(n,e,t){const r=n instanceof Uint8Array?bytesToHex$2(n):n,s=secp256k1$1.getSharedSecret(r,"02"+e),o=getNormalizedX(s);let a=Uint8Array.from(randomBytes$1(16)),c=utf8Encoder.encode(t),l=cbc(o,a).encrypt(c),u=base64.encode(new Uint8Array(l)),f=base64.encode(new Uint8Array(a.buffer));return`${u}?iv=${f}`}async function decrypt$1(n,e,t){const r=n instanceof Uint8Array?bytesToHex$2(n):n;let[s,o]=t.split("?iv="),a=secp256k1$1.getSharedSecret(r,"02"+e),c=getNormalizedX(a),l=base64.decode(o),u=base64.decode(s),f=cbc(c,l).decrypt(u);return utf8Decoder.decode(f)}function getNormalizedX(n){return n.slice(1,33)}var nip05_exports={};__export(nip05_exports,{NIP05_REGEX:()=>NIP05_REGEX$1,isNip05:()=>isNip05,isValid:()=>isValid,queryProfile:()=>queryProfile,searchDomain:()=>searchDomain,useFetchImplementation:()=>useFetchImplementation});var NIP05_REGEX$1=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,isNip05=n=>NIP05_REGEX$1.test(n||""),_fetch;try{_fetch=fetch}catch{}function useFetchImplementation(n){_fetch=n}async function searchDomain(n,e=""){try{const t=`https://${n}/.well-known/nostr.json?name=${e}`,r=await _fetch(t,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function queryProfile(n){var s;const e=n.match(NIP05_REGEX$1);if(!e)return null;const[,t="_",r]=e;try{const o=`https://${r}/.well-known/nostr.json?name=${t}`,a=await _fetch(o,{redirect:"manual"});if(a.status!==200)throw Error("Wrong response code");const c=await a.json(),l=c.names[t];return l?{pubkey:l,relays:(s=c.relays)==null?void 0:s[l]}:null}catch{return null}}async function isValid(n,e){const t=await queryProfile(e);return t?t.pubkey===n:!1}var nip10_exports={};__export(nip10_exports,{parse:()=>parse});function parse(n){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let t,r;for(let s=n.tags.length-1;s>=0;s--){const o=n.tags[s];if(o[0]==="e"&&o[1]){const[a,c,l,u,f]=o,h={id:c,relays:l?[l]:[],author:f};if(u==="root"){e.root=h;continue}if(u==="reply"){e.reply=h;continue}if(u==="mention"){e.mentions.push(h);continue}t?r=h:t=h,e.mentions.push(h);continue}if(o[0]==="q"&&o[1]){const[a,c,l]=o;e.quotes.push({id:c,relays:l?[l]:[]})}if(o[0]==="p"&&o[1]){e.profiles.push({pubkey:o[1],relays:o[2]?[o[2]]:[]});continue}}return e.root||(e.root=r||t||e.reply),e.reply||(e.reply=t||e.root),[e.reply,e.root].forEach(s=>{if(!s)return;let o=e.mentions.indexOf(s);if(o!==-1&&e.mentions.splice(o,1),s.author){let a=e.profiles.find(c=>c.pubkey===s.author);a&&a.relays&&(s.relays||(s.relays=[]),a.relays.forEach(c=>{var l;((l=s.relays)==null?void 0:l.indexOf(c))===-1&&s.relays.push(c)}),a.relays=s.relays)}}),e.mentions.forEach(s=>{if(s.author){let o=e.profiles.find(a=>a.pubkey===s.author);o&&o.relays&&(s.relays||(s.relays=[]),o.relays.forEach(a=>{s.relays.indexOf(a)===-1&&s.relays.push(a)}),o.relays=s.relays)}}),e}var nip11_exports={};__export(nip11_exports,{fetchRelayInformation:()=>fetchRelayInformation,useFetchImplementation:()=>useFetchImplementation2});var _fetch2;try{_fetch2=fetch}catch{}function useFetchImplementation2(n){_fetch2=n}async function fetchRelayInformation(n){return await(await fetch(n.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var nip13_exports={};__export(nip13_exports,{fastEventHash:()=>fastEventHash,getPow:()=>getPow,minePow:()=>minePow});function getPow(n){let e=0;for(let t=0;t<64;t+=8){const r=parseInt(n.substring(t,t+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function minePow(n,e){let t=0;const r=n,s=["nonce",t.toString(),e.toString()];for(r.tags.push(s);;){const o=Math.floor(new Date().getTime()/1e3);if(o!==r.created_at&&(t=0,r.created_at=o),s[1]=(++t).toString(),r.id=fastEventHash(r),getPow(r.id)>=e)break}return r}function fastEventHash(n){return bytesToHex$2(sha256$1(utf8Encoder.encode(JSON.stringify([0,n.pubkey,n.created_at,n.kind,n.tags,n.content]))))}var nip18_exports={};__export(nip18_exports,{finishRepostEvent:()=>finishRepostEvent,getRepostedEvent:()=>getRepostedEvent,getRepostedEventPointer:()=>getRepostedEventPointer});function finishRepostEvent(n,e,t,r){return finalizeEvent({kind:Repost,tags:[...n.tags??[],["e",e.id,t],["p",e.pubkey]],content:n.content===""?"":JSON.stringify(e),created_at:n.created_at},r)}function getRepostedEventPointer(n){if(n.kind!==Repost)return;let e,t;for(let r=n.tags.length-1;r>=0&&(e===void 0||t===void 0);r--){const s=n.tags[r];s.length>=2&&(s[0]==="e"&&e===void 0?e=s:s[0]==="p"&&t===void 0&&(t=s))}if(e!==void 0)return{id:e[1],relays:[e[2],t==null?void 0:t[2]].filter(r=>typeof r=="string"),author:t==null?void 0:t[1]}}function getRepostedEvent(n,{skipVerification:e}={}){const t=getRepostedEventPointer(n);if(t===void 0||n.content==="")return;let r;try{r=JSON.parse(n.content)}catch{return}if(r.id===t.id&&!(!e&&!verifyEvent(r)))return r}var nip21_exports={};__export(nip21_exports,{NOSTR_URI_REGEX:()=>NOSTR_URI_REGEX,parse:()=>parse2,test:()=>test});var NOSTR_URI_REGEX=new RegExp(`nostr:(${BECH32_REGEX$1.source})`);function test(n){return typeof n=="string"&&new RegExp(`^${NOSTR_URI_REGEX.source}$`).test(n)}function parse2(n){const e=n.match(new RegExp(`^${NOSTR_URI_REGEX.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${n}`);return{uri:e[0],value:e[1],decoded:decode(e[1])}}var nip25_exports={};__export(nip25_exports,{finishReactionEvent:()=>finishReactionEvent,getReactedEventPointer:()=>getReactedEventPointer});function finishReactionEvent(n,e,t){const r=e.tags.filter(s=>s.length>=2&&(s[0]==="e"||s[0]==="p"));return finalizeEvent({...n,kind:Reaction,tags:[...n.tags??[],...r,["e",e.id],["p",e.pubkey]],content:n.content??"+"},t)}function getReactedEventPointer(n){if(n.kind!==Reaction)return;let e,t;for(let r=n.tags.length-1;r>=0&&(e===void 0||t===void 0);r--){const s=n.tags[r];s.length>=2&&(s[0]==="e"&&e===void 0?e=s:s[0]==="p"&&t===void 0&&(t=s))}if(!(e===void 0||t===void 0))return{id:e[1],relays:[e[2],t[2]].filter(r=>r!==void 0),author:t[1]}}var nip27_exports={};__export(nip27_exports,{matchAll:()=>matchAll,regex:()=>regex,replaceAll:()=>replaceAll});var regex=()=>new RegExp(`\\b${NOSTR_URI_REGEX.source}\\b`,"g");function*matchAll(n){const e=n.matchAll(regex());for(const t of e)try{const[r,s]=t;yield{uri:r,value:s,decoded:decode(s),start:t.index,end:t.index+r.length}}catch{}}function replaceAll(n,e){return n.replaceAll(regex(),(t,r)=>e({uri:t,value:r,decoded:decode(r)}))}var nip28_exports={};__export(nip28_exports,{channelCreateEvent:()=>channelCreateEvent,channelHideMessageEvent:()=>channelHideMessageEvent,channelMessageEvent:()=>channelMessageEvent,channelMetadataEvent:()=>channelMetadataEvent,channelMuteUserEvent:()=>channelMuteUserEvent});var channelCreateEvent=(n,e)=>{let t;if(typeof n.content=="object")t=JSON.stringify(n.content);else if(typeof n.content=="string")t=n.content;else return;return finalizeEvent({kind:ChannelCreation,tags:[...n.tags??[]],content:t,created_at:n.created_at},e)},channelMetadataEvent=(n,e)=>{let t;if(typeof n.content=="object")t=JSON.stringify(n.content);else if(typeof n.content=="string")t=n.content;else return;return finalizeEvent({kind:ChannelMetadata,tags:[["e",n.channel_create_event_id],...n.tags??[]],content:t,created_at:n.created_at},e)},channelMessageEvent=(n,e)=>{const t=[["e",n.channel_create_event_id,n.relay_url,"root"]];return n.reply_to_channel_message_event_id&&t.push(["e",n.reply_to_channel_message_event_id,n.relay_url,"reply"]),finalizeEvent({kind:ChannelMessage,tags:[...t,...n.tags??[]],content:n.content,created_at:n.created_at},e)},channelHideMessageEvent=(n,e)=>{let t;if(typeof n.content=="object")t=JSON.stringify(n.content);else if(typeof n.content=="string")t=n.content;else return;return finalizeEvent({kind:ChannelHideMessage,tags:[["e",n.channel_message_event_id],...n.tags??[]],content:t,created_at:n.created_at},e)},channelMuteUserEvent=(n,e)=>{let t;if(typeof n.content=="object")t=JSON.stringify(n.content);else if(typeof n.content=="string")t=n.content;else return;return finalizeEvent({kind:ChannelMuteUser,tags:[["p",n.pubkey_to_mute],...n.tags??[]],content:t,created_at:n.created_at},e)},nip30_exports={};__export(nip30_exports,{EMOJI_SHORTCODE_REGEX:()=>EMOJI_SHORTCODE_REGEX,matchAll:()=>matchAll2,regex:()=>regex2,replaceAll:()=>replaceAll2});var EMOJI_SHORTCODE_REGEX=/:(\w+):/,regex2=()=>new RegExp(`\\B${EMOJI_SHORTCODE_REGEX.source}\\B`,"g");function*matchAll2(n){const e=n.matchAll(regex2());for(const t of e)try{const[r,s]=t;yield{shortcode:r,name:s,start:t.index,end:t.index+r.length}}catch{}}function replaceAll2(n,e){return n.replaceAll(regex2(),(t,r)=>e({shortcode:t,name:r}))}var nip39_exports={};__export(nip39_exports,{useFetchImplementation:()=>useFetchImplementation3,validateGithub:()=>validateGithub});var _fetch3;try{_fetch3=fetch}catch{}function useFetchImplementation3(n){_fetch3=n}async function validateGithub(n,e,t){try{return await(await _fetch3(`https://gist.github.com/${e}/${t}/raw`)).text()===`Verifying that I control the following Nostr public key: ${n}`}catch{return!1}}var nip44_exports={};__export(nip44_exports,{decrypt:()=>decrypt2,encrypt:()=>encrypt2,getConversationKey:()=>getConversationKey,v2:()=>v2});var minPlaintextSize=1,maxPlaintextSize=65535;function getConversationKey(n,e){const t=secp256k1$1.getSharedSecret(n,"02"+e).subarray(1,33);return extract(sha256$1,t,"nip44-v2")}function getMessageKeys(n,e){const t=expand(sha256$1,n,e,76);return{chacha_key:t.subarray(0,32),chacha_nonce:t.subarray(32,44),hmac_key:t.subarray(44,76)}}function calcPaddedLen(n){if(!Number.isSafeInteger(n)||n<1)throw new Error("expected positive integer");if(n<=32)return 32;const e=1<<Math.floor(Math.log2(n-1))+1,t=e<=256?32:e/8;return t*(Math.floor((n-1)/t)+1)}function writeU16BE(n){if(!Number.isSafeInteger(n)||n<minPlaintextSize||n>maxPlaintextSize)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,n,!1),e}function pad(n){const e=utf8Encoder.encode(n),t=e.length,r=writeU16BE(t),s=new Uint8Array(calcPaddedLen(t)-t);return concatBytes$2(r,e,s)}function unpad(n){const e=new DataView(n.buffer).getUint16(0),t=n.subarray(2,2+e);if(e<minPlaintextSize||e>maxPlaintextSize||t.length!==e||n.length!==2+calcPaddedLen(e))throw new Error("invalid padding");return utf8Decoder.decode(t)}function hmacAad(n,e,t){if(t.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=concatBytes$2(t,e);return hmac$1(sha256$1,n,r)}function decodePayload(n){if(typeof n!="string")throw new Error("payload must be a valid string");const e=n.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(n[0]==="#")throw new Error("unknown encryption version");let t;try{t=base64.decode(n)}catch(o){throw new Error("invalid base64: "+o.message)}const r=t.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const s=t[0];if(s!==2)throw new Error("unknown encryption version "+s);return{nonce:t.subarray(1,33),ciphertext:t.subarray(33,-32),mac:t.subarray(-32)}}function encrypt2(n,e,t=randomBytes$1(32)){const{chacha_key:r,chacha_nonce:s,hmac_key:o}=getMessageKeys(e,t),a=pad(n),c=chacha20(r,s,a),l=hmacAad(o,c,t);return base64.encode(concatBytes$2(new Uint8Array([2]),t,c,l))}function decrypt2(n,e){const{nonce:t,ciphertext:r,mac:s}=decodePayload(n),{chacha_key:o,chacha_nonce:a,hmac_key:c}=getMessageKeys(e,t),l=hmacAad(c,r,t);if(!equalBytes$1(l,s))throw new Error("invalid MAC");const u=chacha20(o,a,r);return unpad(u)}var v2={utils:{getConversationKey,calcPaddedLen},encrypt:encrypt2,decrypt:decrypt2},nip47_exports={};__export(nip47_exports,{makeNwcRequestEvent:()=>makeNwcRequestEvent,parseConnectionString:()=>parseConnectionString});function parseConnectionString(n){const{pathname:e,searchParams:t}=new URL(n),r=e,s=t.get("relay"),o=t.get("secret");if(!r||!s||!o)throw new Error("invalid connection string");return{pubkey:r,relay:s,secret:o}}async function makeNwcRequestEvent(n,e,t){const s=await encrypt$1(e,n,JSON.stringify({method:"pay_invoice",params:{invoice:t}})),o={kind:NWCWalletRequest,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",n]]};return finalizeEvent(o,e)}var nip57_exports={};__export(nip57_exports,{getZapEndpoint:()=>getZapEndpoint,makeZapReceipt:()=>makeZapReceipt,makeZapRequest:()=>makeZapRequest,useFetchImplementation:()=>useFetchImplementation4,validateZapRequest:()=>validateZapRequest});var _fetch4;try{_fetch4=fetch}catch{}function useFetchImplementation4(n){_fetch4=n}async function getZapEndpoint(n){try{let e="",{lud06:t,lud16:r}=JSON.parse(n.content);if(t){let{words:a}=bech32$1.decode(t,1e3),c=bech32$1.fromWords(a);e=utf8Decoder.decode(c)}else if(r){let[a,c]=r.split("@");e=new URL(`/.well-known/lnurlp/${a}`,`https://${c}`).toString()}else return null;let o=await(await _fetch4(e)).json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch{}return null}function makeZapRequest({profile:n,event:e,amount:t,relays:r,comment:s=""}){if(!t)throw new Error("amount not given");if(!n)throw new Error("profile not given");let o={kind:9734,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",n],["amount",t.toString()],["relays",...r]]};return e&&o.tags.push(["e",e]),o}function validateZapRequest(n){let e;try{e=JSON.parse(n)}catch{return"Invalid zap request JSON."}if(!validateEvent(e))return"Zap request is not a valid Nostr event.";if(!verifyEvent(e))return"Invalid signature on zap request.";let t=e.tags.find(([o,a])=>o==="p"&&a);if(!t)return"Zap request doesn't have a 'p' tag.";if(!t[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([o,a])=>o==="e"&&a);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([o,a])=>o==="relays"&&a)?null:"Zap request doesn't have a 'relays' tag."}function makeZapReceipt({zapRequest:n,preimage:e,bolt11:t,paidAt:r}){let s=JSON.parse(n),o=s.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),a={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...o,["P",s.pubkey],["bolt11",t],["description",n]]};return e&&a.tags.push(["preimage",e]),a}var nip59_exports={};__export(nip59_exports,{createRumor:()=>createRumor,createSeal:()=>createSeal,createWrap:()=>createWrap,unwrapEvent:()=>unwrapEvent,unwrapManyEvents:()=>unwrapManyEvents,wrapEvent:()=>wrapEvent,wrapManyEvents:()=>wrapManyEvents});var TWO_DAYS=2*24*60*60,now=()=>Math.round(Date.now()/1e3),randomNow=()=>Math.round(now()-Math.random()*TWO_DAYS),nip44ConversationKey=(n,e)=>getConversationKey(n,e),nip44Encrypt=(n,e,t)=>encrypt2(JSON.stringify(n),nip44ConversationKey(e,t)),nip44Decrypt=(n,e)=>JSON.parse(decrypt2(n.content,nip44ConversationKey(e,n.pubkey)));function createRumor(n,e){const t={created_at:now(),content:"",tags:[],...n,pubkey:getPublicKey(e)};return t.id=getEventHash$1(t),t}function createSeal(n,e,t){return finalizeEvent({kind:Seal,content:nip44Encrypt(n,e,t),created_at:randomNow(),tags:[]},e)}function createWrap(n,e){const t=generateSecretKey();return finalizeEvent({kind:GiftWrap,content:nip44Encrypt(n,t,e),created_at:randomNow(),tags:[["p",e]]},t)}function wrapEvent(n,e,t){const r=createRumor(n,e),s=createSeal(r,e,t);return createWrap(s,t)}function wrapManyEvents(n,e,t){if(!t||t.length===0)throw new Error("At least one recipient is required.");const r=getPublicKey(e),s=[wrapEvent(n,e,r)];return t.forEach(o=>{s.push(wrapEvent(n,e,o))}),s}function unwrapEvent(n,e){const t=nip44Decrypt(n,e);return nip44Decrypt(t,e)}function unwrapManyEvents(n,e){let t=[];return n.forEach(r=>{t.push(unwrapEvent(r,e))}),t.sort((r,s)=>r.created_at-s.created_at),t}var nip98_exports={};__export(nip98_exports,{getToken:()=>getToken,hashPayload:()=>hashPayload,unpackEventFromToken:()=>unpackEventFromToken,validateEvent:()=>validateEvent2,validateEventKind:()=>validateEventKind,validateEventMethodTag:()=>validateEventMethodTag,validateEventPayloadTag:()=>validateEventPayloadTag,validateEventTimestamp:()=>validateEventTimestamp,validateEventUrlTag:()=>validateEventUrlTag,validateToken:()=>validateToken});var _authorizationScheme="Nostr ";async function getToken(n,e,t,r=!1,s){const o={kind:HTTPAuth,tags:[["u",n],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};s&&o.tags.push(["payload",hashPayload(s)]);const a=await t(o);return(r?_authorizationScheme:"")+base64.encode(utf8Encoder.encode(JSON.stringify(a)))}async function validateToken(n,e,t){const r=await unpackEventFromToken(n).catch(o=>{throw o});return await validateEvent2(r,e,t).catch(o=>{throw o})}async function unpackEventFromToken(n){if(!n)throw new Error("Missing token");n=n.replace(_authorizationScheme,"");const e=utf8Decoder.decode(base64.decode(n));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function validateEventTimestamp(n){return n.created_at?Math.round(new Date().getTime()/1e3)-n.created_at<60:!1}function validateEventKind(n){return n.kind===HTTPAuth}function validateEventUrlTag(n,e){const t=n.tags.find(r=>r[0]==="u");return t?t.length>0&&t[1]===e:!1}function validateEventMethodTag(n,e){const t=n.tags.find(r=>r[0]==="method");return t?t.length>0&&t[1].toLowerCase()===e.toLowerCase():!1}function hashPayload(n){const e=sha256$1(utf8Encoder.encode(JSON.stringify(n)));return bytesToHex$2(e)}function validateEventPayloadTag(n,e){const t=n.tags.find(s=>s[0]==="payload");if(!t)return!1;const r=hashPayload(e);return t.length>0&&t[1]===r}async function validateEvent2(n,e,t,r){if(!verifyEvent(n))throw new Error("Invalid nostr event, signature invalid");if(!validateEventKind(n))throw new Error("Invalid nostr event, kind invalid");if(!validateEventTimestamp(n))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!validateEventUrlTag(n,e))throw new Error("Invalid nostr event, url tag invalid");if(!validateEventMethodTag(n,t))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!validateEventPayloadTag(n,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const crypto$1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function number(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`positive integer expected, not ${n}`)}function isBytes$2(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function bytes(n,...e){if(!isBytes$2(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${n.length}`)}function hash$1(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");number(n.outputLen),number(n.blockLen)}function exists(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function output(n,e){bytes(n);const t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const createView=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),rotr=(n,e)=>n<<32-e|n>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const hexes$1=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function bytesToHex$1(n){bytes(n);let e="";for(let t=0;t<n.length;t++)e+=hexes$1[n[t]];return e}const asciis$1={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16$1(n){if(n>=asciis$1._0&&n<=asciis$1._9)return n-asciis$1._0;if(n>=asciis$1._A&&n<=asciis$1._F)return n-(asciis$1._A-10);if(n>=asciis$1._a&&n<=asciis$1._f)return n-(asciis$1._a-10)}function hexToBytes$1(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length,t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,o=0;s<t;s++,o+=2){const a=asciiToBase16$1(n.charCodeAt(o)),c=asciiToBase16$1(n.charCodeAt(o+1));if(a===void 0||c===void 0){const l=n[o]+n[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}r[s]=a*16+c}return r}function utf8ToBytes$1(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function toBytes(n){return typeof n=="string"&&(n=utf8ToBytes$1(n)),bytes(n),n}function concatBytes$1(...n){let e=0;for(let r=0;r<n.length;r++){const s=n[r];bytes(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<n.length;r++){const o=n[r];t.set(o,s),s+=o.length}return t}class Hash{clone(){return this._cloneInto()}}function wrapConstructor(n){const e=r=>n().update(toBytes(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function randomBytes(n=32){if(crypto$1&&typeof crypto$1.getRandomValues=="function")return crypto$1.getRandomValues(new Uint8Array(n));if(crypto$1&&typeof crypto$1.randomBytes=="function")return crypto$1.randomBytes(n);throw new Error("crypto.getRandomValues must be defined")}var lib$1={},types={};Object.defineProperty(types,"__esModule",{value:!0});var ee={},taskCollection$1={},taskCollection={},utils$1={};Object.defineProperty(utils$1,"__esModule",{value:!0});utils$1._fast_remove_single=void 0;function _fast_remove_single(n,e){e!==-1&&(e===0?n.shift():e===n.length-1?n.length=n.length-1:n.splice(e,1))}utils$1._fast_remove_single=_fast_remove_single;var bakeCollection={};(function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(n){var e="";if(n===0)return e;for(var t=0;t<n-1;++t)e+="arg"+String(t)+", ";return e+="arg"+String(n-1),e}function generateBodyPartsCode(n,e){for(var t="",r="",s=0;s<e;++s)t+="var f".concat(s," = collection[").concat(s,`];
`),r+="f".concat(s,"(").concat(n,`)
`);return{funcDefCode:t,funcCallCode:r}}function generateBodyPartsVariadicCode(n){for(var e="",t="",r=0;r<n;++r)e+="var f".concat(r," = collection[").concat(r,`];
`),t+="f".concat(r,`.apply(undefined, arguments)
`);return{funcDefCode:e,funcCallCode:t}}function bakeCollection(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                `).concat(funcCallCode,`
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);collection.length%10===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 10) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                        collection[i+4](`).concat(argsDefCode,`);
                        collection[i+5](`).concat(argsDefCode,`);
                        collection[i+6](`).concat(argsDefCode,`);
                        collection[i+7](`).concat(argsDefCode,`);
                        collection[i+8](`).concat(argsDefCode,`);
                        collection[i+9](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%4===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 4) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                        collection[i+3](`).concat(argsDefCode,`);
                    }
                });
            })`):collection.length%3===0?funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; i += 3) {
                        collection[i](`).concat(argsDefCode,`);
                        collection[i+1](`).concat(argsDefCode,`);
                        collection[i+2](`).concat(argsDefCode,`);
                    }
                });
            })`):funcFactoryCode=`(function(collection) {
                return (function(`.concat(argsDefCode,`) {
                    for (var i = 0; i < collection.length; ++i) {
                        collection[i](`).concat(argsDefCode,`);
                    }
                });
            })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollection=bakeCollection;function bakeCollectionAwait(collection,fixedArgsNum){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function(`).concat(argsDefCode,`) {
                return Promise.all([ `).concat(funcCallCode,` ]);
            });
        })`)}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=`(function(collection) {
            return (function(`.concat(argsDefCode,`) {
                var promises = Array(collection.length);
                for (var i = 0; i < collection.length; ++i) {
                    promises[i] = collection[i](`).concat(argsDefCode,`);
                }
                return Promise.all(promises);
            });
        })`)}{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionAwait=bakeCollectionAwait;function bakeCollectionVariadic(collection){if(collection.length===0)return exports.BAKED_EMPTY_FUNC;if(collection.length===1)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode=`(function(collection) {
            `.concat(funcDefCode,`
            collection = undefined;
            return (function() {
                `).concat(funcCallCode,`
            });
        })`)}else funcFactoryCode=`(function(collection) {
            return (function() {
                for (var i = 0; i < collection.length; ++i) {
                    collection[i].apply(undefined, arguments);
                }
            });
        })`;{var funcFactory=eval(funcFactoryCode);return funcFactory(collection)}}exports.bakeCollectionVariadic=bakeCollectionVariadic})(bakeCollection);var __spreadArray$1=commonjsGlobal&&commonjsGlobal.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(taskCollection,"__esModule",{value:!0});taskCollection.TaskCollection=void 0;var utils_1$1=utils$1,bake_collection_1=bakeCollection;function push_norebuild(n,e){var t=this.length;if(t>1)if(e){var r;(r=this._tasks).push.apply(r,arguments),this.length+=arguments.length}else this._tasks.push(n),this.length++;else if(e){if(t===1){var s=Array(1+arguments.length);s.push(s),s.push.apply(s,arguments),this._tasks=s}else{var s=Array(arguments.length);s.push.apply(s,arguments),this._tasks=s}this.length+=arguments.length}else t===1?this._tasks=[this._tasks,n]:this._tasks=n,this.length++}function push_rebuild(n,e){var t=this.length;if(t>1)if(e){var r;(r=this._tasks).push.apply(r,arguments),this.length+=arguments.length}else this._tasks.push(n),this.length++;else if(e){if(t===1){var s=Array(1+arguments.length);s.push(s),s.push.apply(s,arguments),this._tasks=s}else{var s=Array(arguments.length);s.push.apply(s,arguments),this._tasks=s}this.length+=arguments.length}else t===1?this._tasks=[this._tasks,n]:this._tasks=n,this.length++;this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}function removeLast_norebuild(n){this.length!==0&&(this.length===1?this._tasks===n&&(this.length=0):((0,utils_1$1._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(n)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function removeLast_rebuild(n){if(this.length!==0){if(this.length===1)if(this._tasks===n&&(this.length=0),this.firstEmitBuildStrategy){this.call=bake_collection_1.BAKED_EMPTY_FUNC;return}else{this.rebuild();return}else(0,utils_1$1._fast_remove_single)(this._tasks,this._tasks.lastIndexOf(n)),this._tasks.length===1?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length;this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}}function insert_norebuild(n){for(var e,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.length===0?(this._tasks=t,this.length=1):this.length===1?(t.unshift(this._tasks),this._tasks=t,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,__spreadArray$1([n,0],t,!1)),this.length=this._tasks.length)}function insert_rebuild(n){for(var e,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.length===0?(this._tasks=t,this.length=1):this.length===1?(t.unshift(this._tasks),this._tasks=t,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,__spreadArray$1([n,0],t,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild()}function rebuild_noawait(){this.length===0?this.call=bake_collection_1.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,bake_collection_1.bakeCollection)(this._tasks,this.argsNum)}function rebuild_await(){this.length===0?this.call=bake_collection_1.BAKED_EMPTY_FUNC:this.length===1?this.call=this._tasks:this.call=(0,bake_collection_1.bakeCollectionAwait)(this._tasks,this.argsNum)}function rebuild_on_first_call(){this.rebuild(),this.call.apply(void 0,arguments)}var TaskCollection=function(){function n(e,t,r,s){t===void 0&&(t=!0),r===void 0&&(r=null),s===void 0&&(s=!1),this.awaitTasks=s,this.call=bake_collection_1.BAKED_EMPTY_FUNC,this.argsNum=e,this.firstEmitBuildStrategy=!0,s?this.rebuild=rebuild_await.bind(this):this.rebuild=rebuild_noawait.bind(this),this.setAutoRebuild(t),r?typeof r=="function"?(this._tasks=r,this.length=1):(this._tasks=r,this.length=r.length):(this._tasks=null,this.length=0),t&&this.rebuild()}return n}();taskCollection.TaskCollection=TaskCollection;function fastClear(){this._tasks=null,this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC}function clear(){this._tasks=null,this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC}function growArgsNum(n){this.argsNum<n&&(this.argsNum=n,this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild())}function setAutoRebuild(n){n?(this.push=push_rebuild.bind(this),this.insert=insert_rebuild.bind(this),this.removeLast=removeLast_rebuild.bind(this)):(this.push=push_norebuild.bind(this),this.insert=insert_norebuild.bind(this),this.removeLast=removeLast_norebuild.bind(this))}function tasksAsArray(){return this.length===0?[]:this.length===1?[this._tasks]:this._tasks}function setTasks(n){n.length===0?(this.length=0,this.call=bake_collection_1.BAKED_EMPTY_FUNC):n.length===1?(this.length=1,this.call=n[0],this._tasks=n[0]):(this.length=n.length,this._tasks=n,this.firstEmitBuildStrategy?this.call=rebuild_on_first_call:this.rebuild())}TaskCollection.prototype.fastClear=fastClear;TaskCollection.prototype.clear=clear;TaskCollection.prototype.growArgsNum=growArgsNum;TaskCollection.prototype.setAutoRebuild=setAutoRebuild;TaskCollection.prototype.tasksAsArray=tasksAsArray;TaskCollection.prototype.setTasks=setTasks;(function(n){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var c=Object.getOwnPropertyDescriptor(s,o);(!c||("get"in c?!s.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,c)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(n,"__esModule",{value:!0}),t(taskCollection,n)})(taskCollection$1);var utils={};Object.defineProperty(utils,"__esModule",{value:!0});utils.nullObj=void 0;function nullObj(){var n={};return n.__proto__=null,n}utils.nullObj=nullObj;var __spreadArray=commonjsGlobal&&commonjsGlobal.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(ee,"__esModule",{value:!0});ee.EventEmitter=void 0;var task_collection_1=taskCollection$1,utils_1=utils$1,utils_2=utils;function emit(n,e,t,r,s,o){var a=this.events[n];if(a){if(a.length===0)return!1;if(a.argsNum<6)a.call(e,t,r,s,o);else{for(var c=new Array(a.argsNum),l=0,u=c.length;l<u;++l)c[l]=arguments[l+1];a.call.apply(void 0,c)}return!0}return!1}function emitHasOnce(n,e,t,r,s,o){var a=this.events[n],c;if(a!==void 0){if(a.length===0)return!1;if(a.argsNum<6)a.call(e,t,r,s,o);else{c=new Array(a.argsNum);for(var l=0,u=c.length;l<u;++l)c[l]=arguments[l+1];a.call.apply(void 0,c)}}var f=this.onceEvents[n];if(f){if(typeof f=="function")if(this.onceEvents[n]=void 0,arguments.length<6)f(e,t,r,s,o);else{if(c===void 0){c=new Array(arguments.length-1);for(var l=0,u=c.length;l<u;++l)c[l]=arguments[l+1]}f.apply(void 0,c)}else{var h=f;if(this.onceEvents[n]=void 0,arguments.length<6)for(var l=0;l<h.length;++l)h[l](e,t,r,s,o);else{if(c===void 0){c=new Array(arguments.length-1);for(var l=0,u=c.length;l<u;++l)c[l]=arguments[l+1]}for(var l=0;l<h.length;++l)h[l].apply(void 0,c)}}return!0}return a!==void 0}var EventEmitter=function(){function n(){this.events=(0,utils_2.nullObj)(),this.onceEvents=(0,utils_2.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(n.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),n}();ee.EventEmitter=EventEmitter;function once(n,e){switch(this.emit===emit&&(this.emit=emitHasOnce),typeof this.onceEvents[n]){case"undefined":this.onceEvents[n]=e,typeof n=="symbol"&&this._symbolKeys.add(n);break;case"function":this.onceEvents[n]=[this.onceEvents[n],e];break;case"object":this.onceEvents[n].push(e)}return this}function addListener(n,e,t){if(t===void 0&&(t=e.length),typeof e!="function")throw new TypeError("The listener must be a function");var r=this.events[n];return r?(r.push(e),r.growArgsNum(t),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(n),'" event!'))):(this.events[n]=new task_collection_1.TaskCollection(t,!0,e,!1),typeof n=="symbol"&&this._symbolKeys.add(n)),this}function removeListener(n,e){var t=this.events[n];t&&t.removeLast(e);var r=this.onceEvents[n];return r&&(typeof r=="function"?this.onceEvents[n]=void 0:typeof r=="object"&&(r.length===1&&r[0]===e?this.onceEvents[n]=void 0:(0,utils_1._fast_remove_single)(r,r.lastIndexOf(e)))),this}function addListenerBound(n,e,t,r){t===void 0&&(t=this),r===void 0&&(r=e.length),this.boundFuncs||(this.boundFuncs=new Map);var s=e.bind(t);return this.boundFuncs.set(e,s),this.addListener(n,s,r)}function removeListenerBound(n,e){var t,r,s=(t=this.boundFuncs)===null||t===void 0?void 0:t.get(e);return(r=this.boundFuncs)===null||r===void 0||r.delete(e),this.removeListener(n,s)}function hasListeners(n){return this.events[n]&&!!this.events[n].length}function prependListener(n,e,t){if(t===void 0&&(t=e.length),typeof e!="function")throw new TypeError("The listener must be a function");var r=this.events[n];return!r||!(r instanceof task_collection_1.TaskCollection)?(r=this.events[n]=new task_collection_1.TaskCollection(t,!0,e,!1),typeof n=="symbol"&&this._symbolKeys.add(n)):(r.insert(0,e),r.growArgsNum(t),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(n),'" event!'))),this}function prependOnceListener(n,e){this.emit===emit&&(this.emit=emitHasOnce);var t=this.onceEvents[n];return t?typeof t!="object"?(this.onceEvents[n]=[e,t],typeof n=="symbol"&&this._symbolKeys.add(n)):(t.unshift(e),this.maxListeners!==1/0&&this.maxListeners<=t.length&&console.warn('Maximum event listeners for "'.concat(String(n),'" once event!'))):(this.onceEvents[n]=[e],typeof n=="symbol"&&this._symbolKeys.add(n)),this}function removeAllListeners(n){return n===void 0?(this.events=(0,utils_2.nullObj)(),this.onceEvents=(0,utils_2.nullObj)(),this._symbolKeys=new Set):(this.events[n]=void 0,this.onceEvents[n]=void 0,typeof n=="symbol"&&this._symbolKeys.delete(n)),this}function setMaxListeners(n){return this.maxListeners=n,this}function getMaxListeners(){return this.maxListeners}function listeners(n){return this.emit===emit?this.events[n]?this.events[n].tasksAsArray().slice():[]:this.events[n]&&this.onceEvents[n]?__spreadArray(__spreadArray([],this.events[n].tasksAsArray(),!0),typeof this.onceEvents[n]=="function"?[this.onceEvents[n]]:this.onceEvents[n],!0):this.events[n]?this.events[n].tasksAsArray():this.onceEvents[n]?typeof this.onceEvents[n]=="function"?[this.onceEvents[n]]:this.onceEvents[n]:[]}function eventNames(){var n=this;if(this.emit===emit){var e=Object.keys(this.events);return __spreadArray(__spreadArray([],e,!0),Array.from(this._symbolKeys),!0).filter(function(r){return r in n.events&&n.events[r]&&n.events[r].length})}else{var e=Object.keys(this.events).filter(function(s){return n.events[s]&&n.events[s].length}),t=Object.keys(this.onceEvents).filter(function(s){return n.onceEvents[s]&&n.onceEvents[s].length});return __spreadArray(__spreadArray(__spreadArray([],e,!0),t,!0),Array.from(this._symbolKeys).filter(function(s){return s in n.events&&n.events[s]&&n.events[s].length||s in n.onceEvents&&n.onceEvents[s]&&n.onceEvents[s].length}),!0)}}function listenerCount(n){return this.emit===emit?this.events[n]&&this.events[n].length||0:(this.events[n]&&this.events[n].length||0)+(this.onceEvents[n]&&this.onceEvents[n].length||0)}EventEmitter.prototype.emit=emit;EventEmitter.prototype.on=addListener;EventEmitter.prototype.once=once;EventEmitter.prototype.addListener=addListener;EventEmitter.prototype.removeListener=removeListener;EventEmitter.prototype.addListenerBound=addListenerBound;EventEmitter.prototype.removeListenerBound=removeListenerBound;EventEmitter.prototype.hasListeners=hasListeners;EventEmitter.prototype.prependListener=prependListener;EventEmitter.prototype.prependOnceListener=prependOnceListener;EventEmitter.prototype.off=removeListener;EventEmitter.prototype.removeAllListeners=removeAllListeners;EventEmitter.prototype.setMaxListeners=setMaxListeners;EventEmitter.prototype.getMaxListeners=getMaxListeners;EventEmitter.prototype.listeners=listeners;EventEmitter.prototype.eventNames=eventNames;EventEmitter.prototype.listenerCount=listenerCount;(function(n){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var c=Object.getOwnPropertyDescriptor(s,o);(!c||("get"in c?!s.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,c)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(n,"__esModule",{value:!0}),t(types,n),t(ee,n)})(lib$1);var browser$2={exports:{}},ms,hasRequiredMs;function requireMs(){if(hasRequiredMs)return ms;hasRequiredMs=1;var n=1e3,e=n*60,t=e*60,r=t*24,s=r*7,o=r*365.25;ms=function(f,h){h=h||{};var p=typeof f;if(p==="string"&&f.length>0)return a(f);if(p==="number"&&isFinite(f))return h.long?l(f):c(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))};function a(f){if(f=String(f),!(f.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(h){var p=parseFloat(h[1]),g=(h[2]||"ms").toLowerCase();switch(g){case"years":case"year":case"yrs":case"yr":case"y":return p*o;case"weeks":case"week":case"w":return p*s;case"days":case"day":case"d":return p*r;case"hours":case"hour":case"hrs":case"hr":case"h":return p*t;case"minutes":case"minute":case"mins":case"min":case"m":return p*e;case"seconds":case"second":case"secs":case"sec":case"s":return p*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return p;default:return}}}}function c(f){var h=Math.abs(f);return h>=r?Math.round(f/r)+"d":h>=t?Math.round(f/t)+"h":h>=e?Math.round(f/e)+"m":h>=n?Math.round(f/n)+"s":f+"ms"}function l(f){var h=Math.abs(f);return h>=r?u(f,h,r,"day"):h>=t?u(f,h,t,"hour"):h>=e?u(f,h,e,"minute"):h>=n?u(f,h,n,"second"):f+" ms"}function u(f,h,p,g){var y=h>=p*1.5;return Math.round(f/p)+" "+g+(y?"s":"")}return ms}function setup(n){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=s,t.enabled=a,t.humanize=requireMs(),t.destroy=u,Object.keys(n).forEach(f=>{t[f]=n[f]}),t.names=[],t.skips=[],t.formatters={};function e(f){let h=0;for(let p=0;p<f.length;p++)h=(h<<5)-h+f.charCodeAt(p),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(f){let h,p=null,g,y;function m(...b){if(!m.enabled)return;const v=m,$=Number(new Date),I=$-(h||$);v.diff=I,v.prev=h,v.curr=$,h=$,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let O=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(L,T)=>{if(L==="%%")return"%";O++;const B=t.formatters[T];if(typeof B=="function"){const H=b[O];L=B.call(v,H),b.splice(O,1),O--}return L}),t.formatArgs.call(v,b),(v.log||t.log).apply(v,b)}return m.namespace=f,m.useColors=t.useColors(),m.color=t.selectColor(f),m.extend=r,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(g!==t.namespaces&&(g=t.namespaces,y=t.enabled(f)),y),set:b=>{p=b}}),typeof t.init=="function"&&t.init(m),m}function r(f,h){const p=t(this.namespace+(typeof h>"u"?":":h)+f);return p.log=this.log,p}function s(f){t.save(f),t.namespaces=f,t.names=[],t.skips=[];let h;const p=(typeof f=="string"?f:"").split(/[\s,]+/),g=p.length;for(h=0;h<g;h++)p[h]&&(f=p[h].replace(/\*/g,".*?"),f[0]==="-"?t.skips.push(new RegExp("^"+f.slice(1)+"$")):t.names.push(new RegExp("^"+f+"$")))}function o(){const f=[...t.names.map(c),...t.skips.map(c).map(h=>"-"+h)].join(",");return t.enable(""),f}function a(f){if(f[f.length-1]==="*")return!0;let h,p;for(h=0,p=t.skips.length;h<p;h++)if(t.skips[h].test(f))return!1;for(h=0,p=t.names.length;h<p;h++)if(t.names[h].test(f))return!0;return!1}function c(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}function l(f){return f instanceof Error?f.stack||f.message:f}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var common=setup;(function(n,e){var t={};e.formatArgs=s,e.save=o,e.load=a,e.useColors=r,e.storage=c(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;u.splice(1,0,f,"color: inherit");let h=0,p=0;u[0].replace(/%[a-zA-Z%]/g,g=>{g!=="%%"&&(h++,g==="%c"&&(p=h))}),u.splice(p,0,f)}e.log=console.debug||console.log||(()=>{});function o(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function a(){let u;try{u=e.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=t.DEBUG),u}function c(){try{return localStorage}catch{}}n.exports=common(e);const{formatters:l}=n.exports;l.j=function(u){try{return JSON.stringify(u)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}})(browser$2,browser$2.exports);var browserExports=browser$2.exports;const debug7=getDefaultExportFromCjs(browserExports);function setBigUint64(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),o=BigInt(4294967295),a=Number(t>>s&o),c=Number(t&o),l=r?4:0,u=r?0:4;n.setUint32(e+l,a,r),n.setUint32(e+u,c,r)}const Chi=(n,e,t)=>n&e^~n&t,Maj=(n,e,t)=>n&e^n&t^e&t;class HashMD extends Hash{constructor(e,t,r,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=createView(this.buffer)}update(e){exists(this);const{view:t,buffer:r,blockLen:s}=this;e=toBytes(e);const o=e.length;for(let a=0;a<o;){const c=Math.min(s-this.pos,o-a);if(c===s){const l=createView(e);for(;s<=o-a;a+=s)this.process(l,a);continue}r.set(e.subarray(a,a+c),this.pos),this.pos+=c,a+=c,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){exists(this),output(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:o}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>s-a&&(this.process(r,0),a=0);for(let h=a;h<s;h++)t[h]=0;setBigUint64(r,s-8,BigInt(this.length*8),o),this.process(r,0);const c=createView(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=l/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)c.setUint32(4*h,f[h],o)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:o,destroyed:a,pos:c}=this;return e.length=s,e.pos=c,e.finished=o,e.destroyed=a,s%t&&e.buffer.set(r),e}}const SHA256_K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),SHA256_IV=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),SHA256_W=new Uint32Array(64);class SHA256 extends HashMD{constructor(){super(64,32,8,!1),this.A=SHA256_IV[0]|0,this.B=SHA256_IV[1]|0,this.C=SHA256_IV[2]|0,this.D=SHA256_IV[3]|0,this.E=SHA256_IV[4]|0,this.F=SHA256_IV[5]|0,this.G=SHA256_IV[6]|0,this.H=SHA256_IV[7]|0}get(){const{A:e,B:t,C:r,D:s,E:o,F:a,G:c,H:l}=this;return[e,t,r,s,o,a,c,l]}set(e,t,r,s,o,a,c,l){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=o|0,this.F=a|0,this.G=c|0,this.H=l|0}process(e,t){for(let h=0;h<16;h++,t+=4)SHA256_W[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=SHA256_W[h-15],g=SHA256_W[h-2],y=rotr(p,7)^rotr(p,18)^p>>>3,m=rotr(g,17)^rotr(g,19)^g>>>10;SHA256_W[h]=m+SHA256_W[h-7]+y+SHA256_W[h-16]|0}let{A:r,B:s,C:o,D:a,E:c,F:l,G:u,H:f}=this;for(let h=0;h<64;h++){const p=rotr(c,6)^rotr(c,11)^rotr(c,25),g=f+p+Chi(c,l,u)+SHA256_K[h]+SHA256_W[h]|0,m=(rotr(r,2)^rotr(r,13)^rotr(r,22))+Maj(r,s,o)|0;f=u,u=l,l=c,c=a+g|0,a=o,o=s,s=r,r=g+m|0}r=r+this.A|0,s=s+this.B|0,o=o+this.C|0,a=a+this.D|0,c=c+this.E|0,l=l+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,s,o,a,c,l,u,f)}roundClean(){SHA256_W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const sha256=wrapConstructor(()=>new SHA256);class HMAC extends Hash{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,hash$1(e);const r=toBytes(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,o=new Uint8Array(s);o.set(r.length>s?e.create().update(r).digest():r);for(let a=0;a<o.length;a++)o[a]^=54;this.iHash.update(o),this.oHash=e.create();for(let a=0;a<o.length;a++)o[a]^=106;this.oHash.update(o),o.fill(0)}update(e){return exists(this),this.iHash.update(e),this}digestInto(e){exists(this),bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:o,blockLen:a,outputLen:c}=this;return e=e,e.finished=s,e.destroyed=o,e.blockLen=a,e.outputLen=c,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const hmac=(n,e,t)=>new HMAC(n,e).update(t).digest();hmac.create=(n,e)=>new HMAC(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$4=BigInt(0),_1n$4=BigInt(1),_2n$2=BigInt(2);function isBytes$1(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function abytes(n){if(!isBytes$1(n))throw new Error("Uint8Array expected")}function abool(n,e){if(typeof e!="boolean")throw new Error(`${n} must be valid boolean, got "${e}".`)}const hexes=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function bytesToHex(n){abytes(n);let e="";for(let t=0;t<n.length;t++)e+=hexes[n[t]];return e}function numberToHexUnpadded(n){const e=n.toString(16);return e.length&1?`0${e}`:e}function hexToNumber(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return BigInt(n===""?"0":`0x${n}`)}const asciis={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function asciiToBase16(n){if(n>=asciis._0&&n<=asciis._9)return n-asciis._0;if(n>=asciis._A&&n<=asciis._F)return n-(asciis._A-10);if(n>=asciis._a&&n<=asciis._f)return n-(asciis._a-10)}function hexToBytes(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length,t=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,o=0;s<t;s++,o+=2){const a=asciiToBase16(n.charCodeAt(o)),c=asciiToBase16(n.charCodeAt(o+1));if(a===void 0||c===void 0){const l=n[o]+n[o+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+o)}r[s]=a*16+c}return r}function bytesToNumberBE(n){return hexToNumber(bytesToHex(n))}function bytesToNumberLE(n){return abytes(n),hexToNumber(bytesToHex(Uint8Array.from(n).reverse()))}function numberToBytesBE(n,e){return hexToBytes(n.toString(16).padStart(e*2,"0"))}function numberToBytesLE(n,e){return numberToBytesBE(n,e).reverse()}function numberToVarBytesBE(n){return hexToBytes(numberToHexUnpadded(n))}function ensureBytes(n,e,t){let r;if(typeof e=="string")try{r=hexToBytes(e)}catch(o){throw new Error(`${n} must be valid hex string, got "${e}". Cause: ${o}`)}else if(isBytes$1(e))r=Uint8Array.from(e);else throw new Error(`${n} must be hex string or Uint8Array`);const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(`${n} expected ${t} bytes, got ${s}`);return r}function concatBytes(...n){let e=0;for(let r=0;r<n.length;r++){const s=n[r];abytes(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<n.length;r++){const o=n[r];t.set(o,s),s+=o.length}return t}function equalBytes(n,e){if(n.length!==e.length)return!1;let t=0;for(let r=0;r<n.length;r++)t|=n[r]^e[r];return t===0}function utf8ToBytes(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}const isPosBig=n=>typeof n=="bigint"&&_0n$4<=n;function inRange(n,e,t){return isPosBig(n)&&isPosBig(e)&&isPosBig(t)&&e<=n&&n<t}function aInRange(n,e,t,r){if(!inRange(e,t,r))throw new Error(`expected valid ${n}: ${t} <= n < ${r}, got ${typeof e} ${e}`)}function bitLen(n){let e;for(e=0;n>_0n$4;n>>=_1n$4,e+=1);return e}function bitGet(n,e){return n>>BigInt(e)&_1n$4}function bitSet(n,e,t){return n|(t?_1n$4:_0n$4)<<BigInt(e)}const bitMask=n=>(_2n$2<<BigInt(n-1))-_1n$4,u8n=n=>new Uint8Array(n),u8fr=n=>Uint8Array.from(n);function createHmacDrbg(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=u8n(n),s=u8n(n),o=0;const a=()=>{r.fill(1),s.fill(0),o=0},c=(...h)=>t(s,r,...h),l=(h=u8n())=>{s=c(u8fr([0]),h),r=c(),h.length!==0&&(s=c(u8fr([1]),h),r=c())},u=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const p=[];for(;h<e;){r=c();const g=r.slice();p.push(g),h+=r.length}return concatBytes(...p)};return(h,p)=>{a(),l(h);let g;for(;!(g=p(u()));)l();return a(),g}}const validatorFns={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||isBytes$1(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function validateObject(n,e,t={}){const r=(s,o,a)=>{const c=validatorFns[o];if(typeof c!="function")throw new Error(`Invalid validator "${o}", expected function`);const l=n[s];if(!(a&&l===void 0)&&!c(l,n))throw new Error(`Invalid param ${String(s)}=${l} (${typeof l}), expected ${o}`)};for(const[s,o]of Object.entries(e))r(s,o,!1);for(const[s,o]of Object.entries(t))r(s,o,!0);return n}const notImplemented=()=>{throw new Error("not implemented")};function memoized(n){const e=new WeakMap;return(t,...r)=>{const s=e.get(t);if(s!==void 0)return s;const o=n(t,...r);return e.set(t,o),o}}const ut=Object.freeze(Object.defineProperty({__proto__:null,aInRange,abool,abytes,bitGet,bitLen,bitMask,bitSet,bytesToHex,bytesToNumberBE,bytesToNumberLE,concatBytes,createHmacDrbg,ensureBytes,equalBytes,hexToBytes,hexToNumber,inRange,isBytes:isBytes$1,memoized,notImplemented,numberToBytesBE,numberToBytesLE,numberToHexUnpadded,numberToVarBytesBE,utf8ToBytes,validateObject},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$3=BigInt(0),_1n$3=BigInt(1),_2n$1=BigInt(2),_3n$1=BigInt(3),_4n=BigInt(4),_5n=BigInt(5),_8n=BigInt(8);BigInt(9);BigInt(16);function mod(n,e){const t=n%e;return t>=_0n$3?t:e+t}function pow(n,e,t){if(t<=_0n$3||e<_0n$3)throw new Error("Expected power/modulo > 0");if(t===_1n$3)return _0n$3;let r=_1n$3;for(;e>_0n$3;)e&_1n$3&&(r=r*n%t),n=n*n%t,e>>=_1n$3;return r}function pow2(n,e,t){let r=n;for(;e-- >_0n$3;)r*=r,r%=t;return r}function invert(n,e){if(n===_0n$3||e<=_0n$3)throw new Error(`invert: expected positive integers, got n=${n} mod=${e}`);let t=mod(n,e),r=e,s=_0n$3,o=_1n$3;for(;t!==_0n$3;){const c=r/t,l=r%t,u=s-o*c;r=t,t=l,s=o,o=u}if(r!==_1n$3)throw new Error("invert: does not exist");return mod(s,e)}function tonelliShanks(n){const e=(n-_1n$3)/_2n$1;let t,r,s;for(t=n-_1n$3,r=0;t%_2n$1===_0n$3;t/=_2n$1,r++);for(s=_2n$1;s<n&&pow(s,e,n)!==n-_1n$3;s++);if(r===1){const a=(n+_1n$3)/_4n;return function(l,u){const f=l.pow(u,a);if(!l.eql(l.sqr(f),u))throw new Error("Cannot find square root");return f}}const o=(t+_1n$3)/_2n$1;return function(c,l){if(c.pow(l,e)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=r,f=c.pow(c.mul(c.ONE,s),t),h=c.pow(l,o),p=c.pow(l,t);for(;!c.eql(p,c.ONE);){if(c.eql(p,c.ZERO))return c.ZERO;let g=1;for(let m=c.sqr(p);g<u&&!c.eql(m,c.ONE);g++)m=c.sqr(m);const y=c.pow(f,_1n$3<<BigInt(u-g-1));f=c.sqr(y),h=c.mul(h,y),p=c.mul(p,f),u=g}return h}}function FpSqrt(n){if(n%_4n===_3n$1){const e=(n+_1n$3)/_4n;return function(r,s){const o=r.pow(s,e);if(!r.eql(r.sqr(o),s))throw new Error("Cannot find square root");return o}}if(n%_8n===_5n){const e=(n-_5n)/_8n;return function(r,s){const o=r.mul(s,_2n$1),a=r.pow(o,e),c=r.mul(s,a),l=r.mul(r.mul(c,_2n$1),a),u=r.mul(c,r.sub(l,r.ONE));if(!r.eql(r.sqr(u),s))throw new Error("Cannot find square root");return u}}return tonelliShanks(n)}const FIELD_FIELDS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function validateField(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=FIELD_FIELDS.reduce((r,s)=>(r[s]="function",r),e);return validateObject(n,t)}function FpPow(n,e,t){if(t<_0n$3)throw new Error("Expected power > 0");if(t===_0n$3)return n.ONE;if(t===_1n$3)return e;let r=n.ONE,s=e;for(;t>_0n$3;)t&_1n$3&&(r=n.mul(r,s)),s=n.sqr(s),t>>=_1n$3;return r}function FpInvertBatch(n,e){const t=new Array(e.length),r=e.reduce((o,a,c)=>n.is0(a)?o:(t[c]=o,n.mul(o,a)),n.ONE),s=n.inv(r);return e.reduceRight((o,a,c)=>n.is0(a)?o:(t[c]=n.mul(o,t[c]),n.mul(o,a)),s),t}function nLength(n,e){const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function Field(n,e,t=!1,r={}){if(n<=_0n$3)throw new Error(`Expected Field ORDER > 0, got ${n}`);const{nBitLength:s,nByteLength:o}=nLength(n,e);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=FpSqrt(n),c=Object.freeze({ORDER:n,BITS:s,BYTES:o,MASK:bitMask(s),ZERO:_0n$3,ONE:_1n$3,create:l=>mod(l,n),isValid:l=>{if(typeof l!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof l}`);return _0n$3<=l&&l<n},is0:l=>l===_0n$3,isOdd:l=>(l&_1n$3)===_1n$3,neg:l=>mod(-l,n),eql:(l,u)=>l===u,sqr:l=>mod(l*l,n),add:(l,u)=>mod(l+u,n),sub:(l,u)=>mod(l-u,n),mul:(l,u)=>mod(l*u,n),pow:(l,u)=>FpPow(c,l,u),div:(l,u)=>mod(l*invert(u,n),n),sqrN:l=>l*l,addN:(l,u)=>l+u,subN:(l,u)=>l-u,mulN:(l,u)=>l*u,inv:l=>invert(l,n),sqrt:r.sqrt||(l=>a(c,l)),invertBatch:l=>FpInvertBatch(c,l),cmov:(l,u,f)=>f?u:l,toBytes:l=>t?numberToBytesLE(l,o):numberToBytesBE(l,o),fromBytes:l=>{if(l.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${l.length}`);return t?bytesToNumberLE(l):bytesToNumberBE(l)}});return Object.freeze(c)}function getFieldBytesLength(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function getMinHashLength(n){const e=getFieldBytesLength(n);return e+Math.ceil(e/2)}function mapHashToField(n,e,t=!1){const r=n.length,s=getFieldBytesLength(e),o=getMinHashLength(e);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const a=t?bytesToNumberBE(n):bytesToNumberLE(n),c=mod(a,e-_1n$3)+_1n$3;return t?numberToBytesLE(c,s):numberToBytesBE(c,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _0n$2=BigInt(0),_1n$2=BigInt(1),pointPrecomputes=new WeakMap,pointWindowSizes=new WeakMap;function wNAF(n,e){const t=(o,a)=>{const c=a.negate();return o?c:a},r=o=>{if(!Number.isSafeInteger(o)||o<=0||o>e)throw new Error(`Wrong window size=${o}, should be [1..${e}]`)},s=o=>{r(o);const a=Math.ceil(e/o)+1,c=2**(o-1);return{windows:a,windowSize:c}};return{constTimeNegate:t,unsafeLadder(o,a){let c=n.ZERO,l=o;for(;a>_0n$2;)a&_1n$2&&(c=c.add(l)),l=l.double(),a>>=_1n$2;return c},precomputeWindow(o,a){const{windows:c,windowSize:l}=s(a),u=[];let f=o,h=f;for(let p=0;p<c;p++){h=f,u.push(h);for(let g=1;g<l;g++)h=h.add(f),u.push(h);f=h.double()}return u},wNAF(o,a,c){const{windows:l,windowSize:u}=s(o);let f=n.ZERO,h=n.BASE;const p=BigInt(2**o-1),g=2**o,y=BigInt(o);for(let m=0;m<l;m++){const b=m*u;let v=Number(c&p);c>>=y,v>u&&(v-=g,c+=_1n$2);const $=b,I=b+Math.abs(v)-1,O=m%2!==0,M=v<0;v===0?h=h.add(t(O,a[$])):f=f.add(t(M,a[I]))}return{p:f,f:h}},wNAFCached(o,a,c){const l=pointWindowSizes.get(o)||1;let u=pointPrecomputes.get(o);return u||(u=this.precomputeWindow(o,l),l!==1&&pointPrecomputes.set(o,c(u))),this.wNAF(l,u,a)},setWindowSize(o,a){r(a),pointWindowSizes.set(o,a),pointPrecomputes.delete(o)}}}function pippenger(n,e,t,r){if(!Array.isArray(t)||!Array.isArray(r)||r.length!==t.length)throw new Error("arrays of points and scalars must have equal length");r.forEach((f,h)=>{if(!e.isValid(f))throw new Error(`wrong scalar at index ${h}`)}),t.forEach((f,h)=>{if(!(f instanceof n))throw new Error(`wrong point at index ${h}`)});const s=bitLen(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n.ZERO),l=Math.floor((e.BITS-1)/o)*o;let u=n.ZERO;for(let f=l;f>=0;f-=o){c.fill(n.ZERO);for(let p=0;p<r.length;p++){const g=r[p],y=Number(g>>BigInt(f)&BigInt(a));c[y]=c[y].add(t[p])}let h=n.ZERO;for(let p=c.length-1,g=n.ZERO;p>0;p--)g=g.add(c[p]),h=h.add(g);if(u=u.add(h),f!==0)for(let p=0;p<o;p++)u=u.double()}return u}function validateBasic(n){return validateField(n.Fp),validateObject(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...nLength(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function validateSigVerOpts(n){n.lowS!==void 0&&abool("lowS",n.lowS),n.prehash!==void 0&&abool("prehash",n.prehash)}function validatePointOpts(n){const e=validateBasic(n);validateObject(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:r,a:s}=e;if(t){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:b2n,hexToBytes:h2b}=ut,DER={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(n,e)=>{const{Err:t}=DER;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,s=numberToHexUnpadded(r);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const o=r>127?numberToHexUnpadded(s.length/2|128):"";return`${numberToHexUnpadded(n)}${o}${s}${e}`},decode(n,e){const{Err:t}=DER;let r=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==n)throw new t("tlv.decode: wrong tlv");const s=e[r++],o=!!(s&128);let a=0;if(!o)a=s;else{const l=s&127;if(!l)throw new t("tlv.decode(long): indefinite length not supported");if(l>4)throw new t("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+l);if(u.length!==l)throw new t("tlv.decode: length bytes not complete");if(u[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const f of u)a=a<<8|f;if(r+=l,a<128)throw new t("tlv.decode(long): not minimal encoding")}const c=e.subarray(r,r+a);if(c.length!==a)throw new t("tlv.decode: wrong value length");return{v:c,l:e.subarray(r+a)}}},_int:{encode(n){const{Err:e}=DER;if(n<_0n$1)throw new e("integer: negative integers are not allowed");let t=numberToHexUnpadded(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected assertion");return t},decode(n){const{Err:e}=DER;if(n[0]&128)throw new e("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return b2n(n)}},toSig(n){const{Err:e,_int:t,_tlv:r}=DER,s=typeof n=="string"?h2b(n):n;abytes(s);const{v:o,l:a}=r.decode(48,s);if(a.length)throw new e("Invalid signature: left bytes after parsing");const{v:c,l}=r.decode(2,o),{v:u,l:f}=r.decode(2,l);if(f.length)throw new e("Invalid signature: left bytes after parsing");return{r:t.decode(c),s:t.decode(u)}},hexFromSig(n){const{_tlv:e,_int:t}=DER,r=`${e.encode(2,t.encode(n.r))}${e.encode(2,t.encode(n.s))}`;return e.encode(48,r)}},_0n$1=BigInt(0),_1n$1=BigInt(1);BigInt(2);const _3n=BigInt(3);BigInt(4);function weierstrassPoints(n){const e=validatePointOpts(n),{Fp:t}=e,r=Field(e.n,e.nBitLength),s=e.toBytes||((m,b,v)=>{const $=b.toAffine();return concatBytes(Uint8Array.from([4]),t.toBytes($.x),t.toBytes($.y))}),o=e.fromBytes||(m=>{const b=m.subarray(1),v=t.fromBytes(b.subarray(0,t.BYTES)),$=t.fromBytes(b.subarray(t.BYTES,2*t.BYTES));return{x:v,y:$}});function a(m){const{a:b,b:v}=e,$=t.sqr(m),I=t.mul($,m);return t.add(t.add(I,t.mul(m,b)),v)}if(!t.eql(t.sqr(e.Gy),a(e.Gx)))throw new Error("bad generator point: equation left != right");function c(m){return inRange(m,_1n$1,e.n)}function l(m){const{allowedPrivateKeyLengths:b,nByteLength:v,wrapPrivateKey:$,n:I}=e;if(b&&typeof m!="bigint"){if(isBytes$1(m)&&(m=bytesToHex(m)),typeof m!="string"||!b.includes(m.length))throw new Error("Invalid key");m=m.padStart(v*2,"0")}let O;try{O=typeof m=="bigint"?m:bytesToNumberBE(ensureBytes("private key",m,v))}catch{throw new Error(`private key must be ${v} bytes, hex or bigint, not ${typeof m}`)}return $&&(O=mod(O,I)),aInRange("private key",O,_1n$1,I),O}function u(m){if(!(m instanceof p))throw new Error("ProjectivePoint expected")}const f=memoized((m,b)=>{const{px:v,py:$,pz:I}=m;if(t.eql(I,t.ONE))return{x:v,y:$};const O=m.is0();b==null&&(b=O?t.ONE:t.inv(I));const M=t.mul(v,b),L=t.mul($,b),T=t.mul(I,b);if(O)return{x:t.ZERO,y:t.ZERO};if(!t.eql(T,t.ONE))throw new Error("invZ was invalid");return{x:M,y:L}}),h=memoized(m=>{if(m.is0()){if(e.allowInfinityPoint&&!t.is0(m.py))return;throw new Error("bad point: ZERO")}const{x:b,y:v}=m.toAffine();if(!t.isValid(b)||!t.isValid(v))throw new Error("bad point: x or y not FE");const $=t.sqr(v),I=a(b);if(!t.eql($,I))throw new Error("bad point: equation left != right");if(!m.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class p{constructor(b,v,$){if(this.px=b,this.py=v,this.pz=$,b==null||!t.isValid(b))throw new Error("x required");if(v==null||!t.isValid(v))throw new Error("y required");if($==null||!t.isValid($))throw new Error("z required");Object.freeze(this)}static fromAffine(b){const{x:v,y:$}=b||{};if(!b||!t.isValid(v)||!t.isValid($))throw new Error("invalid affine point");if(b instanceof p)throw new Error("projective point not allowed");const I=O=>t.eql(O,t.ZERO);return I(v)&&I($)?p.ZERO:new p(v,$,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const v=t.invertBatch(b.map($=>$.pz));return b.map(($,I)=>$.toAffine(v[I])).map(p.fromAffine)}static fromHex(b){const v=p.fromAffine(o(ensureBytes("pointHex",b)));return v.assertValidity(),v}static fromPrivateKey(b){return p.BASE.multiply(l(b))}static msm(b,v){return pippenger(p,r,b,v)}_setWindowSize(b){y.setWindowSize(this,b)}assertValidity(){h(this)}hasEvenY(){const{y:b}=this.toAffine();if(t.isOdd)return!t.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){u(b);const{px:v,py:$,pz:I}=this,{px:O,py:M,pz:L}=b,T=t.eql(t.mul(v,L),t.mul(O,I)),B=t.eql(t.mul($,L),t.mul(M,I));return T&&B}negate(){return new p(this.px,t.neg(this.py),this.pz)}double(){const{a:b,b:v}=e,$=t.mul(v,_3n),{px:I,py:O,pz:M}=this;let L=t.ZERO,T=t.ZERO,B=t.ZERO,H=t.mul(I,I),q=t.mul(O,O),x=t.mul(M,M),S=t.mul(I,O);return S=t.add(S,S),B=t.mul(I,M),B=t.add(B,B),L=t.mul(b,B),T=t.mul($,x),T=t.add(L,T),L=t.sub(q,T),T=t.add(q,T),T=t.mul(L,T),L=t.mul(S,L),B=t.mul($,B),x=t.mul(b,x),S=t.sub(H,x),S=t.mul(b,S),S=t.add(S,B),B=t.add(H,H),H=t.add(B,H),H=t.add(H,x),H=t.mul(H,S),T=t.add(T,H),x=t.mul(O,M),x=t.add(x,x),H=t.mul(x,S),L=t.sub(L,H),B=t.mul(x,q),B=t.add(B,B),B=t.add(B,B),new p(L,T,B)}add(b){u(b);const{px:v,py:$,pz:I}=this,{px:O,py:M,pz:L}=b;let T=t.ZERO,B=t.ZERO,H=t.ZERO;const q=e.a,x=t.mul(e.b,_3n);let S=t.mul(v,O),A=t.mul($,M),R=t.mul(I,L),_=t.add(v,$),E=t.add(O,M);_=t.mul(_,E),E=t.add(S,A),_=t.sub(_,E),E=t.add(v,I);let C=t.add(O,L);return E=t.mul(E,C),C=t.add(S,R),E=t.sub(E,C),C=t.add($,I),T=t.add(M,L),C=t.mul(C,T),T=t.add(A,R),C=t.sub(C,T),H=t.mul(q,E),T=t.mul(x,R),H=t.add(T,H),T=t.sub(A,H),H=t.add(A,H),B=t.mul(T,H),A=t.add(S,S),A=t.add(A,S),R=t.mul(q,R),E=t.mul(x,E),A=t.add(A,R),R=t.sub(S,R),R=t.mul(q,R),E=t.add(E,R),S=t.mul(A,E),B=t.add(B,S),S=t.mul(C,E),T=t.mul(_,T),T=t.sub(T,S),S=t.mul(_,A),H=t.mul(C,H),H=t.add(H,S),new p(T,B,H)}subtract(b){return this.add(b.negate())}is0(){return this.equals(p.ZERO)}wNAF(b){return y.wNAFCached(this,b,p.normalizeZ)}multiplyUnsafe(b){aInRange("scalar",b,_0n$1,e.n);const v=p.ZERO;if(b===_0n$1)return v;if(b===_1n$1)return this;const{endo:$}=e;if(!$)return y.unsafeLadder(this,b);let{k1neg:I,k1:O,k2neg:M,k2:L}=$.splitScalar(b),T=v,B=v,H=this;for(;O>_0n$1||L>_0n$1;)O&_1n$1&&(T=T.add(H)),L&_1n$1&&(B=B.add(H)),H=H.double(),O>>=_1n$1,L>>=_1n$1;return I&&(T=T.negate()),M&&(B=B.negate()),B=new p(t.mul(B.px,$.beta),B.py,B.pz),T.add(B)}multiply(b){const{endo:v,n:$}=e;aInRange("scalar",b,_1n$1,$);let I,O;if(v){const{k1neg:M,k1:L,k2neg:T,k2:B}=v.splitScalar(b);let{p:H,f:q}=this.wNAF(L),{p:x,f:S}=this.wNAF(B);H=y.constTimeNegate(M,H),x=y.constTimeNegate(T,x),x=new p(t.mul(x.px,v.beta),x.py,x.pz),I=H.add(x),O=q.add(S)}else{const{p:M,f:L}=this.wNAF(b);I=M,O=L}return p.normalizeZ([I,O])[0]}multiplyAndAddUnsafe(b,v,$){const I=p.BASE,O=(L,T)=>T===_0n$1||T===_1n$1||!L.equals(I)?L.multiplyUnsafe(T):L.multiply(T),M=O(this,v).add(O(b,$));return M.is0()?void 0:M}toAffine(b){return f(this,b)}isTorsionFree(){const{h:b,isTorsionFree:v}=e;if(b===_1n$1)return!0;if(v)return v(p,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:v}=e;return b===_1n$1?this:v?v(p,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return abool("isCompressed",b),this.assertValidity(),s(p,this,b)}toHex(b=!0){return abool("isCompressed",b),bytesToHex(this.toRawBytes(b))}}p.BASE=new p(e.Gx,e.Gy,t.ONE),p.ZERO=new p(t.ZERO,t.ONE,t.ZERO);const g=e.nBitLength,y=wNAF(p,e.endo?Math.ceil(g/2):g);return{CURVE:e,ProjectivePoint:p,normPrivateKeyToScalar:l,weierstrassEquation:a,isWithinCurveOrder:c}}function validateOpts(n){const e=validateBasic(n);return validateObject(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function weierstrass(n){const e=validateOpts(n),{Fp:t,n:r}=e,s=t.BYTES+1,o=2*t.BYTES+1;function a(R){return mod(R,r)}function c(R){return invert(R,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:u,weierstrassEquation:f,isWithinCurveOrder:h}=weierstrassPoints({...e,toBytes(R,_,E){const C=_.toAffine(),k=t.toBytes(C.x),N=concatBytes;return abool("isCompressed",E),E?N(Uint8Array.from([_.hasEvenY()?2:3]),k):N(Uint8Array.from([4]),k,t.toBytes(C.y))},fromBytes(R){const _=R.length,E=R[0],C=R.subarray(1);if(_===s&&(E===2||E===3)){const k=bytesToNumberBE(C);if(!inRange(k,_1n$1,t.ORDER))throw new Error("Point is not on curve");const N=f(k);let U;try{U=t.sqrt(N)}catch(D){const j=D instanceof Error?": "+D.message:"";throw new Error("Point is not on curve"+j)}const P=(U&_1n$1)===_1n$1;return(E&1)===1!==P&&(U=t.neg(U)),{x:k,y:U}}else if(_===o&&E===4){const k=t.fromBytes(C.subarray(0,t.BYTES)),N=t.fromBytes(C.subarray(t.BYTES,2*t.BYTES));return{x:k,y:N}}else throw new Error(`Point of length ${_} was invalid. Expected ${s} compressed bytes or ${o} uncompressed bytes`)}}),p=R=>bytesToHex(numberToBytesBE(R,e.nByteLength));function g(R){const _=r>>_1n$1;return R>_}function y(R){return g(R)?a(-R):R}const m=(R,_,E)=>bytesToNumberBE(R.slice(_,E));class b{constructor(_,E,C){this.r=_,this.s=E,this.recovery=C,this.assertValidity()}static fromCompact(_){const E=e.nByteLength;return _=ensureBytes("compactSignature",_,E*2),new b(m(_,0,E),m(_,E,2*E))}static fromDER(_){const{r:E,s:C}=DER.toSig(ensureBytes("DER",_));return new b(E,C)}assertValidity(){aInRange("r",this.r,_1n$1,r),aInRange("s",this.s,_1n$1,r)}addRecoveryBit(_){return new b(this.r,this.s,_)}recoverPublicKey(_){const{r:E,s:C,recovery:k}=this,N=L(ensureBytes("msgHash",_));if(k==null||![0,1,2,3].includes(k))throw new Error("recovery id invalid");const U=k===2||k===3?E+e.n:E;if(U>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const P=k&1?"03":"02",F=l.fromHex(P+p(U)),D=c(U),j=a(-N*D),V=a(C*D),K=l.BASE.multiplyAndAddUnsafe(F,j,V);if(!K)throw new Error("point at infinify");return K.assertValidity(),K}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new b(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return hexToBytes(this.toDERHex())}toDERHex(){return DER.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hexToBytes(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const v={isValidPrivateKey(R){try{return u(R),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const R=getMinHashLength(e.n);return mapHashToField(e.randomBytes(R),e.n)},precompute(R=8,_=l.BASE){return _._setWindowSize(R),_.multiply(BigInt(3)),_}};function $(R,_=!0){return l.fromPrivateKey(R).toRawBytes(_)}function I(R){const _=isBytes$1(R),E=typeof R=="string",C=(_||E)&&R.length;return _?C===s||C===o:E?C===2*s||C===2*o:R instanceof l}function O(R,_,E=!0){if(I(R))throw new Error("first arg must be private key");if(!I(_))throw new Error("second arg must be public key");return l.fromHex(_).multiply(u(R)).toRawBytes(E)}const M=e.bits2int||function(R){const _=bytesToNumberBE(R),E=R.length*8-e.nBitLength;return E>0?_>>BigInt(E):_},L=e.bits2int_modN||function(R){return a(M(R))},T=bitMask(e.nBitLength);function B(R){return aInRange(`num < 2^${e.nBitLength}`,R,_0n$1,T),numberToBytesBE(R,e.nByteLength)}function H(R,_,E=q){if(["recovered","canonical"].some(Z=>Z in E))throw new Error("sign() legacy options not supported");const{hash:C,randomBytes:k}=e;let{lowS:N,prehash:U,extraEntropy:P}=E;N==null&&(N=!0),R=ensureBytes("msgHash",R),validateSigVerOpts(E),U&&(R=ensureBytes("prehashed msgHash",C(R)));const F=L(R),D=u(_),j=[B(D),B(F)];if(P!=null&&P!==!1){const Z=P===!0?k(t.BYTES):P;j.push(ensureBytes("extraEntropy",Z))}const V=concatBytes(...j),K=F;function z(Z){const Y=M(Z);if(!h(Y))return;const J=c(Y),X=l.BASE.multiply(Y).toAffine(),G=a(X.x);if(G===_0n$1)return;const W=a(J*a(K+G*D));if(W===_0n$1)return;let Q=(X.x===G?0:2)|Number(X.y&_1n$1),se=W;return N&&g(W)&&(se=y(W),Q^=1),new b(G,se,Q)}return{seed:V,k2sig:z}}const q={lowS:e.lowS,prehash:!1},x={lowS:e.lowS,prehash:!1};function S(R,_,E=q){const{seed:C,k2sig:k}=H(R,_,E),N=e;return createHmacDrbg(N.hash.outputLen,N.nByteLength,N.hmac)(C,k)}l.BASE._setWindowSize(8);function A(R,_,E,C=x){var X;const k=R;if(_=ensureBytes("msgHash",_),E=ensureBytes("publicKey",E),"strict"in C)throw new Error("options.strict was renamed to lowS");validateSigVerOpts(C);const{lowS:N,prehash:U}=C;let P,F;try{if(typeof k=="string"||isBytes$1(k))try{P=b.fromDER(k)}catch(G){if(!(G instanceof DER.Err))throw G;P=b.fromCompact(k)}else if(typeof k=="object"&&typeof k.r=="bigint"&&typeof k.s=="bigint"){const{r:G,s:W}=k;P=new b(G,W)}else throw new Error("PARSE");F=l.fromHex(E)}catch(G){if(G.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&P.hasHighS())return!1;U&&(_=e.hash(_));const{r:D,s:j}=P,V=L(_),K=c(j),z=a(V*K),Z=a(D*K),Y=(X=l.BASE.multiplyAndAddUnsafe(F,z,Z))==null?void 0:X.toAffine();return Y?a(Y.x)===D:!1}return{CURVE:e,getPublicKey:$,getSharedSecret:O,sign:S,verify:A,ProjectivePoint:l,Signature:b,utils:v}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function getHash(n){return{hash:n,hmac:(e,...t)=>hmac(n,e,concatBytes$1(...t)),randomBytes}}function createCurve(n,e){const t=r=>weierstrass({...n,...getHash(r)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const secp256k1P=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),secp256k1N=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),_1n=BigInt(1),_2n=BigInt(2),divNearest=(n,e)=>(n+e/_2n)/e;function sqrtMod(n){const e=secp256k1P,t=BigInt(3),r=BigInt(6),s=BigInt(11),o=BigInt(22),a=BigInt(23),c=BigInt(44),l=BigInt(88),u=n*n*n%e,f=u*u*n%e,h=pow2(f,t,e)*f%e,p=pow2(h,t,e)*f%e,g=pow2(p,_2n,e)*u%e,y=pow2(g,s,e)*g%e,m=pow2(y,o,e)*y%e,b=pow2(m,c,e)*m%e,v=pow2(b,l,e)*b%e,$=pow2(v,c,e)*m%e,I=pow2($,t,e)*f%e,O=pow2(I,a,e)*y%e,M=pow2(O,r,e)*u%e,L=pow2(M,_2n,e);if(!Fp.eql(Fp.sqr(L),n))throw new Error("Cannot find square root");return L}const Fp=Field(secp256k1P,void 0,void 0,{sqrt:sqrtMod}),secp256k1=createCurve({a:BigInt(0),b:BigInt(7),Fp,n:secp256k1N,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const e=secp256k1N,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-_1n*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=t,a=BigInt("0x100000000000000000000000000000000"),c=divNearest(o*n,e),l=divNearest(-r*n,e);let u=mod(n-c*t-l*s,e),f=mod(-c*r-l*o,e);const h=u>a,p=f>a;if(h&&(u=e-u),p&&(f=e-f),u>a||f>a)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:h,k1:u,k2neg:p,k2:f}}}},sha256),_0n=BigInt(0),TAGGED_HASH_PREFIXES={};function taggedHash(n,...e){let t=TAGGED_HASH_PREFIXES[n];if(t===void 0){const r=sha256(Uint8Array.from(n,s=>s.charCodeAt(0)));t=concatBytes(r,r),TAGGED_HASH_PREFIXES[n]=t}return sha256(concatBytes(t,...e))}const pointToBytes=n=>n.toRawBytes(!0).slice(1),numTo32b=n=>numberToBytesBE(n,32),modP=n=>mod(n,secp256k1P),modN=n=>mod(n,secp256k1N),Point=secp256k1.ProjectivePoint,GmulAdd=(n,e,t)=>Point.BASE.multiplyAndAddUnsafe(n,e,t);function schnorrGetExtPubKey(n){let e=secp256k1.utils.normPrivateKeyToScalar(n),t=Point.fromPrivateKey(e);return{scalar:t.hasEvenY()?e:modN(-e),bytes:pointToBytes(t)}}function lift_x(n){aInRange("x",n,_1n,secp256k1P);const e=modP(n*n),t=modP(e*n+BigInt(7));let r=sqrtMod(t);r%_2n!==_0n&&(r=modP(-r));const s=new Point(n,r,_1n);return s.assertValidity(),s}const num=bytesToNumberBE;function challenge(...n){return modN(num(taggedHash("BIP0340/challenge",...n)))}function schnorrGetPublicKey(n){return schnorrGetExtPubKey(n).bytes}function schnorrSign(n,e,t=randomBytes(32)){const r=ensureBytes("message",n),{bytes:s,scalar:o}=schnorrGetExtPubKey(e),a=ensureBytes("auxRand",t,32),c=numTo32b(o^num(taggedHash("BIP0340/aux",a))),l=taggedHash("BIP0340/nonce",c,s,r),u=modN(num(l));if(u===_0n)throw new Error("sign failed: k is zero");const{bytes:f,scalar:h}=schnorrGetExtPubKey(u),p=challenge(f,s,r),g=new Uint8Array(64);if(g.set(f,0),g.set(numTo32b(modN(h+p*o)),32),!schnorrVerify(g,r,s))throw new Error("sign: Invalid signature produced");return g}function schnorrVerify(n,e,t){const r=ensureBytes("signature",n,64),s=ensureBytes("message",e),o=ensureBytes("publicKey",t,32);try{const a=lift_x(num(o)),c=num(r.subarray(0,32));if(!inRange(c,_1n,secp256k1P))return!1;const l=num(r.subarray(32,64));if(!inRange(l,_1n,secp256k1N))return!1;const u=challenge(numTo32b(c),pointToBytes(a),s),f=GmulAdd(a,l,modN(-u));return!(!f||!f.hasEvenY()||f.toAffine().x!==c)}catch{return!1}}const schnorr={getPublicKey:schnorrGetPublicKey,sign:schnorrSign,verify:schnorrVerify,utils:{randomPrivateKey:secp256k1.utils.randomPrivateKey,lift_x,pointToBytes,numberToBytesBE,bytesToNumberBE,taggedHash,mod}};var dist={},LRUCache$1={},LRUCacheNode$1={};Object.defineProperty(LRUCacheNode$1,"__esModule",{value:!0});LRUCacheNode$1.LRUCacheNode=void 0;class LRUCacheNode{constructor(e,t,r){const{entryExpirationTimeInMS:s=null,next:o=null,prev:a=null,onEntryEvicted:c,onEntryMarkedAsMostRecentlyUsed:l,clone:u,cloneFn:f}=r??{};if(typeof s=="number"&&(s<=0||Number.isNaN(s)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=u??!1,this.cloneFn=f??this.defaultClone,this.key=e,this.internalValue=this.clone?this.cloneFn(t):t,this.created=Date.now(),this.entryExpirationTimeInMS=s,this.next=o,this.prev=a,this.onEntryEvicted=c,this.onEntryMarkedAsMostRecentlyUsed=l}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return typeof this.entryExpirationTimeInMS=="number"&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:e,value:t,isExpired:r}=this;this.onEntryEvicted({key:e,value:t,isExpired:r})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:e,value:t}=this;this.onEntryMarkedAsMostRecentlyUsed({key:e,value:t})}}defaultClone(e){return typeof e=="boolean"||typeof e=="string"||typeof e=="number"?e:JSON.parse(JSON.stringify(e))}}LRUCacheNode$1.LRUCacheNode=LRUCacheNode;Object.defineProperty(LRUCache$1,"__esModule",{value:!0});LRUCache$1.LRUCache=void 0;const LRUCacheNode_1=LRUCacheNode$1;class LRUCache{constructor(e){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:t=25,entryExpirationTimeInMS:r=null,onEntryEvicted:s,onEntryMarkedAsMostRecentlyUsed:o,cloneFn:a,clone:c}=e??{};if(Number.isNaN(t)||t<=0)throw new Error("maxSize must be greater than 0.");if(typeof r=="number"&&(r<=0||Number.isNaN(r)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=t,this.entryExpirationTimeInMS=r,this.onEntryEvicted=s,this.onEntryMarkedAsMostRecentlyUsed=o,this.clone=c,this.cloneFn=a}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(e){if(Number.isNaN(e)||e<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=e,this.enforceSizeLimit()}set(e,t,r){const s=this.lookupTable.get(e);s&&this.removeNodeFromListAndLookupTable(s);const o=new LRUCacheNode_1.LRUCacheNode(e,t,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...r});return this.setNodeAsHead(o),this.lookupTable.set(e,o),this.enforceSizeLimit(),this}get(e){const t=this.lookupTable.get(e);return t?t.isExpired?(this.removeNodeFromListAndLookupTable(t),null):(this.setNodeAsHead(t),t.value):null}peek(e){const t=this.lookupTable.get(e);return t?t.isExpired?(this.removeNodeFromListAndLookupTable(t),null):t.value:null}delete(e){const t=this.lookupTable.get(e);return t?this.removeNodeFromListAndLookupTable(t):!1}has(e){const t=this.lookupTable.get(e);return t?t.isExpired?(this.removeNodeFromListAndLookupTable(t),!1):!0:!1}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(e){let t=this.head;for(;t;){if(t.isExpired){const s=t.next;this.removeNodeFromListAndLookupTable(t),t=s;continue}const r=this.mapNodeToEntry(t);if(e(r))return this.setNodeAsHead(t),r;t=t.next}return null}forEach(e){let t=this.head,r=0;for(;t;){if(t.isExpired){const s=t.next;this.removeNodeFromListAndLookupTable(t),t=s;continue}e(t.value,t.key,r),t=t.next,r++}}*values(){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}yield e.value,e=e.next}}*keys(){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}yield e.key,e=e.next}}*entries(){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}yield this.mapNodeToEntry(e),e=e.next}}*[Symbol.iterator](){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}yield this.mapNodeToEntry(e),e=e.next}}enforceSizeLimit(){let e=this.tail;for(;e!==null&&this.size>this.maxSizeInternal;){const t=e.prev;this.removeNodeFromListAndLookupTable(e),e=t}}mapNodeToEntry({key:e,value:t}){return{key:e,value:t}}setNodeAsHead(e){this.removeNodeFromList(e),this.head?(e.next=this.head,this.head.prev=e,this.head=e):(this.head=e,this.tail=e),e.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(e){e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.head===e&&(this.head=e.next),this.tail===e&&(this.tail=e.prev),e.next=null,e.prev=null}removeNodeFromListAndLookupTable(e){return e.invokeOnEvicted(),this.removeNodeFromList(e),this.lookupTable.delete(e.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const e=[];for(const t of this.lookupTable.values())t.isExpired&&e.push(t);e.forEach(t=>this.removeNodeFromListAndLookupTable(t))}}LRUCache$1.LRUCache=LRUCache;(function(n){var e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(r,s,o,a){a===void 0&&(a=o);var c=Object.getOwnPropertyDescriptor(s,o);(!c||("get"in c?!s.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return s[o]}}),Object.defineProperty(r,a,c)}:function(r,s,o,a){a===void 0&&(a=o),r[a]=s[o]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(r,s){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(s,o)&&e(s,r,o)};Object.defineProperty(n,"__esModule",{value:!0}),t(LRUCache$1,n)})(dist);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function isBytes(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}function chain(...n){const e=o=>o,t=(o,a)=>c=>o(a(c)),r=n.map(o=>o.encode).reduceRight(t,e),s=n.map(o=>o.decode).reduce(t,e);return{encode:r,decode:s}}function alphabet(n){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(t=>{if(t<0||t>=n.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${n.length})`);return n[t]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(t=>{if(typeof t!="string")throw new Error(`alphabet.decode: not string element=${t}`);const r=n.indexOf(t);if(r===-1)throw new Error(`Unknown letter: "${t}". Allowed: ${n}`);return r})}}}function join(n=""){if(typeof n!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let t of e)if(typeof t!="string")throw new Error(`join.encode: non-string input=${t}`);return e.join(n)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(n)}}}const gcd=(n,e)=>e?gcd(e,n%e):n,radix2carry=(n,e)=>n+(e-gcd(n,e));function convertRadix2(n,e,t,r){if(!Array.isArray(n))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(radix2carry(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${radix2carry(e,t)}`);let s=0,o=0;const a=2**t-1,c=[];for(const l of n){if(l>=2**e)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(s=s<<e|l,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=t;o-=t)c.push((s>>o-t&a)>>>0);s&=2**o-1}if(s=s<<t-o&a,!r&&o>=e)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&o>0&&c.push(s>>>0),c}function radix2(n,e=!1){if(n<=0||n>32)throw new Error("radix2: bits should be in (0..32]");if(radix2carry(8,n)>32||radix2carry(n,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!isBytes(t))throw new Error("radix2.encode input should be Uint8Array");return convertRadix2(Array.from(t),8,n,!e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(convertRadix2(t,n,8,e))}}}function unsafeWrapper(n){if(typeof n!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return n.apply(null,e)}catch{}}}const BECH_ALPHABET=chain(alphabet("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),join("")),POLYMOD_GENERATORS=[996825010,642813549,513874426,1027748829,705979059];function bech32Polymod(n){const e=n>>25;let t=(n&33554431)<<5;for(let r=0;r<POLYMOD_GENERATORS.length;r++)(e>>r&1)===1&&(t^=POLYMOD_GENERATORS[r]);return t}function bechChecksum(n,e,t=1){const r=n.length;let s=1;for(let o=0;o<r;o++){const a=n.charCodeAt(o);if(a<33||a>126)throw new Error(`Invalid prefix (${n})`);s=bech32Polymod(s)^a>>5}s=bech32Polymod(s);for(let o=0;o<r;o++)s=bech32Polymod(s)^n.charCodeAt(o)&31;for(let o of e)s=bech32Polymod(s)^o;for(let o=0;o<6;o++)s=bech32Polymod(s);return s^=t,BECH_ALPHABET.encode(convertRadix2([s%2**30],30,5,!1))}function genBech32(n){const e=n==="bech32"?1:734539939,t=radix2(5),r=t.decode,s=t.encode,o=unsafeWrapper(r);function a(h,p,g=90){if(typeof h!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof h}`);if(p instanceof Uint8Array&&(p=Array.from(p)),!Array.isArray(p)||p.length&&typeof p[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof p}`);if(h.length===0)throw new TypeError(`Invalid prefix length ${h.length}`);const y=h.length+7+p.length;if(g!==!1&&y>g)throw new TypeError(`Length ${y} exceeds limit ${g}`);const m=h.toLowerCase(),b=bechChecksum(m,p,e);return`${m}1${BECH_ALPHABET.encode(p)}${b}`}function c(h,p=90){if(typeof h!="string")throw new Error(`bech32.decode input should be string, not ${typeof h}`);if(h.length<8||p!==!1&&h.length>p)throw new TypeError(`Wrong string length: ${h.length} (${h}). Expected (8..${p})`);const g=h.toLowerCase();if(h!==g&&h!==h.toUpperCase())throw new Error("String must be lowercase or uppercase");const y=g.lastIndexOf("1");if(y===0||y===-1)throw new Error('Letter "1" must be present between prefix and data only');const m=g.slice(0,y),b=g.slice(y+1);if(b.length<6)throw new Error("Data must be at least 6 characters long");const v=BECH_ALPHABET.decode(b).slice(0,-6),$=bechChecksum(m,v,e);if(!b.endsWith($))throw new Error(`Invalid checksum in ${h}: expected "${$}"`);return{prefix:m,words:v}}const l=unsafeWrapper(c);function u(h){const{prefix:p,words:g}=c(h,!1);return{prefix:p,words:g,bytes:r(g)}}function f(h,p){return a(h,s(p))}return{encode:a,decode:c,encodeFromBytes:f,decodeToBytes:u,decodeUnsafe:l,fromWords:r,fromWordsUnsafe:o,toWords:s}}const bech32=genBech32("bech32");var lib={};(function(n){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(n,"__esModule",{value:!0}),n.bytes=n.stringToBytes=n.str=n.bytesToString=n.hex=n.utf8=n.bech32m=n.bech32=n.base58check=n.base58xmr=n.base58xrp=n.base58flickr=n.base58=n.base64url=n.base64=n.base32crockford=n.base32hex=n.base32=n.base16=n.utils=n.assertNumber=void 0;function e(x){if(!Number.isSafeInteger(x))throw new Error(`Wrong integer: ${x}`)}n.assertNumber=e;function t(...x){const S=(_,E)=>C=>_(E(C)),A=Array.from(x).reverse().reduce((_,E)=>_?S(_,E.encode):E.encode,void 0),R=x.reduce((_,E)=>_?S(_,E.decode):E.decode,void 0);return{encode:A,decode:R}}function r(x){return{encode:S=>{if(!Array.isArray(S)||S.length&&typeof S[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return S.map(A=>{if(e(A),A<0||A>=x.length)throw new Error(`Digit index outside alphabet: ${A} (alphabet: ${x.length})`);return x[A]})},decode:S=>{if(!Array.isArray(S)||S.length&&typeof S[0]!="string")throw new Error("alphabet.decode input should be array of strings");return S.map(A=>{if(typeof A!="string")throw new Error(`alphabet.decode: not string element=${A}`);const R=x.indexOf(A);if(R===-1)throw new Error(`Unknown letter: "${A}". Allowed: ${x}`);return R})}}}function s(x=""){if(typeof x!="string")throw new Error("join separator should be string");return{encode:S=>{if(!Array.isArray(S)||S.length&&typeof S[0]!="string")throw new Error("join.encode input should be array of strings");for(let A of S)if(typeof A!="string")throw new Error(`join.encode: non-string input=${A}`);return S.join(x)},decode:S=>{if(typeof S!="string")throw new Error("join.decode input should be string");return S.split(x)}}}function o(x,S="="){if(e(x),typeof S!="string")throw new Error("padding chr should be string");return{encode(A){if(!Array.isArray(A)||A.length&&typeof A[0]!="string")throw new Error("padding.encode input should be array of strings");for(let R of A)if(typeof R!="string")throw new Error(`padding.encode: non-string input=${R}`);for(;A.length*x%8;)A.push(S);return A},decode(A){if(!Array.isArray(A)||A.length&&typeof A[0]!="string")throw new Error("padding.encode input should be array of strings");for(let _ of A)if(typeof _!="string")throw new Error(`padding.decode: non-string input=${_}`);let R=A.length;if(R*x%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;R>0&&A[R-1]===S;R--)if(!((R-1)*x%8))throw new Error("Invalid padding: string has too much padding");return A.slice(0,R)}}}function a(x){if(typeof x!="function")throw new Error("normalize fn should be function");return{encode:S=>S,decode:S=>x(S)}}function c(x,S,A){if(S<2)throw new Error(`convertRadix: wrong from=${S}, base cannot be less than 2`);if(A<2)throw new Error(`convertRadix: wrong to=${A}, base cannot be less than 2`);if(!Array.isArray(x))throw new Error("convertRadix: data should be array");if(!x.length)return[];let R=0;const _=[],E=Array.from(x);for(E.forEach(C=>{if(e(C),C<0||C>=S)throw new Error(`Wrong integer: ${C}`)});;){let C=0,k=!0;for(let N=R;N<E.length;N++){const U=E[N],P=S*C+U;if(!Number.isSafeInteger(P)||S*C/S!==C||P-U!==S*C)throw new Error("convertRadix: carry overflow");if(C=P%A,E[N]=Math.floor(P/A),!Number.isSafeInteger(E[N])||E[N]*A+C!==P)throw new Error("convertRadix: carry overflow");if(k)E[N]?k=!1:R=N;else continue}if(_.push(C),k)break}for(let C=0;C<x.length-1&&x[C]===0;C++)_.push(0);return _.reverse()}const l=(x,S)=>S?l(S,x%S):x,u=(x,S)=>x+(S-l(x,S));function f(x,S,A,R){if(!Array.isArray(x))throw new Error("convertRadix2: data should be array");if(S<=0||S>32)throw new Error(`convertRadix2: wrong from=${S}`);if(A<=0||A>32)throw new Error(`convertRadix2: wrong to=${A}`);if(u(S,A)>32)throw new Error(`convertRadix2: carry overflow from=${S} to=${A} carryBits=${u(S,A)}`);let _=0,E=0;const C=2**A-1,k=[];for(const N of x){if(e(N),N>=2**S)throw new Error(`convertRadix2: invalid data word=${N} from=${S}`);if(_=_<<S|N,E+S>32)throw new Error(`convertRadix2: carry overflow pos=${E} from=${S}`);for(E+=S;E>=A;E-=A)k.push((_>>E-A&C)>>>0);_&=2**E-1}if(_=_<<A-E&C,!R&&E>=S)throw new Error("Excess padding");if(!R&&_)throw new Error(`Non-zero padding: ${_}`);return R&&E>0&&k.push(_>>>0),k}function h(x){return e(x),{encode:S=>{if(!(S instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return c(Array.from(S),2**8,x)},decode:S=>{if(!Array.isArray(S)||S.length&&typeof S[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(c(S,x,2**8))}}}function p(x,S=!1){if(e(x),x<=0||x>32)throw new Error("radix2: bits should be in (0..32]");if(u(8,x)>32||u(x,8)>32)throw new Error("radix2: carry overflow");return{encode:A=>{if(!(A instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return f(Array.from(A),8,x,!S)},decode:A=>{if(!Array.isArray(A)||A.length&&typeof A[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(f(A,x,8,S))}}}function g(x){if(typeof x!="function")throw new Error("unsafeWrapper fn should be function");return function(...S){try{return x.apply(null,S)}catch{}}}function y(x,S){if(e(x),typeof S!="function")throw new Error("checksum fn should be function");return{encode(A){if(!(A instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const R=S(A).slice(0,x),_=new Uint8Array(A.length+x);return _.set(A),_.set(R,A.length),_},decode(A){if(!(A instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const R=A.slice(0,-x),_=S(R).slice(0,x),E=A.slice(-x);for(let C=0;C<x;C++)if(_[C]!==E[C])throw new Error("Invalid checksum");return R}}}n.utils={alphabet:r,chain:t,checksum:y,radix:h,radix2:p,join:s,padding:o},n.base16=t(p(4),r("0123456789ABCDEF"),s("")),n.base32=t(p(5),r("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),s("")),n.base32hex=t(p(5),r("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),s("")),n.base32crockford=t(p(5),r("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),s(""),a(x=>x.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),n.base64=t(p(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),s("")),n.base64url=t(p(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),s(""));const m=x=>t(h(58),r(x),s(""));n.base58=m("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),n.base58flickr=m("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),n.base58xrp=m("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const b=[0,2,3,5,6,7,9,10,11];n.base58xmr={encode(x){let S="";for(let A=0;A<x.length;A+=8){const R=x.subarray(A,A+8);S+=n.base58.encode(R).padStart(b[R.length],"1")}return S},decode(x){let S=[];for(let A=0;A<x.length;A+=11){const R=x.slice(A,A+11),_=b.indexOf(R.length),E=n.base58.decode(R);for(let C=0;C<E.length-_;C++)if(E[C]!==0)throw new Error("base58xmr: wrong padding");S=S.concat(Array.from(E.slice(E.length-_)))}return Uint8Array.from(S)}};const v=x=>t(y(4,S=>x(x(S))),n.base58);n.base58check=v;const $=t(r("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),s("")),I=[996825010,642813549,513874426,1027748829,705979059];function O(x){const S=x>>25;let A=(x&33554431)<<5;for(let R=0;R<I.length;R++)(S>>R&1)===1&&(A^=I[R]);return A}function M(x,S,A=1){const R=x.length;let _=1;for(let E=0;E<R;E++){const C=x.charCodeAt(E);if(C<33||C>126)throw new Error(`Invalid prefix (${x})`);_=O(_)^C>>5}_=O(_);for(let E=0;E<R;E++)_=O(_)^x.charCodeAt(E)&31;for(let E of S)_=O(_)^E;for(let E=0;E<6;E++)_=O(_);return _^=A,$.encode(f([_%2**30],30,5,!1))}function L(x){const S=x==="bech32"?1:734539939,A=p(5),R=A.decode,_=A.encode,E=g(R);function C(P,F,D=90){if(typeof P!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof P}`);if(!Array.isArray(F)||F.length&&typeof F[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof F}`);const j=P.length+7+F.length;if(D!==!1&&j>D)throw new TypeError(`Length ${j} exceeds limit ${D}`);return P=P.toLowerCase(),`${P}1${$.encode(F)}${M(P,F,S)}`}function k(P,F=90){if(typeof P!="string")throw new Error(`bech32.decode input should be string, not ${typeof P}`);if(P.length<8||F!==!1&&P.length>F)throw new TypeError(`Wrong string length: ${P.length} (${P}). Expected (8..${F})`);const D=P.toLowerCase();if(P!==D&&P!==P.toUpperCase())throw new Error("String must be lowercase or uppercase");P=D;const j=P.lastIndexOf("1");if(j===0||j===-1)throw new Error('Letter "1" must be present between prefix and data only');const V=P.slice(0,j),K=P.slice(j+1);if(K.length<6)throw new Error("Data must be at least 6 characters long");const z=$.decode(K).slice(0,-6),Z=M(V,z,S);if(!K.endsWith(Z))throw new Error(`Invalid checksum in ${P}: expected "${Z}"`);return{prefix:V,words:z}}const N=g(k);function U(P){const{prefix:F,words:D}=k(P,!1);return{prefix:F,words:D,bytes:R(D)}}return{encode:C,decode:k,decodeToBytes:U,decodeUnsafe:N,fromWords:R,fromWordsUnsafe:E,toWords:_}}n.bech32=L("bech32"),n.bech32m=L("bech32m"),n.utf8={encode:x=>new TextDecoder().decode(x),decode:x=>new TextEncoder().encode(x)},n.hex=t(p(4),r("0123456789abcdef"),s(""),a(x=>{if(typeof x!="string"||x.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof x} with length ${x.length}`);return x.toLowerCase()}));const T={utf8:n.utf8,hex:n.hex,base16:n.base16,base32:n.base32,base64:n.base64,base64url:n.base64url,base58:n.base58,base58xmr:n.base58xmr},B=`Invalid encoding type. Available types: ${Object.keys(T).join(", ")}`,H=(x,S)=>{if(typeof x!="string"||!T.hasOwnProperty(x))throw new TypeError(B);if(!(S instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return T[x].encode(S)};n.bytesToString=H,n.str=n.bytesToString;const q=(x,S)=>{if(!T.hasOwnProperty(x))throw new TypeError(B);if(typeof S!="string")throw new TypeError("stringToBytes() expects string");return T[x].decode(S)};n.stringToBytes=q,n.bytes=n.stringToBytes})(lib);BigInt(1e3),BigInt(1e6),BigInt(1e9),BigInt(1e12);BigInt("2100000000000000000");BigInt(1e11);const TAGCODES={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27};for(let n=0,e=Object.keys(TAGCODES);n<e.length;n++)e[n],TAGCODES[e[n]].toString();function getRelaysForSync(n,e,t="write"){if(!n.outboxTracker)return;const r=n.outboxTracker.data.get(e);if(r)return t==="write"?r.writeRelays:r.readRelays}async function getWriteRelaysFor(n,e,t="write"){if(n.outboxTracker)return n.outboxTracker.data.has(e)||await n.outboxTracker.trackUsers([e]),getRelaysForSync(n,e,t)}function getTopRelaysForAuthors(n,e){const t=new Map;return e.forEach(s=>{const o=getRelaysForSync(n,s);o&&o.forEach(a=>{const c=t.get(a)||0;t.set(a,c+1)})}),Array.from(t.entries()).sort((s,o)=>o[1]-s[1]).map(s=>s[0])}function getAllRelaysForAllPubkeys(n,e,t="read"){const r=new Map,s=new Set;return e.forEach(o=>{const a=getRelaysForSync(n,o,t);a&&a.size>0?(a.forEach(c=>{(r.get(c)||new Set).add(o)}),r.set(o,a)):s.add(o)}),{pubkeysToRelays:r,authorsMissingRelays:s}}function chooseRelayCombinationForPubkeys(n,e,t,{count:r,preferredRelays:s}={}){r??(r=2),s??(s=new Set);const o=n.pool,a=o.connectedRelays();a.forEach(p=>{s.add(p.url)});const c=new Map,{pubkeysToRelays:l,authorsMissingRelays:u}=getAllRelaysForAllPubkeys(n,e,t),f=getTopRelaysForAuthors(n,e),h=(p,g)=>{const y=c.get(g)||[];y.push(p),c.set(g,y)};for(const[p,g]of l.entries()){let y=r;for(const m of a)g.has(m.url)&&(h(p,m.url),y--);for(const m of g)c.has(m)&&(h(p,m),y--);if(!(y<=0))for(const m of f){if(y<=0)break;g.has(m)&&(h(p,m),y--)}}for(const p of u)o.permanentAndConnectedRelays().forEach(g=>{const y=c.get(g.url)||[];y.push(p),c.set(g.url,y)});return c}function getRelaysForFilterWithAuthors(n,e,t=2){return chooseRelayCombinationForPubkeys(n,e,"write",{count:t})}function tryNormalizeRelayUrl(n){try{return normalizeRelayUrl(n)}catch{return}}function normalizeRelayUrl(n){let e=normalizeUrl(n.toLowerCase(),{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return e.endsWith("/")||(e+="/"),e}function normalize(n){const e=new Set;for(const t of n)try{e.add(normalizeRelayUrl(t))}catch{}return Array.from(e)}var DATA_URL_DEFAULT_MIME_TYPE="text/plain",DATA_URL_DEFAULT_CHARSET="us-ascii",testParameter=(n,e)=>e.some(t=>t instanceof RegExp?t.test(n):t===n),supportedProtocols=new Set(["https:","http:","file:"]),hasCustomProtocol=n=>{try{const{protocol:e}=new URL(n);return e.endsWith(":")&&!e.includes(".")&&!supportedProtocols.has(e)}catch{return!1}},normalizeDataURL=(n,{stripHash:e})=>{var h,p,g,y;const t=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(n);if(!t)throw new Error(`Invalid URL: ${n}`);let r=((h=t.groups)==null?void 0:h.type)??"",s=((p=t.groups)==null?void 0:p.data)??"",o=((g=t.groups)==null?void 0:g.hash)??"";const a=r.split(";");o=e?"":o;let c=!1;a[a.length-1]==="base64"&&(a.pop(),c=!0);const l=((y=a.shift())==null?void 0:y.toLowerCase())??"",f=[...a.map(m=>{let[b,v=""]=m.split("=").map($=>$.trim());return b==="charset"&&(v=v.toLowerCase(),v===DATA_URL_DEFAULT_CHARSET)?"":`${b}${v?`=${v}`:""}`}).filter(Boolean)];return c&&f.push("base64"),(f.length>0||l&&l!==DATA_URL_DEFAULT_MIME_TYPE)&&f.unshift(l),`data:${f.join(";")},${c?s.trim():s}${o?`#${o}`:""}`};function normalizeUrl(n,e){if(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e},typeof e.defaultProtocol=="string"&&!e.defaultProtocol.endsWith(":")&&(e.defaultProtocol=`${e.defaultProtocol}:`),n=n.trim(),/^data:/i.test(n))return normalizeDataURL(n,e);if(hasCustomProtocol(n))return n;const t=n.startsWith("//");!t&&/^\.*\//.test(n)||(n=n.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const s=new URL(n);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&s.protocol==="https:"&&(s.protocol="http:"),e.forceHttps&&s.protocol==="http:"&&(s.protocol="https:"),e.stripAuthentication&&(s.username="",s.password=""),e.stripHash?s.hash="":e.stripTextFragment&&(s.hash=s.hash.replace(/#?:~:text.*?$/i,"")),s.pathname){const a=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let c=0,l="";for(;;){const f=a.exec(s.pathname);if(!f)break;const h=f[0],p=f.index,g=s.pathname.slice(c,p);l+=g.replace(/\/{2,}/g,"/"),l+=h,c=p+h.length}const u=s.pathname.slice(c,s.pathname.length);l+=u.replace(/\/{2,}/g,"/"),s.pathname=l}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let a=s.pathname.split("/");const c=a[a.length-1];testParameter(c,e.removeDirectoryIndex)&&(a=a.slice(0,-1),s.pathname=a.slice(1).join("/")+"/")}if(s.hostname&&(s.hostname=s.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(s.hostname)&&(s.hostname=s.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(const a of[...s.searchParams.keys()])testParameter(a,e.removeQueryParameters)&&s.searchParams.delete(a);if(!Array.isArray(e.keepQueryParameters)&&e.removeQueryParameters===!0&&(s.search=""),Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const a of[...s.searchParams.keys()])testParameter(a,e.keepQueryParameters)||s.searchParams.delete(a);if(e.sortQueryParameters){s.searchParams.sort();try{s.search=decodeURIComponent(s.search)}catch{}}e.removeTrailingSlash&&(s.pathname=s.pathname.replace(/\/$/,"")),e.removeExplicitPort&&s.port&&(s.port="");const o=n;return n=s.toString(),!e.removeSingleSlash&&s.pathname==="/"&&!o.endsWith("/")&&s.hash===""&&(n=n.replace(/\/$/,"")),(e.removeTrailingSlash||s.pathname==="/")&&s.hash===""&&e.removeSingleSlash&&(n=n.replace(/\/$/,"")),t&&!e.normalizeProtocol&&(n=n.replace(/^http:\/\//,"//")),e.stripProtocol&&(n=n.replace(/^(?:https?:)?\/\//,"")),n}var MAX_RECONNECT_ATTEMPTS=5,FLAPPING_THRESHOLD_MS=1e3,NDKRelayConnectivity=class{constructor(n,e){w(this,"ndkRelay");w(this,"ws");w(this,"_status");w(this,"timeoutMs");w(this,"connectedAt");w(this,"_connectionStats",{attempts:0,success:0,durations:[]});w(this,"debug");w(this,"netDebug");w(this,"connectTimeout");w(this,"reconnectTimeout");w(this,"ndk");w(this,"openSubs",new Map);w(this,"openCountRequests",new Map);w(this,"openEventPublishes",new Map);w(this,"serial",0);w(this,"baseEoseTimeout",4400);w(this,"updateConnectionStats",{connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}});this.ndkRelay=n,this._status=1;const t=Math.floor(Math.random()*1e3);this.debug=this.ndkRelay.debug.extend("connectivity"+t),this.ndk=e}async connect(n,e=!0){if(this._status!==2&&this._status!==1||this.reconnectTimeout){this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);return}this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),n??(n=this.timeoutMs),!this.timeoutMs&&n&&(this.timeoutMs=n),this.timeoutMs&&(this.connectTimeout=setTimeout(()=>this.onConnectionError(e),this.timeoutMs));try{this.updateConnectionStats.attempt(),this._status===1?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(t){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,t),this._status=1,e?this.handleReconnection():this.ndkRelay.emit("delayed-connect",2*24*60*60*1e3),t}}disconnect(){var n;this._status=0;try{(n=this.ws)==null||n.close()}catch(e){this.debug("Failed to disconnect",e),this._status=1}}onConnectionError(n){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),n&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){var n;(n=this.netDebug)==null||n.call(this,"connected",this.ndkRelay),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){var n;(n=this.netDebug)==null||n.call(this,"disconnected",this.ndkRelay),this.updateConnectionStats.disconnected(),this._status===5&&this.handleReconnection(),this._status=1,this.ndkRelay.emit("disconnect")}onMessage(n){var e;(e=this.netDebug)==null||e.call(this,n.data,this.ndkRelay,"recv");try{const t=JSON.parse(n.data),[r,s,...o]=t;switch(r){case"EVENT":{const a=this.openSubs.get(s),c=t[2];if(!a){this.debug(`Received event for unknown subscription ${s}`);return}a.onevent(c);return}case"COUNT":{const a=t[2],c=this.openCountRequests.get(s);c&&(c.resolve(a.count),this.openCountRequests.delete(s));return}case"EOSE":{const a=this.openSubs.get(s);if(!a)return;a.oneose(s);return}case"OK":{const a=t[2],c=t[3],l=this.openEventPublishes.get(s),u=l==null?void 0:l.pop();if(!l||!u){this.debug("Received OK for unknown event publish",s);return}a?u.resolve(c):u.reject(new Error(c)),l.length===0?this.openEventPublishes.delete(s):this.openEventPublishes.set(s,l);return}case"CLOSED":{const a=this.openSubs.get(s);if(!a)return;a.onclosed(t[2]);return}case"NOTICE":this.onNotice(t[1]);return;case"AUTH":{this.onAuthRequested(t[1]);return}}}catch(t){this.debug(`Error parsing message from ${this.ndkRelay.url}: ${t.message}`,t==null?void 0:t.stack);return}}async onAuthRequested(n){var t,r,s;const e=this.ndkRelay.authPolicy??((t=this.ndk)==null?void 0:t.relayAuthDefaultPolicy);if(this.debug("Relay requested authentication",{havePolicy:!!e}),this._status===7){this.debug("Already authenticating, ignoring");return}if(this._status=6,e){if(this._status>=5){this._status=7;let o;try{o=await e(this.ndkRelay,n)}catch(a){this.debug("Authentication policy threw an error",a),o=!1}if(this.debug("Authentication policy returned",!!o),o instanceof NDKEvent||o===!0){o instanceof NDKEvent&&await this.auth(o);const a=async()=>{if(this._status>=5&&this._status<8){const c=new NDKEvent(this.ndk);c.kind=22242,c.tags=[["relay",this.ndkRelay.url],["challenge",n]],await c.sign(),this.auth(c).then(()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")}).catch(l=>{this._status=6,this.ndkRelay.emit("auth:failed",l),this.debug("Authentication failed",l)})}else this.debug("Authentication failed, it changed status, status is %d",this._status)};o===!0&&((r=this.ndk)!=null&&r.signer?a().catch(c=>{console.error("Error authenticating",c)}):(this.debug("No signer available for authentication localhost"),(s=this.ndk)==null||s.once("signer:ready",a))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",n)}onError(n){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,n)}get status(){return this._status}isAvailable(){return this._status===5}isFlapping(){const n=this._connectionStats.durations;if(n.length%3!==0)return!1;const t=n.reduce((a,c)=>a+c,0)/n.length,r=n.map(a=>Math.pow(a-t,2)).reduce((a,c)=>a+c,0)/n.length;return Math.sqrt(r)<FLAPPING_THRESHOLD_MS}async onNotice(n){this.ndkRelay.emit("notice",n)}handleReconnection(n=0){if(this.reconnectTimeout)return;if(this.isFlapping()){this.ndkRelay.emit("flapping",this._connectionStats),this._status=3;return}const e=this.connectedAt?Math.max(0,6e4-(Date.now()-this.connectedAt)):5e3*(this._connectionStats.attempts+1);this.reconnectTimeout=setTimeout(()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch(t=>{n<MAX_RECONNECT_ATTEMPTS?setTimeout(()=>{this.handleReconnection(n+1)},1e3*(n+1)^4):this.debug("Reconnect failed")})},e),this.ndkRelay.emit("delayed-connect",e),this.debug("Reconnecting in",e),this._connectionStats.nextReconnectAt=Date.now()+e}async send(n){var e,t,r;this._status>=5&&((e=this.ws)==null?void 0:e.readyState)===WebSocket.OPEN?((t=this.ws)==null||t.send(n),(r=this.netDebug)==null||r.call(this,n,this.ndkRelay,"send")):this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${n}`,this._status)}async auth(n){const e=new Promise((t,r)=>{const s=this.openEventPublishes.get(n.id)??[];s.push({resolve:t,reject:r}),this.openEventPublishes.set(n.id,s)});return this.send('["AUTH",'+JSON.stringify(n.rawEvent())+"]"),e}async publish(n){const e=new Promise((t,r)=>{const s=this.openEventPublishes.get(n.id)??[];s.length>0&&console.warn("Duplicate event publishing detected, you are publishing event "+n.id+" twice"),s.push({resolve:t,reject:r}),this.openEventPublishes.set(n.id,s)});return this.send('["EVENT",'+JSON.stringify(n)+"]"),e}async count(n,e){this.serial++;const t=(e==null?void 0:e.id)||"count:"+this.serial,r=new Promise((s,o)=>{this.openCountRequests.set(t,{resolve:s,reject:o})});return this.send('["COUNT","'+t+'",'+JSON.stringify(n).substring(1)),r}close(n,e){this.send('["CLOSE","'+n+'"]');const t=this.openSubs.get(n);this.openSubs.delete(n),t&&t.onclose(e)}req(n){this.send('["REQ","'+n.subId+'",'+JSON.stringify(n.executeFilters).substring(1))+"",this.openSubs.set(n.subId,n)}get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){var n;return this._status>=5&&((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN}},NDKRelayPublisher=class{constructor(n){w(this,"ndkRelay");w(this,"debug");this.ndkRelay=n,this.debug=n.debug.extend("publisher")}async publish(n,e=2500){let t;const r=()=>new Promise((f,h)=>{try{this.publishEvent(n).then(p=>{this.ndkRelay.emit("published",n),n.emit("relay:published",this.ndkRelay),f(!0)}).catch(h)}catch(p){h(p)}}),s=new Promise((f,h)=>{t=setTimeout(()=>{t=void 0,h(new Error("Timeout: "+e+"ms"))},e)}),o=()=>{r().then(f=>a(f)).catch(f=>c(f))};let a,c;const l=f=>{throw this.ndkRelay.debug("Publish failed",f,n.id),this.ndkRelay.emit("publish:failed",n,f),n.emit("relay:publish:failed",this.ndkRelay,f),f},u=()=>{t&&clearTimeout(t),this.ndkRelay.removeListener("connect",o)};return this.ndkRelay.status>=5?Promise.race([r(),s]).catch(l).finally(u):(this.ndkRelay.status<=1?(console.warn("Relay is disconnected, trying to connect to publish an event",this.ndkRelay.url),this.ndkRelay.connect()):console.warn("Relay not connected, waiting for connection to publish an event",this.ndkRelay.url),Promise.race([new Promise((f,h)=>{a=f,c=h,this.ndkRelay.once("connect",o)}),s]).catch(l).finally(u))}async publishEvent(n){return this.ndkRelay.connectivity.publish(n.rawEvent())}};function filterFingerprint(n,e){const t=[];for(const s of n){const o=Object.entries(s||{}).map(([a,c])=>["since","until"].includes(a)?a+":"+c:a).sort().join("-");t.push(o)}let r=e?"+":"";return r+=t.join("|"),r}function mergeFilters(n){const e=[],t={};return n.filter(r=>!!r.limit).forEach(r=>e.push(r)),n=n.filter(r=>!r.limit),n.length===0?e:(n.forEach(r=>{Object.entries(r).forEach(([s,o])=>{Array.isArray(o)?t[s]===void 0?t[s]=[...o]:t[s]=Array.from(new Set([...t[s],...o])):t[s]=o})}),[...e,t])}var NDKRelaySubscription=class{constructor(n,e){w(this,"fingerprint");w(this,"items",new Map);w(this,"topSubscriptionManager");w(this,"debug");w(this,"status",0);w(this,"onClose");w(this,"relay");w(this,"eosed",!1);w(this,"executionTimer");w(this,"fireTime");w(this,"delayType");w(this,"executeFilters");w(this,"id",Math.random().toString(36).substring(7));w(this,"_subId");w(this,"subIdParts",new Set);w(this,"executeOnRelayReady",()=>{this.status===2&&(this.status=1,this.execute())});w(this,"reExecuteAfterAuth",(()=>{const n=this.subId;this.debug("Re-executing after auth",this.items.size),this.eosed?this.relay.close(this.subId):this.debug("We are abandoning an opened subscription, once it EOSE's, the handler will close it",{oldSubId:n}),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s 👉 %s",n,this.subId)}).bind(this));this.relay=n,this.debug=n.debug.extend("subscription-"+this.id),this.fingerprint=e||Math.random().toString(36).substring(7)}get subId(){return this._subId?this._subId:(this._subId=this.fingerprint.slice(0,15),this._subId)}addSubIdPart(n){this.subIdParts.add(n)}addItem(n,e){if(!this.items.has(n.internalId))switch(n.on("close",this.removeItem.bind(this,n)),this.items.set(n.internalId,{subscription:n,filters:e}),this.status!==3&&n.subId&&(!this._subId||this._subId.length<48)&&(this.status===0||this.status===1)&&this.addSubIdPart(n.subId),this.status){case 0:this.evaluateExecutionPlan(n);break;case 3:console.log("BUG: This should not happen: This subscription needs to catch up with a subscription that was already running",e);break;case 1:this.evaluateExecutionPlan(n);break;case 4:throw this.debug("Subscription is closed, cannot add new items %o (%o)",n,e),new Error("Cannot add new items to a closed subscription")}}removeItem(n){if(this.items.delete(n.internalId),this.items.size===0){if(!this.eosed)return;this.close()}}close(){if(this.status===4)return;const n=this.status;if(this.status=4,n===3)try{this.relay.close(this.subId)}catch(e){this.debug("Error closing subscription",e,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:n,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}evaluateExecutionPlan(n){if(!n.isGroupable()){this.status=1,this.execute();return}if(n.filters.find(r=>!!r.limit)&&(this.executeFilters=this.compileFilters(),this.executeFilters.length>=10)){this.status=1,this.execute();return}const e=n.groupableDelay,t=n.groupableDelayType;if(!e)throw new Error("Cannot group a subscription without a delay");if(this.status===0)this.schedule(e,t);else{const r=this.delayType,s=this.fireTime-Date.now();if(r==="at-least"&&t==="at-least")s<e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,t));else if(r==="at-least"&&t==="at-most")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,t));else if(r==="at-most"&&t==="at-most")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,t));else if(r==="at-most"&&t==="at-least")s>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,t));else throw new Error("Unknown delay type combination "+r+" "+t)}}schedule(n,e){this.status=1;const t=Date.now();this.fireTime=t+n,this.delayType=e;const r=setTimeout(this.execute.bind(this),n);e==="at-least"&&(this.executionTimer=r)}finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+="-"+Math.random().toString(36).substring(2,7)}execute(){if(this.status===1){if(this.relay.connected)this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth);else{this.status=2,this.relay.once("ready",this.executeOnRelayReady);return}this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(n){var e;(e=this.topSubscriptionManager)==null||e.seenEvent(n.id,this.relay);for(const{subscription:t}of this.items.values())matchFilters(t.filters,n)&&t.eventReceived(n,this.relay,!1)}oneose(n){if(this.eosed=!0,n!==this.subId){this.debug("Received EOSE for an abandoned subscription",n,this.subId),this.relay.close(n);return}this.items.size===0&&this.close();for(const{subscription:e}of this.items.values())e.eoseReceived(this.relay),e.closeOnEose&&this.removeItem(e)}onclose(n){this.status=4}onclosed(n){if(n)for(const{subscription:e}of this.items.values())e.closedReceived(this.relay,n)}compileFilters(){const n=[],e=Array.from(this.items.values()).map(r=>r.filters);if(!e[0])return this.debug("👀 No filters to merge",this.items),console.error("BUG: No filters to merge!",this.items),[];const t=e[0].length;for(let r=0;r<t;r++){const s=e.map(o=>o[r]);n.push(...mergeFilters(s))}return n}},NDKRelaySubscriptionManager=class{constructor(n,e){w(this,"relay");w(this,"subscriptions");w(this,"topSubscriptionManager");this.relay=n,this.subscriptions=new Map,this.topSubscriptionManager=e}addSubscription(n,e){let t;if(!n.isGroupable())t=this.createSubscription(n,e);else{const r=filterFingerprint(e,n.closeOnEose);r&&(t=(this.subscriptions.get(r)||[]).find(o=>o.status<3)),t??(t=this.createSubscription(n,e,r))}t.addItem(n,e)}createSubscription(n,e,t){const r=new NDKRelaySubscription(this.relay,t);r.topSubscriptionManager=this.topSubscriptionManager,r.onClose=this.onRelaySubscriptionClose.bind(this);const s=this.subscriptions.get(r.fingerprint)??[];return this.subscriptions.set(r.fingerprint,[...s,r]),r}onRelaySubscriptionClose(n){let e=this.subscriptions.get(n.fingerprint)??[];e?e.length===1?this.subscriptions.delete(n.fingerprint):(e=e.filter(t=>t.id!==n.id),this.subscriptions.set(n.fingerprint,e),console.log("removing a subscription",{fingerprint:n.fingerprint,id:n.id,newSize:this.subscriptions.size})):console.warn("Unexpectedly did not find a subscription with fingerprint",n.fingerprint)}},re,NDKRelay=(re=class extends lib$1.EventEmitter{constructor(t,r,s){super();w(this,"url");w(this,"scores");w(this,"connectivity");w(this,"subs");w(this,"publisher");w(this,"authPolicy");w(this,"lowestValidationRatio");w(this,"targetValidationRatio");w(this,"validationRatioFn");w(this,"validatedEventCount",0);w(this,"nonValidatedEventCount",0);w(this,"trusted",!1);w(this,"complaining",!1);w(this,"debug");w(this,"req");w(this,"close");this.url=normalizeRelayUrl(t),this.scores=new Map,this.debug=debug7(`ndk:relay:${t}`),this.connectivity=new NDKRelayConnectivity(this,s),this.connectivity.netDebug=s==null?void 0:s.netDebug,this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new NDKRelaySubscriptionManager(this,s==null?void 0:s.subManager),this.publisher=new NDKRelayPublisher(this),this.authPolicy=r,this.targetValidationRatio=s==null?void 0:s.initialValidationRatio,this.lowestValidationRatio=s==null?void 0:s.lowestValidationRatio,this.validationRatioFn=((s==null?void 0:s.validationRatioFn)??re.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),s||console.trace("relay created without ndk")}updateValidationRatio(){setTimeout(()=>{this.updateValidationRatio()},3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(t,r=!0){return this.connectivity.connect(t,r)}disconnect(){this.status!==1&&this.connectivity.disconnect()}subscribe(t,r){this.subs.addSubscription(t,r)}async publish(t,r=2500){return this.publisher.publish(t,r)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return this.nonValidatedEventCount===0?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return this.trusted?!1:this.targetValidationRatio===void 0?!0:this.validationRatio<this.targetValidationRatio}get connected(){return this.connectivity.connected}},w(re,"defaultValidationRatioUpdateFn",(t,r,s)=>{if(t.lowestValidationRatio===void 0||t.targetValidationRatio===void 0)return 1;let o=t.validationRatio;if(t.validationRatio>t.targetValidationRatio){const a=r/100;o=Math.max(t.lowestValidationRatio,t.validationRatio-a)}return o<t.validationRatio?o:t.validationRatio}),re),NDKPublishError=class extends Error{constructor(e,t,r,s){super(e);w(this,"errors");w(this,"publishedToRelays");w(this,"intendedRelaySet");this.errors=t,this.publishedToRelays=r,this.intendedRelaySet=s}get relayErrors(){const e=[];for(const[t,r]of this.errors)e.push(`${t.url}: ${r}`);return e.join(`
`)}},NDKRelaySet=class ae{constructor(e,t){w(this,"relays");w(this,"debug");w(this,"ndk");this.relays=e,this.ndk=t,this.debug=t.debug.extend("relayset")}addRelay(e){this.relays.add(e)}get relayUrls(){return Array.from(this.relays).map(e=>e.url)}static fromRelayUrls(e,t,r=!0){const s=new Set;for(const o of e){const a=t.pool.relays.get(normalizeRelayUrl(o));if(a)a.status<5&&r&&a.connect(),s.add(a);else{const c=new NDKRelay(normalizeRelayUrl(o),t==null?void 0:t.relayAuthDefaultPolicy,t);t.pool.useTemporaryRelay(c,void 0,"requested from fromRelayUrls "+e),s.add(c)}}return new ae(new Set(s),t)}async publish(e,t,r=1){const s=new Set,o=new Map,a=e.isEphemeral();e.publishStatus="pending";const c=Array.from(this.relays).map(l=>new Promise(u=>{l.publish(e,t).then(f=>{s.add(l),u()}).catch(f=>{a||o.set(l,f),u()})}));if(await Promise.all(c),s.size<r){if(!a){const l=new NDKPublishError("Not enough relays received the event",o,s,this);throw e.publishStatus="error",e.publishError=l,this.ndk.emit("event:publish-failed",e,l,this.relayUrls),l}}else e.emit("published",{relaySet:this,publishedToRelays:s});return s}get size(){return this.relays.size}},d=debug7("ndk:outbox:calculate");async function calculateRelaySetFromEvent(n,e){var a;const t=new Set,r=await getWriteRelaysFor(n,e.pubkey);r&&r.forEach(c=>{var u;const l=(u=n.pool)==null?void 0:u.getRelay(c);l&&t.add(l)});let s=e.tags.filter(c=>["a","e"].includes(c[0])).map(c=>c[2]).filter(c=>c&&c.startsWith("wss://")).filter(c=>{try{return new URL(c),!0}catch{return!1}}).map(c=>normalizeRelayUrl(c));s=Array.from(new Set(s)).slice(0,5),s.forEach(c=>{var u;const l=(u=n.pool)==null?void 0:u.getRelay(c,!0,!0);l&&(d("Adding relay hint %s",c),t.add(l))});const o=e.getMatchingTags("p").map(c=>c[1]);return o.length<5?Array.from(chooseRelayCombinationForPubkeys(n,o,"read",{preferredRelays:new Set(r)}).keys()).forEach(l=>{var f;const u=(f=n.pool)==null?void 0:f.getRelay(l,!1,!0);u&&(d("Adding p-tagged relay %s",l),t.add(u))}):d("Too many p-tags to consider %d",o.length),(a=n.pool)==null||a.permanentAndConnectedRelays().forEach(c=>t.add(c)),new NDKRelaySet(t,n)}function calculateRelaySetsFromFilter(n,e,t){const r=new Map,s=new Set;if(e.forEach(o=>{o.authors&&o.authors.forEach(a=>s.add(a))}),s.size>0){const o=getRelaysForFilterWithAuthors(n,Array.from(s));for(const a of o.keys())r.set(a,[]);for(const a of e)if(a.authors)for(const[c,l]of o.entries()){const u=a.authors.filter(f=>l.includes(f));r.set(c,[...r.get(c),{...a,authors:u}])}else for(const c of o.keys())r.set(c,[...r.get(c),a])}else n.explicitRelayUrls&&n.explicitRelayUrls.forEach(o=>{r.set(o,e)});return r.size===0&&t.permanentAndConnectedRelays().slice(0,5).forEach(o=>{r.set(o.url,e)}),r}function calculateRelaySetsFromFilters(n,e,t){return calculateRelaySetsFromFilter(n,e,t)}function mergeTags(n,e){const t=new Map,r=a=>a.join(","),s=(a,c)=>a.every((l,u)=>l===c[u]),o=a=>{for(const[c,l]of t)if(s(l,a)||s(a,l)){a.length>=l.length&&t.set(c,a);return}t.set(r(a),a)};return n.concat(e).forEach(o),Array.from(t.values())}async function generateContentTags(n,e=[]){const t=/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,r=new RegExp(`(?<=\\s|^)(#[^\\s!@#$%^&*()=+./,[{\\]};:'"?><]+)`,"g"),s=[],o=a=>{e.find(c=>["q",a[0]].includes(c[0])&&c[1]===a[1])||e.push(a)};return n=n.replace(t,a=>{try{const c=a.split(/(@|nostr:)/)[2],{type:l,data:u}=nip19_exports.decode(c);let f;switch(l){case"npub":f=["p",u];break;case"nprofile":f=["p",u.pubkey];break;case"note":s.push(new Promise(async h=>{o(["e",u,await maybeGetEventRelayUrl(c),"mention"]),h()}));break;case"nevent":s.push(new Promise(async h=>{const{id:p,author:g}=u;let{relays:y}=u;(!y||y.length===0)&&(y=[await maybeGetEventRelayUrl(c)]),o(["e",p,y[0],"mention"]),g&&o(["p",g]),h()}));break;case"naddr":s.push(new Promise(async h=>{const p=[u.kind,u.pubkey,u.identifier].join(":");let g=u.relays??[];g.length===0&&(g=[await maybeGetEventRelayUrl(c)]),o(["a",p,g[0],"mention"]),o(["p",u.pubkey]),h()}));break;default:return a}return f&&o(f),`nostr:${c}`}catch{return a}}),await Promise.all(s),n=n.replace(r,(a,c)=>{const l=["t",c.slice(1)];return e.find(u=>u[0]===l[0]&&u[1]===l[1])||e.push(l),a}),{content:n,tags:e}}async function maybeGetEventRelayUrl(n){return""}function isReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function isEphemeral(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function isParamReplaceable(){if(this.kind===void 0)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}var DEFAULT_ENCRYPTION_SCHEME="nip04";async function encrypt(n,e,t=DEFAULT_ENCRYPTION_SCHEME){if(!this.ndk)throw new Error("No NDK instance found!");if(e||(await this.ndk.assertSigner(),e=this.ndk.signer),!n){const r=this.getMatchingTags("p");if(r.length!==1)throw new Error("No recipient could be determined and no explicit recipient was provided");n=this.ndk.getUser({pubkey:r[0][1]})}this.content=await(e==null?void 0:e.encrypt(n,this.content,t))}async function decrypt(n,e,t=DEFAULT_ENCRYPTION_SCHEME){if(!this.ndk)throw new Error("No NDK instance found!");e||(await this.ndk.assertSigner(),e=this.ndk.signer),n||(n=this.author),this.content=await(e==null?void 0:e.decrypt(n,this.content,t))}function encode(n=5){let e=[];return this.onRelays.length>0?e=this.onRelays.map(t=>t.url):this.relay&&(e=[this.relay.url]),e.length>n&&(e=e.slice(0,n)),this.isParamReplaceable()?nip19_exports.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:e}):e.length>0?nip19_exports.neventEncode({id:this.tagId(),relays:e,author:this.pubkey}):nip19_exports.noteEncode(this.tagId())}async function repost(n=!0,e){if(!e&&n){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e=this.ndk.signer}const t=new NDKEvent(this.ndk,{kind:getKind(this),content:""});return t.tag(this),t.kind===16?t.tags.push(["k",`${this.kind}`]):t.content=JSON.stringify(this.rawEvent()),e&&await t.sign(e),n&&await t.publish(),t}function getKind(n){return n.kind===1?6:16}function eventHasETagMarkers(n){return n.getMatchingTags("e").some(e=>e[3])}function getRootTag(n,e){e??(e=n.tagType());const t=n.tags.find(r=>r[3]==="root");if(!t){if(eventHasETagMarkers(n))return;const r=n.getMatchingTags(e);if(r.length<3)return r[0]}return t}function getReplyTag(n,e){e??(e=n.tagType());let t=n.tags.find(r=>r[3]==="reply");if(t)return t;if(t||(t=n.tags.find(r=>r[3]==="root")),!t){if(eventHasETagMarkers(n))return;const r=n.getMatchingTags(e);if(r.length===1)return r[0];if(r.length===2)return r[1]}}async function fetchTaggedEvent(n,e){if(!this.ndk)throw new Error("NDK instance not found");const t=this.getMatchingTags(n,e);if(t.length===0)return;const[r,s,o]=t[0];return await this.ndk.fetchEvent(s,{},void 0)}async function fetchRootEvent(n){if(!this.ndk)throw new Error("NDK instance not found");const e=getRootTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,n)}async function fetchReplyEvent(n){if(!this.ndk)throw new Error("NDK instance not found");const e=getReplyTag(this);if(e)return this.ndk.fetchEventFromTag(e,this,n)}function serialize(n=!1,e=!1){const t=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return n&&t.push(this.sig),e&&t.push(this.id),JSON.stringify(t)}function deserialize(n){const e=JSON.parse(n),t={pubkey:e[1],created_at:e[2],kind:e[3],tags:e[4],content:e[5]};return e.length===7&&(t.sig=e[6]),e.length===8&&(t.id=e[7]),t}var worker,processingQueue={};function signatureVerificationInit(n){worker=n,worker.onmessage=e=>{const[t,r]=e.data,s=processingQueue[t];if(!s){console.error("No record found for event",t);return}delete processingQueue[t];for(const o of s.resolves)o(r)}}async function verifySignatureAsync(n,e){return new Promise(r=>{const s=n.serialize();let o=!1;processingQueue[n.id]||(processingQueue[n.id]={event:n,resolves:[]},o=!0),processingQueue[n.id].resolves.push(r),o&&worker.postMessage({serialized:s,id:n.id,sig:n.sig,pubkey:n.pubkey})})}var PUBKEY_REGEX=/^[a-f0-9]{64}$/;function validate(){if(typeof this.kind!="number"||typeof this.content!="string"||typeof this.created_at!="number"||typeof this.pubkey!="string"||!this.pubkey.match(PUBKEY_REGEX)||!Array.isArray(this.tags))return!1;for(let n=0;n<this.tags.length;n++){const e=this.tags[n];if(!Array.isArray(e))return!1;for(let t=0;t<e.length;t++)if(typeof e[t]=="object")return!1}return!0}var verifiedSignatures=new dist.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function verifySignature(n){var t;if(typeof this.signatureVerified=="boolean")return this.signatureVerified;const e=verifiedSignatures.get(this.id);if(e!==null)return this.signatureVerified=!!e;try{if((t=this.ndk)!=null&&t.asyncSigVerification)verifySignatureAsync(this,n).then(r=>{n&&(this.signatureVerified=r,r&&verifiedSignatures.set(this.id,this.sig)),r||(this.ndk.emit("event:invalid-sig",this),verifiedSignatures.set(this.id,!1))});else{const r=sha256(new TextEncoder().encode(this.serialize())),s=schnorr.verify(this.sig,r,this.pubkey);return s?verifiedSignatures.set(this.id,this.sig):verifiedSignatures.set(this.id,!1),this.signatureVerified=s}}catch{return this.signatureVerified=!1}}function getEventHash(){return getEventHashFromSerializedEvent(this.serialize())}function getEventHashFromSerializedEvent(n){const e=sha256(new TextEncoder().encode(n));return bytesToHex$1(e)}var skipClientTagOnKinds=[3],NDKEvent=class ie extends lib$1.EventEmitter{constructor(t,r){var s;super();w(this,"ndk");w(this,"created_at");w(this,"content","");w(this,"tags",[]);w(this,"kind");w(this,"id","");w(this,"sig");w(this,"pubkey","");w(this,"signatureVerified");w(this,"_author");w(this,"relay");w(this,"publishStatus","success");w(this,"publishError");w(this,"serialize",serialize.bind(this));w(this,"getEventHash",getEventHash.bind(this));w(this,"validate",validate.bind(this));w(this,"verifySignature",verifySignature.bind(this));w(this,"isReplaceable",isReplaceable.bind(this));w(this,"isEphemeral",isEphemeral.bind(this));w(this,"isParamReplaceable",isParamReplaceable.bind(this));w(this,"encode",encode.bind(this));w(this,"encrypt",encrypt.bind(this));w(this,"decrypt",decrypt.bind(this));w(this,"fetchTaggedEvent",fetchTaggedEvent.bind(this));w(this,"fetchRootEvent",fetchRootEvent.bind(this));w(this,"fetchReplyEvent",fetchReplyEvent.bind(this));w(this,"repost",repost.bind(this));this.ndk=t,this.created_at=r==null?void 0:r.created_at,this.content=(r==null?void 0:r.content)||"",this.tags=(r==null?void 0:r.tags)||[],this.id=(r==null?void 0:r.id)||"",this.sig=r==null?void 0:r.sig,this.pubkey=(r==null?void 0:r.pubkey)||"",this.kind=r==null?void 0:r.kind,r instanceof ie&&(this.relay&&(this.relay=r.relay,(s=this.ndk)==null||s.subManager.seenEvent(r.id,this.relay)),this.publishStatus=r.publishStatus,this.publishError=r.publishError)}get onRelays(){let t=[];return this.ndk?t=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&t.push(this.relay),t}static deserialize(t,r){return new ie(t,deserialize(r))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(t){var r;this.pubkey=t.pubkey,this._author=t,(r=this._author).ndk??(r.ndk=this.ndk)}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const t=this.ndk.getUser({pubkey:this.pubkey});return this._author=t,t}tagExternal(t,r,s){let o=["i"],a=["k"];switch(r){case"url":const c=new URL(t);c.hash="",o.push(c.toString()),a.push(`${c.protocol}//${c.host}`);break;case"hashtag":o.push(`#${t.toLowerCase()}`),a.push("#");break;case"geohash":o.push(`geo:${t.toLowerCase()}`),a.push("geo");break;case"isbn":o.push(`isbn:${t.replace(/-/g,"")}`),a.push("isbn");break;case"podcast:guid":o.push(`podcast:guid:${t}`),a.push("podcast:guid");break;case"podcast:item:guid":o.push(`podcast:item:guid:${t}`),a.push("podcast:item:guid");break;case"podcast:publisher:guid":o.push(`podcast:publisher:guid:${t}`),a.push("podcast:publisher:guid");break;case"isan":o.push(`isan:${t.split("-").slice(0,4).join("-")}`),a.push("isan");break;case"doi":o.push(`doi:${t.toLowerCase()}`),a.push("doi");break;default:throw new Error(`Unsupported NIP-73 entity type: ${r}`)}s&&o.push(s),this.tags.push(o),this.tags.push(a)}tag(t,r,s,o){let a=[];if(t.fetchProfile!==void 0){o??(o="p");const l=[o,t.pubkey];r&&l.push("",r),a.push(l)}else if(t instanceof ie){const l=t;s??(s=(l==null?void 0:l.pubkey)===this.pubkey),a=l.referenceTags(r,s,o);for(const u of l.getMatchingTags("p"))u[1]!==this.pubkey&&(this.tags.find(f=>f[0]==="p"&&f[1]===u[1])||this.tags.push(["p",u[1]]))}else if(Array.isArray(t))a=[t];else throw new Error("Invalid argument",t);this.tags=mergeTags(this.tags,a)}async toNostrEvent(t){var o,a;if(!t&&this.pubkey===""){const c=await((a=(o=this.ndk)==null?void 0:o.signer)==null?void 0:a.user());this.pubkey=(c==null?void 0:c.pubkey)||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:r,tags:s}=await this.generateTags();this.content=r||"",this.tags=s;try{this.id=this.getEventHash()}catch{}return this.rawEvent()}getMatchingTags(t,r){const s=this.tags.filter(o=>o[0]===t);return r===void 0?s:s.filter(o=>o[3]===r)}hasTag(t,r){return this.tags.some(s=>s[0]===t&&(!r||s[3]===r))}tagValue(t){const r=this.getMatchingTags(t);if(r.length!==0)return r[0][1]}get alt(){return this.tagValue("alt")}set alt(t){this.removeTag("alt"),t&&this.tags.push(["alt",t])}get dTag(){return this.tagValue("d")}set dTag(t){this.removeTag("d"),t&&this.tags.push(["d",t])}removeTag(t){const r=Array.isArray(t)?t:[t];this.tags=this.tags.filter(s=>!r.includes(s[0]))}async sign(t){var s;t?this.author=await t.user():((s=this.ndk)==null||s.assertSigner(),t=this.ndk.signer);const r=await this.toNostrEvent();return this.sig=await t.sign(r),this.sig}async publishReplaceable(t,r,s){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(t,r,s)}async publish(t,r,s){var c,l;if(this.sig||await this.sign(),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");t||(t=this.ndk.devWriteRelaySet||await calculateRelaySetFromEvent(this.ndk,this)),this.kind===5&&((c=this.ndk.cacheAdapter)!=null&&c.deleteEvent)&&this.ndk.cacheAdapter.deleteEvent(this);const o=this.rawEvent();if((l=this.ndk.cacheAdapter)!=null&&l.addUnpublishedEvent)try{this.ndk.cacheAdapter.addUnpublishedEvent(this,t.relayUrls)}catch(u){console.error("Error adding unpublished event to cache",u)}this.ndk.subManager.subscriptions.forEach(u=>{u.filters.some(f=>matchFilter(f,o))&&u.eventReceived(this,void 0,!1,!0)});const a=await t.publish(this,r,s);return a.forEach(u=>{var f;return(f=this.ndk)==null?void 0:f.subManager.seenEvent(this.id,u)}),a}async generateTags(){var o,a;let t=[];const r=await generateContentTags(this.content,this.tags),s=r.content;if(t=r.tags,this.kind&&this.isParamReplaceable()&&!this.getMatchingTags("d")[0]){const l=this.tagValue("title");let f=[...Array(l?6:16)].map(()=>Math.random().toString(36)[2]).join("");l&&l.length>0&&(f=l.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")+"-"+f),t.push(["d",f])}if(((o=this.ndk)!=null&&o.clientName||(a=this.ndk)!=null&&a.clientNip89)&&skipClientTagOnKinds.includes(this.kind)&&!this.tags.some(c=>c[0]==="client")){const c=["client",this.ndk.clientName??""];this.ndk.clientNip89&&c.push(this.ndk.clientNip89),t.push(c)}return{content:s||"",tags:t}}muted(){var o,a;const t=(o=this.ndk)==null?void 0:o.mutedIds.get(this.pubkey);if(t&&t==="p")return"author";const r=this.tagReference(),s=(a=this.ndk)==null?void 0:a.mutedIds.get(r[1]);return s&&s===r[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return this.kind===0||this.kind===3||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(!this.isParamReplaceable())throw new Error("This must only be called on replaceable events");const t=this.replaceableDTag();return`${this.kind}:${this.pubkey}:${t}`}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(t){let r;return this.isParamReplaceable()?r=["a",this.tagAddress()]:r=["e",this.tagId()],this.relay?r.push(this.relay.url):r.push(""),t&&r.push(t),r}referenceTags(t,r,s){var a;let o=[];return this.isParamReplaceable()?o=[[s??"a",this.tagAddress()],[s??"e",this.id]]:o=[[s??"e",this.id]],(a=this.relay)!=null&&a.url?o=o.map(c=>{var l;return c.push((l=this.relay)==null?void 0:l.url),c}):t&&(o=o.map(c=>(c.push(""),c))),t&&o.forEach(c=>c.push(t)),o=[...o,...this.getMatchingTags("h")],r||o.push(...this.author.referenceTags()),o}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}async delete(t,r=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new ie(this.ndk,{kind:5,content:t||""});return s.tag(this,void 0,!0),s.tags.push(["k",this.kind.toString()]),r&&await s.publish(),s}async react(t,r=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const s=new ie(this.ndk,{kind:7,content:t});return s.tag(this),r?await s.publish():await s.sign(),s}get isValid(){return this.validate()}};function queryFullyFilled(n){return!!(filterIncludesIds(n.filter)&&resultHasAllRequestedIds(n))}function filterIncludesIds(n){return!!n.ids}function resultHasAllRequestedIds(n){const e=n.filter.ids;return!!e&&e.length===n.eventFirstSeen.size}function filterFromId(n){let e;if(n.match(NIP33_A_REGEX)){const[t,r,s]=n.split(":"),o={authors:[r],kinds:[parseInt(t)]};return s&&(o["#d"]=[s]),o}if(n.match(BECH32_REGEX))try{switch(e=nip19_exports.decode(n),e.type){case"nevent":{const r={ids:[e.data.id]};return e.data.author&&(r.authors=[e.data.author]),e.data.kind&&(r.kinds=[e.data.kind]),r}case"note":return{ids:[e.data]};case"naddr":const t={authors:[e.data.pubkey],kinds:[e.data.kind]};return e.data.identifier&&(t["#d"]=[e.data.identifier]),t}}catch(t){console.error("Error decoding",n,t)}return{ids:[n]}}function isNip33AValue(n){return n.match(NIP33_A_REGEX)!==null}var NIP33_A_REGEX=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,BECH32_REGEX=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;function relaysFromBech32(n,e){try{const t=nip19_exports.decode(n);if(["naddr","nevent"].includes(t==null?void 0:t.type)){const r=t.data;if(r!=null&&r.relays)return r.relays.map(s=>new NDKRelay(s,e==null?void 0:e.relayAuthDefaultPolicy,e))}}catch{}return[]}var defaultOpts={closeOnEose:!1,cacheUsage:"CACHE_FIRST",groupable:!0,groupableDelay:100,groupableDelayType:"at-most"},NDKSubscription=class extends lib$1.EventEmitter{constructor(e,t,r,s,o){super();w(this,"subId");w(this,"filters");w(this,"opts");w(this,"pool");w(this,"skipVerification",!1);w(this,"skipValidation",!1);w(this,"relayFilters");w(this,"relaySet");w(this,"ndk");w(this,"debug");w(this,"eventFirstSeen",new Map);w(this,"eosesSeen",new Set);w(this,"lastEventReceivedAt");w(this,"internalId");w(this,"closeOnEose");w(this,"poolMonitor");w(this,"skipOptimisticPublishEvent",!1);w(this,"eoseTimeout");w(this,"eosed",!1);if(this.ndk=e,this.pool=(r==null?void 0:r.pool)||e.pool,this.opts={...defaultOpts,...r||{}},this.filters=t instanceof Array?t:[t],this.subId=o||(r==null?void 0:r.subId),this.internalId=Math.random().toString(36).substring(7),this.relaySet=s,this.debug=e.debug.extend(`subscription[${(r==null?void 0:r.subId)??this.internalId}]`),this.skipVerification=(r==null?void 0:r.skipVerification)||!1,this.skipValidation=(r==null?void 0:r.skipValidation)||!1,this.closeOnEose=(r==null?void 0:r.closeOnEose)||!1,this.skipOptimisticPublishEvent=(r==null?void 0:r.skipOptimisticPublishEvent)||!1,this.opts.cacheUsage==="ONLY_CACHE"&&!this.opts.closeOnEose)throw new Error("Cannot use cache-only options with a persistent subscription")}relaysMissingEose(){return this.relayFilters?Array.from(this.relayFilters.keys()).filter(t=>!this.eosesSeen.has(this.pool.getRelay(t,!1,!1))):[]}get filter(){return this.filters[0]}get groupableDelay(){var e;if(this.isGroupable())return(e=this.opts)==null?void 0:e.groupableDelay}get groupableDelayType(){var e;return((e=this.opts)==null?void 0:e.groupableDelayType)||"at-most"}isGroupable(){var e;return((e=this.opts)==null?void 0:e.groupable)||!1}shouldQueryCache(){var e;return((e=this.opts)==null?void 0:e.cacheUsage)!=="ONLY_RELAY"}shouldQueryRelays(){var e;return((e=this.opts)==null?void 0:e.cacheUsage)!=="ONLY_CACHE"}shouldWaitForCache(){var e;return this.opts.closeOnEose&&!!((e=this.ndk.cacheAdapter)!=null&&e.locking)&&this.opts.cacheUsage!=="PARALLEL"}async start(){let e;if(this.shouldQueryCache()&&(e=this.startWithCache(),this.shouldWaitForCache()&&(await e,queryFullyFilled(this)))){this.emit("eose",this);return}this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)}startPoolMonitor(){this.debug.extend("pool-monitor"),this.poolMonitor=e=>{var r,s;if((r=this.relayFilters)!=null&&r.has(e.url))return;calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool).get(e.url)&&((s=this.relayFilters)==null||s.set(e.url,this.filters),e.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}stop(){this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),this.removeAllListeners()}hasAuthorsFilter(){return this.filters.some(e=>{var t;return(t=e.authors)==null?void 0:t.length})}async startWithCache(){var e;if((e=this.ndk.cacheAdapter)!=null&&e.query){const t=this.ndk.cacheAdapter.query(this);this.ndk.cacheAdapter.locking&&await t}}startWithRelays(){if(!this.relaySet||this.relaySet.relays.size===0)this.relayFilters=calculateRelaySetsFromFilters(this.ndk,this.filters,this.pool);else{this.relayFilters=new Map;for(const e of this.relaySet.relays)this.relayFilters.set(e.url,this.filters)}if(!(!this.relayFilters||this.relayFilters.size===0))for(const[e,t]of this.relayFilters)this.pool.getRelay(e,!0,!0,t).subscribe(this,t)}eventReceived(e,t,r=!1,s=!1){const o=e.id,a=this.eventFirstSeen.has(o);let c;if(e instanceof NDKEvent&&(c=e),a){const l=Date.now()-(this.eventFirstSeen.get(o)||0);if(this.emit("event:dup",o,t,l,this),t){const u=verifiedSignatures.get(o);u&&typeof u=="string"&&e.sig===u&&t.addValidatedEvent()}}else{if(c??(c=new NDKEvent(this.ndk,e)),c.ndk=this.ndk,c.relay=t,!r&&!s){if(!this.skipValidation&&!c.isValid){this.debug("Event failed validation %s from relay %s",o,t==null?void 0:t.url);return}if(t)if((t==null?void 0:t.shouldValidateEvent())!==!1){if(!this.skipVerification)if(!c.verifySignature(!0)&&!this.ndk.asyncSigVerification){this.debug("Event failed signature validation",e);return}else t&&t.addValidatedEvent()}else t.addNonValidatedEvent();this.ndk.cacheAdapter&&this.ndk.cacheAdapter.setEvent(c,this.filters,t)}!r&&t&&this.ndk.emit("event",c,t),(!s||this.skipOptimisticPublishEvent!==!0)&&(this.emit("event",c,t,this),this.eventFirstSeen.set(o,Date.now()))}this.lastEventReceivedAt=Date.now()}closedReceived(e,t){this.emit("closed",e,t)}eoseReceived(e){var a;this.debug("EOSE received from %s",e.url),this.eosesSeen.add(e);let t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const r=this.eosesSeen.size===((a=this.relayFilters)==null?void 0:a.size),s=queryFullyFilled(this),o=c=>{var l;this.debug("Performing EOSE: %s %d",c,this.eosed),!this.eosed&&(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.emit("eose",this),this.eosed=!0,(l=this.opts)!=null&&l.closeOnEose&&this.stop())};if(s||r)o("query filled or seen all");else if(this.relayFilters){let c=1e3;const l=new Set(this.pool.connectedRelays().map(h=>h.url)),u=Array.from(this.relayFilters.keys()).filter(h=>l.has(h));if(u.length===0)return;const f=this.eosesSeen.size/u.length;if(this.eosesSeen.size>=2&&f>=.5){if(c=c*(1-f),c===0){o("tiem to wait was 0");return}this.eoseTimeout&&clearTimeout(this.eoseTimeout);const h=()=>{t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,t!==void 0&&t<20?this.eoseTimeout=setTimeout(h,c):o("send eose timeout: "+c)};this.eoseTimeout=setTimeout(h,c)}}}};async function follows(n,e,t=3){var s,o;if(!this.ndk)throw new Error("NDK not set");const r=await this.ndk.fetchEvent({kinds:[t],authors:[this.pubkey]},n||{groupable:!1});if(r){const a=new Set;return r.tags.forEach(c=>{c[0]==="p"&&a.add(c[1])}),e&&((o=(s=this.ndk)==null?void 0:s.outboxTracker)==null||o.trackUsers(Array.from(a))),[...a].reduce((c,l)=>{const u=new NDKUser({pubkey:l});return u.ndk=this.ndk,c.add(u),c},new Set)}return new Set}function profileFromEvent(n){const e={};let t;try{t=JSON.parse(n.content)}catch(r){throw new Error(`Failed to parse profile event: ${r}`)}return e.created_at=n.created_at,e.profileEvent=JSON.stringify(n.rawEvent()),Object.keys(t).forEach(r=>{switch(r){case"name":e.name=t.name;break;case"display_name":e.displayName=t.display_name;break;case"image":case"picture":e.image=t.picture||t.image;break;case"banner":e.banner=t.banner;break;case"bio":e.bio=t.bio;break;case"nip05":e.nip05=t.nip05;break;case"lud06":e.lud06=t.lud06;break;case"lud16":e.lud16=t.lud16;break;case"about":e.about=t.about;break;case"zapService":e.zapService=t.zapService;break;case"website":e.website=t.website;break;default:e[r]=t[r];break}}),e}function serializeProfile(n){const e={};for(const[t,r]of Object.entries(n))switch(t){case"username":case"name":e.name=r;break;case"displayName":e.display_name=r;break;case"image":case"picture":e.picture=r;break;case"bio":case"about":e.about=r;break;default:e[t]=r;break}return JSON.stringify(e)}var NIP05_REGEX=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function getNip05For(n,e,t=fetch,r={}){return await n.queuesNip05.add({id:e,func:async()=>{if(n.cacheAdapter&&n.cacheAdapter.loadNip05){const l=await n.cacheAdapter.loadNip05(e);if(l!=="missing"){if(l){const u=new NDKUser({pubkey:l.pubkey,relayUrls:l.relays,nip46Urls:l.nip46});return u.ndk=n,u}else if(r.cache!=="no-cache")return null}}const s=e.match(NIP05_REGEX);if(!s)return null;const[o,a="_",c]=s;try{const l=await t(`https://${c}/.well-known/nostr.json?name=${a}`,r),{names:u,relays:f,nip46:h}=parseNIP05Result(await l.json()),p=u[a.toLowerCase()];let g=null;return p&&(g={pubkey:p,relays:f==null?void 0:f[p],nip46:h==null?void 0:h[p]}),n!=null&&n.cacheAdapter&&n.cacheAdapter.saveNip05&&n.cacheAdapter.saveNip05(e,g),g}catch(l){return n!=null&&n.cacheAdapter&&n.cacheAdapter.saveNip05&&(n==null||n.cacheAdapter.saveNip05(e,null)),console.error("Failed to fetch NIP05 for",e,l),null}}})}function parseNIP05Result(n){const e={names:{}};for(const[t,r]of Object.entries(n.names))typeof t=="string"&&typeof r=="string"&&(e.names[t.toLowerCase()]=r);if(n.relays){e.relays={};for(const[t,r]of Object.entries(n.relays))typeof t=="string"&&Array.isArray(r)&&(e.relays[t]=r.filter(s=>typeof s=="string"))}if(n.nip46){e.nip46={};for(const[t,r]of Object.entries(n.nip46))typeof t=="string"&&Array.isArray(r)&&(e.nip46[t]=r.filter(s=>typeof s=="string"))}return e}var te,NDKCashuMintList=(te=class extends NDKEvent{constructor(t,r){super(t,r);w(this,"_p2pk");this.kind??(this.kind=10019)}static from(t){return new te(t.ndk,t)}set relays(t){this.tags=this.tags.filter(r=>r[0]!=="relay");for(const r of t)this.tags.push(["relay",r])}get relays(){const t=[];for(const r of this.tags)r[0]==="relay"&&t.push(r[1]);return t}set mints(t){this.tags=this.tags.filter(r=>r[0]!=="mint");for(const r of t)this.tags.push(["mint",r])}get mints(){const t=[];for(const r of this.tags)r[0]==="mint"&&t.push(r[1]);return Array.from(new Set(t))}get p2pk(){return this._p2pk?this._p2pk:(this._p2pk=this.tagValue("pubkey")??this.pubkey,this._p2pk)}set p2pk(t){this._p2pk=t,this.removeTag("pubkey"),t&&this.tags.push(["pubkey",t])}get relaySet(){return NDKRelaySet.fromRelayUrls(this.relays,this.ndk)}},w(te,"kind",10019),w(te,"kinds",[10019]),te),d2=debug7("ndk:zapper:ln");async function getNip57ZapSpecFromLud({lud06:n,lud16:e},t){let r;if(e&&!e.startsWith("LNURL")){const[s,o]=e.split("@");r=`https://${o}/.well-known/lnurlp/${s}`}else if(n){const{words:s}=bech32.decode(n,1e3),o=bech32.fromWords(s);r=new TextDecoder("utf-8").decode(o)}if(!r)throw d2("No zap endpoint found %o",{lud06:n,lud16:e}),new Error("No zap endpoint found");try{const o=await(t.httpFetch||fetch)(r);if(o.status!==200){const a=await o.text();throw new Error(`Unable to fetch zap endpoint ${r}: ${a}`)}return await o.json()}catch(s){throw new Error(`Unable to fetch zap endpoint ${r}: ${s}`)}}var NDKUser=class ce{constructor(e){w(this,"ndk");w(this,"profile");w(this,"_npub");w(this,"_pubkey");w(this,"relayUrls",[]);w(this,"nip46Urls",[]);w(this,"follows",follows.bind(this));e.npub&&(this._npub=e.npub),e.hexpubkey&&(this._pubkey=e.hexpubkey),e.pubkey&&(this._pubkey=e.pubkey),e.relayUrls&&(this.relayUrls=e.relayUrls),e.nip46Urls&&(this.nip46Urls=e.nip46Urls)}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=nip19_exports.npubEncode(this.pubkey)}return this._npub}set npub(e){this._npub=e}get hexpubkey(){return this.pubkey}set hexpubkey(e){this._pubkey=e}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=nip19_exports.decode(this.npub).data}return this._pubkey}set pubkey(e){this._pubkey=e}async getZapInfo(e=!0,t=["nip61","nip57"]){if(!this.ndk)throw new Error("No NDK instance found");const r=[];if(t.includes("nip61")&&r.push(10019),t.includes("nip57")&&r.push(0),r.length===0)return[];let s=await this.ndk.fetchEvents({kinds:r,authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",groupable:!1});s.size<t.length&&(s=await this.ndk.fetchEvents({kinds:r,authors:[this.pubkey]},{cacheUsage:"ONLY_RELAY"}));const o=[],a=Array.from(s).find(l=>l.kind===10019),c=Array.from(s).find(l=>l.kind===0);if(a){const l=NDKCashuMintList.from(a);if(l.mints.length>0&&o.push({type:"nip61",data:{mints:l.mints,relays:l.relays,p2pk:l.p2pk}}),!e)return o}if(c){const l=profileFromEvent(c),{lud06:u,lud16:f}=l;try{const h=await getNip57ZapSpecFromLud({lud06:u,lud16:f},this.ndk);h&&o.push({type:"nip57",data:h})}catch(h){console.error("Error getting NIP-57 zap spec",h)}}return o}async getZapConfiguration(e){if(e??(e=this.ndk),!e)throw new Error("No NDK instance found");const t=async()=>{var s,o,a,c;if((o=(s=this.ndk)==null?void 0:s.cacheAdapter)!=null&&o.loadUsersLNURLDoc){const l=await this.ndk.cacheAdapter.loadUsersLNURLDoc(this.pubkey);if(l!=="missing"){if(l===null)return;if(l)return l}}let r;try{if(await this.fetchProfile({groupable:!1}),this.profile){const{lud06:l,lud16:u}=this.profile;r=await getNip57ZapSpecFromLud({lud06:l,lud16:u},e)}}catch{}if((c=(a=this.ndk)==null?void 0:a.cacheAdapter)!=null&&c.saveUsersLNURLDoc&&this.ndk.cacheAdapter.saveUsersLNURLDoc(this.pubkey,r||null),!!r)return r};return await e.queuesZapConfig.add({id:this.pubkey,func:t})}async getZapperPubkey(){const e=await this.getZapConfiguration();return e==null?void 0:e.nostrPubkey}static async fromNip05(e,t,r=!1){if(!t)throw new Error("No NDK instance found");const s={};r&&(s.cache="no-cache");const o=await getNip05For(t,e,t==null?void 0:t.httpFetch,s);if(o){const a=new ce({pubkey:o.pubkey,relayUrls:o.relays,nip46Urls:o.nip46});return a.ndk=t,a}}async fetchProfile(e,t=!1){if(!this.ndk)throw new Error("NDK not set");this.profile||(this.profile={});let r=null;if(this.ndk.cacheAdapter&&this.ndk.cacheAdapter.fetchProfile&&(e==null?void 0:e.cacheUsage)!=="ONLY_RELAY"){const a=await this.ndk.cacheAdapter.fetchProfile(this.pubkey);if(a)return this.profile=a,a}!e&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.locking&&(r=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",closeOnEose:!0,groupable:!1}),e={cacheUsage:"ONLY_RELAY",closeOnEose:!0,groupable:!0,groupableDelay:250}),(!r||r.size===0)&&(r=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},e));const s=Array.from(r).sort((a,c)=>a.created_at-c.created_at);if(s.length===0)return null;const o=s[0];return this.profile=profileFromEvent(o),t&&(this.profile.profileEvent=JSON.stringify(o)),this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile}tagReference(){return["p",this.pubkey]}referenceTags(e){const t=[["p",this.pubkey]];return e&&t[0].push("",e),t}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner(),await new NDKEvent(this.ndk,{kind:0,content:serializeProfile(this.profile)}).publish()}async follow(e,t,r=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),t||(t=await this.follows(void 0,void 0,r)),t.has(e))return!1;t.add(e);const s=new NDKEvent(this.ndk,{kind:r});for(const o of t)s.tag(o);return await s.publish(),!0}async unfollow(e,t,r=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t||(t=await this.follows(void 0,void 0,r));const s=new Set;let o=!1;for(const c of t)c.pubkey!==e.pubkey?s.add(c):o=!0;if(!o)return!1;const a=new NDKEvent(this.ndk,{kind:r});for(const c of s)a.tag(c);return await a.publish()}async validateNip05(e){if(!this.ndk)throw new Error("No NDK instance found");const t=await getNip05For(this.ndk,e);return t===null?null:t.pubkey===this.pubkey}async zap(e,t,r,s){return new Promise((o,a)=>{var u;if(!this.ndk){a("No NDK instance found");return}let c=(u=this.ndk.walletConfig)==null?void 0:u.onLnPay;c??(c=async({pr:f})=>{o(f)}),this.ndk.zap(this,e,{comment:t,tags:r,signer:s,onLnPay:c}).zap().then(o).catch(a)})}},NDKList=class le extends NDKEvent{constructor(t,r){super(t,r);w(this,"_encryptedTags");w(this,"encryptedTagsLength");this.kind??(this.kind=30001)}static from(t){return new le(t.ndk,t)}get title(){const t=this.tagValue("title")||this.tagValue("name");return t||(this.kind===3?"Contacts":this.kind===1e4?"Mute":this.kind===10001?"Pinned Notes":this.kind===10002?"Relay Metadata":this.kind===10003?"Bookmarks":this.kind===10004?"Communities":this.kind===10005?"Public Chats":this.kind===10006?"Blocked Relays":this.kind===10007?"Search Relays":this.kind===10050?"Direct Message Receive Relays":this.kind===10015?"Interests":this.kind===10030?"Emojis":this.tagValue("d"))}set title(t){this.removeTag(["title","name"]),t&&this.tags.push(["title",t])}get name(){return this.title}set name(t){this.title=t}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}isEncryptedTagsCacheValid(){return!!(this._encryptedTags&&this.encryptedTagsLength===this.content.length)}async encryptedTags(t=!0){if(t&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const r=await this.ndk.signer.user();try{if(this.content.length>0)try{const s=await this.ndk.signer.decrypt(r,this.content),o=JSON.parse(s);return o&&o[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=o):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch{console.log(`error decrypting ${this.content}`)}}catch{}return[]}validateTag(t){return!0}getItems(t){return this.tags.filter(r=>r[0]===t)}get items(){return this.tags.filter(t=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(t[0]))}async addItem(t,r=void 0,s=!1,o="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let a;if(t instanceof NDKEvent)a=[t.tagReference(r)];else if(t instanceof NDKUser)a=t.referenceTags();else if(t instanceof NDKRelay)a=t.referenceTags();else if(Array.isArray(t))a=[t];else throw new Error("Invalid object type");if(r&&a[0].push(r),s){const c=await this.ndk.signer.user(),l=await this.encryptedTags();o==="top"?l.unshift(...a):l.push(...a),this._encryptedTags=l,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(l),await this.encrypt(c)}else o==="top"?this.tags.unshift(...a):this.tags.push(...a);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(t,r=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const s=this.tags.findIndex(l=>l[1]===t);s>=0&&this.tags.splice(s,1);const o=await this.ndk.signer.user(),a=await this.encryptedTags(),c=a.findIndex(l=>l[1]===t);if(c>=0&&(a.splice(c,1),this._encryptedTags=a,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(a),await this.encrypt(o)),r)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(t,r){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(r){const s=await this.ndk.signer.user(),o=await this.encryptedTags();o.splice(t,1),this._encryptedTags=o,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(o),await this.encrypt(s)}else this.tags.splice(t,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(t){return this.items.some(r=>r[1]===t)}filterForItems(){const t=new Set,r=new Map,s=[];for(const o of this.items)if(o[0]==="e"&&o[1])t.add(o[1]);else if(o[0]==="a"&&o[1]){const[a,c,l]=o[1].split(":");if(!a||!c)continue;const u=`${a}:${c}`,f=r.get(u)||[];f.push(l||""),r.set(u,f)}if(t.size>0&&s.push({ids:Array.from(t)}),r.size>0)for(const[o,a]of r.entries()){const[c,l]=o.split(":");s.push({kinds:[parseInt(c)],authors:[l],"#d":a})}return s}},lists_default=NDKList,READ_MARKER="read",WRITE_MARKER="write",NDKRelayList=class ue extends NDKEvent{constructor(e,t){super(e,t),this.kind??(this.kind=10002)}static from(e){return new ue(e.ndk,e.rawEvent())}get readRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===READ_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set readRelayUrls(e){for(const t of e)this.tags.push(["r",t,READ_MARKER])}get writeRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]||e[2]&&e[2]===WRITE_MARKER).map(e=>tryNormalizeRelayUrl(e[1])).filter(e=>!!e)}set writeRelayUrls(e){for(const t of e)this.tags.push(["r",t,WRITE_MARKER])}get bothRelayUrls(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").filter(e=>!e[2]).map(e=>e[1])}set bothRelayUrls(e){for(const t of e)this.tags.push(["r",t])}get relays(){return this.tags.filter(e=>e[0]==="r"||e[0]==="relay").map(e=>e[1])}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new NDKRelaySet(new Set(this.relays.map(e=>this.ndk.pool.getRelay(e))),this.ndk)}};function relayListFromKind3(n,e){try{const t=JSON.parse(e.content),r=new NDKRelayList(n),s=new Set,o=new Set;for(let[a,c]of Object.entries(t)){try{a=normalizeRelayUrl(a)}catch{continue}if(!c)s.add(a),o.add(a);else{const l=c;l.write&&o.add(a),l.read&&s.add(a)}}return r.readRelayUrls=Array.from(s),r.writeRelayUrls=Array.from(o),r}catch{}}var ne,NDKNutzap=(ne=class extends NDKEvent{constructor(t,r){super(t,r);w(this,"debug");w(this,"_proofs",[]);w(this,"sender",this.author);this.kind??(this.kind=9321),this.debug=(t==null?void 0:t.debug.extend("nutzap"))??debug7("ndk:nutzap"),this.alt||(this.alt="This is a nutzap")}static from(t){const r=new this(t.ndk,t);try{const s=r.getMatchingTags("proof");s.length?r._proofs=s.map(o=>JSON.parse(o[1])):r._proofs=JSON.parse(r.content)}catch{return}if(!(!r._proofs||!r._proofs.length))return r}set comment(t){this.content=t??""}get comment(){const t=this.tagValue("comment");return t||this.content}set proofs(t){this._proofs=t,this.tags=this.tags.filter(r=>r[0]!=="proof");for(const r of t)this.tags.push(["proof",JSON.stringify(r)]);this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()])}get proofs(){return this._proofs}get p2pk(){var r;const t=this.proofs[0];try{const s=JSON.parse(t.secret);let o={};if(typeof s=="string"?(o=JSON.parse(s),this.debug("stringified payload",t.secret)):typeof s=="object"&&(o=s),o[0]==="P2PK"&&((r=o[1])==null?void 0:r.data)){const l=o[1].data.slice(2,-1);if(l)return l}}catch(s){this.debug("error parsing p2pk pubkey",s,this.proofs[0])}}get mint(){return this.tagValue("u")}set mint(t){this.removeTag("u"),this.tag(["u",t])}get unit(){return this.tagValue("unit")??"msat"}set unit(t){this.removeTag("unit"),t&&this.tag(["unit",t])}get amount(){return this.proofs.reduce((r,s)=>r+s.amount,0)*1e3}set target(t){this.tags=this.tags.filter(r=>r[0]!=="p"),t instanceof NDKEvent&&this.tags.push()}set recipientPubkey(t){this.removeTag("p"),this.tag(["p",t])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const t=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:t}):new NDKUser({pubkey:t})}get isValid(){let t=0,r=0;for(const s of this.tags)s[0]==="p"&&t++,s[0]==="u"&&r++;return t===1&&r===1&&this.proofs.length>0}},w(ne,"kind",9321),w(ne,"kinds",[ne.kind]),ne);async function payInvoice(n){return await this.sendReq("pay_invoice",{invoice:n})}var NDKPrivateKeySigner=class he{constructor(e){w(this,"_user");w(this,"_privateKey");if(e){if(typeof e=="string")if(e.startsWith("nsec1")){const{type:t,data:r}=nip19_exports.decode(e);t==="nsec"&&(this._privateKey=r)}else if(e.length===64)this._privateKey=hexToBytes$1(e);else throw new Error("Invalid private key provided.");else this._privateKey=e;this._privateKey&&(this._user=new NDKUser({pubkey:getPublicKey(this._privateKey)}))}}get privateKey(){if(this._privateKey)return bytesToHex$1(this._privateKey)}static generate(){const e=generateSecretKey();return new he(e)}async blockUntilReady(){if(!this._user)throw new Error("NDKUser not initialized");return this._user}async user(){return await this.blockUntilReady(),this._user}async sign(e){if(!this._privateKey)throw Error("Attempted to sign without a private key");return finalizeEvent(e,this._privateKey).sig}getConversationKey(e){if(!this._privateKey)throw Error("Attempted to get conversation key without a private key");const t=e.pubkey;return nip44_exports.getConversationKey(this._privateKey,t)}async nip44Encrypt(e,t){const r=this.getConversationKey(e);return await nip44_exports.encrypt(t,r)}async nip44Decrypt(e,t){const r=this.getConversationKey(e);return await nip44_exports.decrypt(t,r)}async encrypt(e,t,r=DEFAULT_ENCRYPTION_SCHEME){return r==="nip44"?this.nip44Encrypt(e,t):this.nip04Encrypt(e,t)}async decrypt(e,t,r=DEFAULT_ENCRYPTION_SCHEME){return r==="nip44"?this.nip44Decrypt(e,t):this.nip04Decrypt(e,t)}async nip04Encrypt(e,t){if(!this._privateKey)throw Error("Attempted to encrypt without a private key");const r=e.pubkey;return await nip04_exports.encrypt(this._privateKey,r,t)}async nip04Decrypt(e,t){if(!this._privateKey)throw Error("Attempted to decrypt without a private key");const r=e.pubkey;return await nip04_exports.decrypt(this._privateKey,r,t)}};async function sendReq(n,e){const t=new NDKEvent(this.ndk,{kind:23194,tags:[["p",this.walletService.pubkey]],content:JSON.stringify({method:n,params:e})});return this.debug("Sending request",t.content),await t.encrypt(this.walletService,this.signer),await t.sign(this.signer),this.debug("Request encrypted and signed"),new Promise(async(r,s)=>{try{const o=t.tagId();if(!o)throw new Error("Failed to get e-tag");const a=l=>{this.off(o,a),this.off("event",a),this.debug("Received response",l);try{const u=JSON.parse(l);u.error&&s(u),r(u)}catch(u){this.debug("Failed to parse response",u),s({result_type:"error",error:{code:"failed_to_parse_response",message:u.message}})}},c=this.ndk.subscribe({kinds:[23195],"#e":[o],limit:1},{groupable:!1,subId:`nwc-${n}`},this.relaySet);c.on("event",async l=>{await l.decrypt(l.author,this.signer),a(l.content),c.stop()}),this.once(o,a),this.once("event",a),this.debug("Sending request to relay",t.rawEvent()),await t.publish(this.relaySet)}catch(o){this.debug("Failed to send request",o,o.relayErrors),s({result_type:"error",error:{code:"failed_to_send_request",message:o.message}})}})}async function getBalance(){return await this.sendReq("get_balance",{})}async function getInfo(){return await this.sendReq("get_info",{})}var NDKNwc=class de extends lib$1.EventEmitter{constructor({ndk:t,pubkey:r,relayUrls:s,secret:o}){super();w(this,"ndk");w(this,"debug");w(this,"walletService");w(this,"relaySet");w(this,"signer");w(this,"active",!1);w(this,"getBalance",getBalance.bind(this));this.ndk=t,this.walletService=t.getUser({pubkey:r}),this.relaySet=new NDKRelaySet(new Set(s.map(a=>t.pool.getRelay(a))),t),this.signer=new NDKPrivateKeySigner(o instanceof Uint8Array?o:hexToBytes$1(o)),this.debug=t.debug.extend("nwc"),this.debug(`Starting with wallet service ${this.walletService.npub}`)}static async fromURI(t,r){const s=new URL(r);if(s.protocol!=="nostr+walletconnect:")throw new Error("Invalid protocol");return new de({ndk:t,pubkey:s.host??s.pathname,relayUrls:s.searchParams.getAll("relay")??[""],secret:s.searchParams.get("secret")??""})}async blockUntilReady(t){const r=await this.signer.user(),s=new Promise((c,l)=>{setTimeout(()=>{l(new Error("Timeout"))},t)}),a=[new Promise(c=>{const l=this.ndk.subscribe({kinds:[23195],"#p":[r.pubkey],limit:1},{groupable:!1,subId:"nwc"},this.relaySet);l.on("event",async u=>{this.debug("received response",u.rawEvent());const f=u.tagValue("e");if(!f){this.debug("Received an event without an e-tag");return}this.debug("received an event",f);try{await u.decrypt(u.author,this.signer),this.emit(f,u.content)}catch(h){this.debug("Failed to decrypt event",h);return}}),l.on("eose",()=>{this.debug("Subscription ready"),this.active=!0,c()}),l.on("close",()=>{this.debug("Subscription closed"),this.active=!1})})];return t&&a.push(s),await Promise.race(a)}async sendReq(t,r){return await sendReq.call(this,t,r)}async payInvoice(t){return await payInvoice.call(this,t)}async getInfo(){return await getInfo.call(this)}};function dedup(n,e){return n.created_at>e.created_at?n:e}async function getRelayListForUser(n,e){return(await getRelayListForUsers([n],e)).get(n)}async function getRelayListForUsers(n,e,t=!1){var f;const r=e.outboxPool||e.pool,s=new Set;for(const h of r.relays.values())s.add(h);const o=new Map,a=new Map,c=new NDKRelaySet(s,e);if((f=e.cacheAdapter)!=null&&f.locking&&!t){const h=await e.fetchEvents({kinds:[3,10002],authors:n},{cacheUsage:"ONLY_CACHE"});for(const p of h)p.kind===10002&&o.set(p.pubkey,NDKRelayList.from(p));for(const p of h)if(p.kind===3){if(o.has(p.pubkey))continue;const g=relayListFromKind3(e,p);g&&a.set(p.pubkey,g)}n=n.filter(p=>!o.has(p)&&!a.has(p))}if(n.length===0)return o;const l=new Map,u=new Map;return new Promise(async h=>{const p=e.subscribe({kinds:[3,10002],authors:n},{closeOnEose:!0,pool:r,groupable:!0,cacheUsage:"ONLY_RELAY",subId:"ndk-relay-list-fetch"},c,!1);p.on("event",g=>{if(g.kind===10002){const y=l.get(g.pubkey);if(y&&y.created_at>g.created_at)return;l.set(g.pubkey,g)}else if(g.kind===3){const y=u.get(g.pubkey);if(y&&y.created_at>g.created_at)return;u.set(g.pubkey,g)}}),p.on("eose",()=>{for(const g of l.values())o.set(g.pubkey,NDKRelayList.from(g));for(const g of n){if(o.has(g))continue;const y=u.get(g);if(!y)continue;const m=relayListFromKind3(e,y);m&&o.set(g,m)}h(o)}),p.start()})}var OutboxItem=class{constructor(n){w(this,"type");w(this,"relayUrlScores");w(this,"readRelays");w(this,"writeRelays");this.type=n,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},OutboxTracker=class extends lib$1.EventEmitter{constructor(e){super();w(this,"data");w(this,"ndk");w(this,"debug");this.ndk=e,this.debug=e.debug.extend("outbox-tracker"),this.data=new dist.LRUCache({maxSize:1e5,entryExpirationTimeInMS:2*60*1e3})}async trackUsers(e,t=!1){const r=[];for(let s=0;s<e.length;s+=400){const a=e.slice(s,s+400).map(c=>getKeyFromItem(c)).filter(c=>!this.data.has(c));if(a.length!==0){for(const c of a)this.data.set(c,new OutboxItem("user"));r.push(new Promise(c=>{getRelayListForUsers(a,this.ndk,t).then(l=>{for(const[u,f]of l){let h=this.data.get(u);if(h??(h=new OutboxItem("user")),f){h.readRelays=new Set(normalize(f.readRelayUrls)),h.writeRelays=new Set(normalize(f.writeRelayUrls));for(const p of h.readRelays)this.ndk.pool.blacklistRelayUrls.has(p)&&h.readRelays.delete(p);for(const p of h.writeRelays)this.ndk.pool.blacklistRelayUrls.has(p)&&h.writeRelays.delete(p);this.data.set(u,h)}}}).finally(c)}))}}return Promise.all(r)}track(e,t,r=!0){const s=getKeyFromItem(e);t??(t=getTypeFromItem(e));let o=this.data.get(s);return o||(o=new OutboxItem(t),e instanceof NDKUser&&this.trackUsers([e])),o}};function getKeyFromItem(n){return n instanceof NDKUser?n.pubkey:n}function getTypeFromItem(n){return n instanceof NDKUser?"user":"kind"}var NDKPool=class extends lib$1.EventEmitter{constructor(e=[],t=[],r,s){super();w(this,"_relays",new Map);w(this,"autoConnectRelays",new Set);w(this,"blacklistRelayUrls");w(this,"debug");w(this,"temporaryRelayTimers",new Map);w(this,"flappingRelays",new Set);w(this,"backoffTimes",new Map);w(this,"ndk");this.debug=s??r.debug.extend("pool"),this.ndk=r,this.relayUrls=e,this.blacklistRelayUrls=new Set(t)}get relays(){return this._relays}set relayUrls(e){this._relays.clear();for(const t of e){const r=new NDKRelay(t,void 0,this.ndk);r.connectivity.netDebug=this.ndk.netDebug,this.addRelay(r,!1)}}set name(e){this.debug=this.debug.extend(e)}useTemporaryRelay(e,t=3e4,r){const s=this.relays.has(e.url);s||(this.addRelay(e),this.debug("Adding temporary relay %s for filters %o",e.url,r));const o=this.temporaryRelayTimers.get(e.url);if(o&&clearTimeout(o),!s||o){const a=setTimeout(()=>{var c;(c=this.ndk.explicitRelayUrls)!=null&&c.includes(e.url)||this.removeRelay(e.url)},t);this.temporaryRelayTimers.set(e.url,a)}}addRelay(e,t=!0){var m,b;const r=this.relays.has(e.url),s=(m=this.blacklistRelayUrls)==null?void 0:m.has(e.url),o=e.url.includes("/npub1");let a=!0;const c=e.url;if(r)return;if(s){this.debug(`Refusing to add relay ${c}: blacklisted`);return}if(o){this.debug(`Refusing to add relay ${c}: is a filter relay`);return}if((b=this.ndk.cacheAdapter)!=null&&b.getRelayStatus){const v=this.ndk.cacheAdapter.getRelayStatus(c);if(v&&v.dontConnectBefore)if(v.dontConnectBefore>Date.now()){const $=v.dontConnectBefore-Date.now();this.debug(`Refusing to add relay ${c}: delayed connect for ${$}ms`),setTimeout(()=>{this.addRelay(e,t)},$);return}else a=!1}const l=v=>this.emit("notice",e,v),u=()=>this.handleRelayConnect(c),f=()=>this.handleRelayReady(e),h=()=>this.emit("relay:disconnect",e),p=()=>this.handleFlapping(e),g=v=>this.emit("relay:auth",e,v),y=()=>this.emit("relay:authed",e);e.off("notice",l),e.off("connect",u),e.off("ready",f),e.off("disconnect",h),e.off("flapping",p),e.off("auth",g),e.off("authed",y),e.on("notice",l),e.on("connect",u),e.on("ready",f),e.on("disconnect",h),e.on("flapping",p),e.on("auth",g),e.on("authed",y),e.on("delayed-connect",v=>{var $;($=this.ndk.cacheAdapter)!=null&&$.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(e.url,{dontConnectBefore:Date.now()+v})}),this.relays.set(c,e),t&&this.autoConnectRelays.add(c),t&&(this.emit("relay:connecting",e),e.connect(void 0,a).catch(v=>{this.debug(`Failed to connect to relay ${c}`,v)}))}removeRelay(e){const t=this.relays.get(e);if(t)return t.disconnect(),this.relays.delete(e),this.autoConnectRelays.delete(e),this.emit("relay:disconnect",t),!0;const r=this.temporaryRelayTimers.get(e);return r&&(clearTimeout(r),this.temporaryRelayTimers.delete(e)),!1}isRelayConnected(e){const t=normalizeRelayUrl(e),r=this.relays.get(t);return r?r.status===5:!1}getRelay(e,t=!0,r=!1,s){let o=this.relays.get(normalizeRelayUrl(e));return o||(o=new NDKRelay(e,void 0,this.ndk),o.connectivity.netDebug=this.ndk.netDebug,r?this.useTemporaryRelay(o,3e4,s):this.addRelay(o,t)),o}handleRelayConnect(e){this.emit("relay:connect",this.relays.get(e)),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(e){this.emit("relay:ready",e)}async connect(e){var s;const t=[];this.debug(`Connecting to ${this.relays.size} relays${e?`, timeout ${e}...`:""}`);const r=new Set(this.autoConnectRelays.keys());(s=this.ndk.explicitRelayUrls)==null||s.forEach(o=>{const a=normalizeRelayUrl(o);r.add(a)});for(const o of r){const a=this.relays.get(o);if(!a)continue;const c=new Promise((l,u)=>(this.emit("relay:connecting",a),a.connect(e).then(l).catch(u)));if(e){const l=new Promise((u,f)=>{setTimeout(()=>f(`Timed out after ${e}ms`),e)});t.push(Promise.race([c,l]).catch(u=>{this.debug(`Failed to connect to relay ${a.url}: ${u??"No reason specified"}`)}))}else t.push(c)}e&&setTimeout(()=>{const o=this.stats().connected===this.relays.size,a=this.stats().connected>0;!o&&a&&this.emit("connect")},e),await Promise.all(t)}checkOnFlappingRelays(){const e=this.flappingRelays.size,t=this.relays.size;if(e/t>=.8)for(const r of this.flappingRelays)this.backoffTimes.set(r,0)}handleFlapping(e){this.debug(`Relay ${e.url} is flapping`);let t=this.backoffTimes.get(e.url)||5e3;t=t*2,this.backoffTimes.set(e.url,t),this.debug(`Backoff time for ${e.url} is ${t}ms`),setTimeout(()=>{this.debug(`Attempting to reconnect to ${e.url}`),this.emit("relay:connecting",e),e.connect(),this.checkOnFlappingRelays()},t),e.disconnect(),this.emit("flapping",e)}size(){return this.relays.size}stats(){const e={total:0,connected:0,disconnected:0,connecting:0};for(const t of this.relays.values())e.total++,t.status===5?e.connected++:t.status===1?e.disconnected++:t.status===4&&e.connecting++;return e}connectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5)}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter(e=>e.status>=5&&!this.temporaryRelayTimers.has(e.url))}urls(){return Array.from(this.relays.keys())}};function correctRelaySet(n,e){const t=e.connectedRelays();if(!Array.from(n.relays).some(s=>t.map(o=>o.url).includes(s.url)))for(const s of t)n.addRelay(s);if(t.length===0)for(const s of e.relays.values())n.addRelay(s);return n}function isValidHint(n){if(!n||n==="")return!1;try{return new URL(n),!0}catch{return!1}}async function fetchEventFromTag(n,e,t,r={type:"timeout"}){const s=this.debug.extend("fetch-event-from-tag"),[o,a,c]=n;t={},s("fetching event from tag",n,t,r);const l=getRelaysForSync(this,e.pubkey);if(l&&l.size>0){s("fetching event from author relays %o",Array.from(l));const m=NDKRelaySet.fromRelayUrls(Array.from(l),this),b=await this.fetchEvent(a,t,m);if(b)return b}else s("no author relays found for %s",e.pubkey,e);const u=calculateRelaySetsFromFilters(this,[{ids:[a]}],this.pool);s("fetching event without relay hint",u);const f=await this.fetchEvent(a,t);if(f)return f;if(c&&c!==""){const m=await this.fetchEvent(a,t,this.pool.getRelay(c,!0,!0,[{ids:[a]}]));if(m)return m}let h;const p=isValidHint(c)?this.pool.getRelay(c,!1,!0,[{ids:[a]}]):void 0,g=new Promise(m=>{this.fetchEvent(a,t,p).then(m)});if(!isValidHint(c)||r.type==="none")return g;const y=new Promise(async m=>{const b=r.relaySet,v=r.timeout??1500,$=new Promise(I=>setTimeout(I,v));if(r.type==="timeout"&&await $,h)m(h);else{s("fallback fetch triggered");const I=await this.fetchEvent(a,t,b);m(I)}});switch(r.type){case"timeout":return Promise.race([g,y]);case"eose":return h=await g,h||y}}var SPEC_PATH="/.well-known/nostr/nip96.json",Nip96=class{constructor(n,e){w(this,"ndk");w(this,"spec");w(this,"url");w(this,"nip98Required",!1);this.url=`https://${n}${SPEC_PATH}`,this.ndk=e}async prepareUpload(n,e="POST"){if(this.validateHttpFetch(),this.spec||await this.fetchSpec(),!this.spec)throw new Error("Failed to fetch NIP96 spec");let t={};return this.nip98Required&&(t={Authorization:await this.generateNip98Header(this.spec.api_url,e,n)}),{url:this.spec.api_url,headers:t}}async xhrUpload(n,e){const t="POST",{url:r,headers:s}=await this.prepareUpload(e,t);n.open(t,r,!0),s.Authorization&&n.setRequestHeader("Authorization",s.Authorization);const o=new FormData;return o.append("file",e),new Promise((a,c)=>{n.onload=function(){n.status>=200&&n.status<300?a(JSON.parse(n.responseText)):c(new Error(n.statusText))},n.onerror=function(){c(new Error("Network Error"))},n.send(o)})}async upload(n){const e="POST",{url:t,headers:r}=await this.prepareUpload(n,e),s=new FormData;s.append("file",n);const o=await this.ndk.httpFetch(this.spec.api_url,{method:e,headers:r,body:s});if(o.status!==200)throw new Error(`Failed to upload file to ${t}`);const a=await o.json();if(a.status!=="success")throw new Error(a.message);return a}validateHttpFetch(){if(!this.ndk)throw new Error("NDK is required to fetch NIP96 spec");if(!this.ndk.httpFetch)throw new Error("NDK must have an httpFetch method to fetch NIP96 spec")}async fetchSpec(){this.validateHttpFetch();const n=await this.ndk.httpFetch(this.url);if(n.status!==200)throw new Error(`Failed to fetch NIP96 spec from ${this.url}`);const e=await n.json();if(!e)throw new Error(`Failed to parse NIP96 spec from ${this.url}`);this.spec=e,this.nip98Required=this.spec.plans.free.is_nip98_required}async generateNip98Header(n,e,t){const r=new NDKEvent(this.ndk,{kind:27235,tags:[["u",n],["method",e]]});if(["POST","PUT","PATCH"].includes(e)){const o=await this.calculateSha256(t);r.tags.push(["payload",o])}return await r.sign(),`Nostr ${btoa(JSON.stringify(r.rawEvent()))}`}async calculateSha256(n){const e=await n.arrayBuffer(),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(o=>o.toString(16).padStart(2,"0")).join("")}},Queue=class{constructor(n,e){w(this,"queue",[]);w(this,"maxConcurrency");w(this,"processing",new Set);w(this,"promises",new Map);this.maxConcurrency=e}add(n){if(this.promises.has(n.id))return this.promises.get(n.id);const e=new Promise((t,r)=>{this.queue.push({...n,func:()=>n.func().then(s=>(t(s),s),s=>{throw r(s),s})}),this.process()});return this.promises.set(n.id,e),e.finally(()=>{this.promises.delete(n.id),this.processing.delete(n.id),this.process()}),e}process(){if(this.processing.size>=this.maxConcurrency||this.queue.length===0)return;const n=this.queue.shift();!n||this.processing.has(n.id)||(this.processing.add(n.id),n.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},NDKSubscriptionManager=class{constructor(n){w(this,"subscriptions");w(this,"seenEvents",new Map);w(this,"debug");this.subscriptions=new Map,this.debug=n.extend("sub-manager")}add(n){this.subscriptions.set(n.internalId,n),n.on("close",()=>{this.subscriptions.delete(n.internalId)})}seenEvent(n,e){const t=this.seenEvents.get(n)||[];t.push(e),this.seenEvents.set(n,t)}},debug6=debug7("ndk:active-user");async function getUserRelayList(n){if(!this.autoConnectUserRelays)return;const e=await getRelayListForUser(n.pubkey,this);if(e){for(const t of e.relays){let r=this.pool.relays.get(t);r||(r=new NDKRelay(t,this.relayAuthDefaultPolicy,this),this.pool.addRelay(r))}return e}}async function setActiveUser(n){const e=this.outboxPool||this.pool;e.connectedRelays.length>0?setActiveUserConnected.call(this,n):e.once("connect",()=>{setActiveUserConnected.call(this,n)})}async function setActiveUserConnected(n){const e=await getUserRelayList.call(this,n),t=[{kinds:[10006],authors:[n.pubkey]}];this.autoFetchUserMutelist&&t[0].kinds.push(1e4);const r=e?e.relaySet:void 0,s=this.subscribe(t,{subId:"active-user-settings",closeOnEose:!0},r,!1),o=new Map;s.on("event",a=>{const c=o.get(a.kind);c&&c.created_at>=a.created_at||o.set(a.kind,a)}),s.on("eose",()=>{for(const a of o.values())processEvent.call(this,a)}),s.start()}async function processEvent(n){n.kind===10006?processBlockRelayList.call(this,n):n.kind===1e4&&processMuteList.call(this,n)}function processBlockRelayList(n){const e=lists_default.from(n);for(const t of e.items)this.pool.blacklistRelayUrls.add(t[0]);debug6("Added %d relays to relay blacklist",e.items.length)}function processMuteList(n){const e=lists_default.from(n);for(const t of e.items)this.mutedIds.set(t[1],t[0]);debug6("Added %d users to mute list",e.items.length)}async function generateZapRequest(n,e,t,r,s,o,a,c,l){const u=t.callback,f=nip57_exports.makeZapRequest({profile:r,event:null,amount:s,comment:a||"",relays:o.slice(0,4)});if(n instanceof NDKEvent){const g=n.referenceTags().filter(y=>y[0]!=="p");f.tags.push(...g)}f.tags.push(["lnurl",u]);const h=new NDKEvent(e,f);return c&&(h.tags=h.tags.concat(c)),h.tags=h.tags.filter(p=>p[0]!=="p"),h.tags.push(["p",r]),await h.sign(l),h}var d3=debug7("ndk:zapper"),NDKZapper=class extends lib$1.EventEmitter{constructor(e,t,r="msat",s,o,a,c){super();w(this,"target");w(this,"ndk");w(this,"comment");w(this,"amount");w(this,"unit");w(this,"tags");w(this,"signer");w(this,"zapMethod");w(this,"onLnPay");w(this,"onCashuPay");w(this,"onComplete");w(this,"maxRelays",3);if(this.target=e,this.ndk=o||e.ndk,!this.ndk)throw new Error("No NDK instance provided");this.amount=t,this.comment=s,this.unit=r,this.tags=a,this.signer=c}async zap(){const e=this.getZapSplits(),t=new Map;return await Promise.all(e.map(async r=>{let s;try{s=await this.zapSplit(r)}catch(o){s=o}this.emit("split:complete",r,s),t.set(r,s)})),this.emit("complete",t),this.onComplete&&this.onComplete(t),t}async zapSplit(e){let t=await this.getZapMethods(this.ndk,e.pubkey),r;if(t.length===0)throw new Error("No zap method available for recipient");t=t.sort((o,a)=>o.type==="nip61"?-1:a.type==="nip61"?1:0);const s=await this.relays(e.pubkey);for(const o of t){d3("Zapping to %s with %d %s using %s",e.pubkey,e.amount,this.unit,o.type);try{switch(o.type){case"nip61":{const a=o.data;let c;if(c=await this.onCashuPay({target:this.target,comment:this.comment,tags:this.tags,recipientPubkey:e.pubkey,amount:e.amount,unit:this.unit,...a}),d3("NIP-61 Zap result: %o",c),c instanceof Error)r=c;else if(c){const{proofs:l,mint:u}=c;if(!l||!u)throw new Error("Invalid zap confirmation: missing proofs or mint: "+c);const f=NDKRelaySet.fromRelayUrls(s,this.ndk),h=new NDKNutzap(this.ndk);return h.tags=[...h.tags,...this.tags||[]],h.proofs=l,h.mint=u,h.comment=this.comment,h.unit=this.unit,h.recipientPubkey=e.pubkey,await h.sign(this.signer),await h.publish(f),h}break}case"nip57":{const a=o.data,c=await generateZapRequest(this.target,this.ndk,a,e.pubkey,e.amount,s,this.comment,this.tags,this.signer);if(!c)throw d3("Unable to generate zap request"),new Error("Unable to generate zap request");const l=await this.getLnInvoice(c,e.amount,a);if(!l)throw d3("Unable to get payment request"),new Error("Unable to get payment request");r=await this.onLnPay({target:this.target,comment:this.comment,recipientPubkey:e.pubkey,amount:e.amount,unit:this.unit,pr:l});break}}}catch(a){a instanceof Error?r=a:r=new Error(a),d3("Error zapping to %s with %d %s using %s: %o",e.pubkey,e.amount,this.unit,o.type,a)}}if(r instanceof Error)throw r;return r}async getLnInvoice(e,t,r){const s=r.callback,o=JSON.stringify(e.rawEvent());d3(`Fetching invoice from ${s}?`+new URLSearchParams({amount:t.toString(),nostr:o}));const a=new URL(s);a.searchParams.append("amount",t.toString()),a.searchParams.append("nostr",o),d3(`Fetching invoice from ${a.toString()}`);const c=await fetch(a.toString());if(d3(`Got response from zap endpoint: ${s}`,{status:c.status}),c.status!==200){d3(`Received non-200 status from zap endpoint: ${s}`,{status:c.status,amount:t,nostr:o});const u=await c.text();throw new Error(`Unable to fetch zap endpoint ${s}: ${u}`)}return(await c.json()).pr}getZapSplits(){if(this.target instanceof NDKUser)return[{pubkey:this.target.pubkey,amount:this.amount}];const e=this.target.getMatchingTags("zap");if(e.length===0)return[{pubkey:this.target.pubkey,amount:this.amount}];const t=[],r=e.reduce((s,o)=>s+parseInt(o[2]),0);for(const s of e){const o=s[1],a=Math.floor(parseInt(s[2])/r*this.amount);t.push({pubkey:o,amount:a})}return t}async getZapMethods(e,t){const r=[];r.push("nip61"),r.push("nip57");const s=e.getUser({pubkey:t}),o=await s.getZapInfo(!1,r);return d3("Zap info for %s: %o",s.npub,o),o}async relays(e){var r,s,o;let t=[];if((r=this.ndk)!=null&&r.activeUser){const a=await getRelayListForUsers([this.ndk.activeUser.pubkey,e],this.ndk),c=new Map;for(const l of a.values())for(const u of l.readRelayUrls){const f=c.get(u)||0;c.set(u,f+1)}t=Array.from(c.entries()).sort((l,u)=>u[1]-l[1]).map(([l])=>l).slice(0,this.maxRelays)}return(o=(s=this.ndk)==null?void 0:s.pool)!=null&&o.permanentAndConnectedRelays().length&&(t=this.ndk.pool.permanentAndConnectedRelays().map(a=>a.url)),t.length||(t=[]),t}},DEFAULT_OUTBOX_RELAYS=["wss://purplepag.es/","wss://nos.lol/"],DEFAULT_BLACKLISTED_RELAYS=["wss://brb.io/","wss://nostr.mutinywallet.com/"],NDK=class extends lib$1.EventEmitter{constructor(e={}){super();w(this,"_explicitRelayUrls");w(this,"pool");w(this,"outboxPool");w(this,"_signer");w(this,"_activeUser");w(this,"cacheAdapter");w(this,"debug");w(this,"devWriteRelaySet");w(this,"outboxTracker");w(this,"mutedIds");w(this,"clientName");w(this,"clientNip89");w(this,"queuesZapConfig");w(this,"queuesNip05");w(this,"asyncSigVerification",!1);w(this,"initialValidationRatio",1);w(this,"lowestValidationRatio",1);w(this,"validationRatioFn");w(this,"subManager");w(this,"publishingFailureHandled",!1);w(this,"relayAuthDefaultPolicy");w(this,"httpFetch");w(this,"netDebug");w(this,"autoConnectUserRelays",!0);w(this,"autoFetchUserMutelist",!0);w(this,"walletConfig");w(this,"fetchEventFromTag",fetchEventFromTag.bind(this));this.debug=e.debug||debug7("ndk"),this.netDebug=e.netDebug,this._explicitRelayUrls=e.explicitRelayUrls||[],this.subManager=new NDKSubscriptionManager(this.debug),this.pool=new NDKPool(e.explicitRelayUrls||[],e.blacklistRelayUrls||DEFAULT_BLACKLISTED_RELAYS,this),this.pool.name="main",this.pool.on("relay:auth",async(t,r)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(t,r)}),this.autoConnectUserRelays=e.autoConnectUserRelays??!0,this.autoFetchUserMutelist=e.autoFetchUserMutelist??!0,this.clientName=e.clientName,this.clientNip89=e.clientNip89,this.relayAuthDefaultPolicy=e.relayAuthDefaultPolicy,e.enableOutboxModel&&(this.outboxPool=new NDKPool(e.outboxRelayUrls||DEFAULT_OUTBOX_RELAYS,e.blacklistRelayUrls||DEFAULT_BLACKLISTED_RELAYS,this,this.debug.extend("outbox-pool")),this.outboxPool.name="outbox",this.outboxTracker=new OutboxTracker(this)),this.signer=e.signer,this.cacheAdapter=e.cacheAdapter,this.mutedIds=e.mutedIds||new Map,e.devWriteRelayUrls&&(this.devWriteRelaySet=NDKRelaySet.fromRelayUrls(e.devWriteRelayUrls,this)),this.queuesZapConfig=new Queue("zaps",3),this.queuesNip05=new Queue("nip05",10),this.signatureVerificationWorker=e.signatureVerificationWorker,this.initialValidationRatio=e.initialValidationRatio||1,this.lowestValidationRatio=e.lowestValidationRatio||1;try{this.httpFetch=fetch}catch{}}set explicitRelayUrls(e){this._explicitRelayUrls=e,this.pool.relayUrls=e}get explicitRelayUrls(){return this._explicitRelayUrls||[]}set signatureVerificationWorker(e){this.asyncSigVerification=!!e,e&&signatureVerificationInit(e)}addExplicitRelay(e,t,r=!0){let s;return typeof e=="string"?s=new NDKRelay(e,t,this):s=e,this.pool.addRelay(s,r),this.explicitRelayUrls.push(s.url),s}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(e){var r;const t=((r=this._activeUser)==null?void 0:r.pubkey)!==(e==null?void 0:e.pubkey);this._activeUser=e,e&&t?setActiveUser.call(this,e):e||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(e){this._signer=e,e&&this.emit("signer:ready",e),e==null||e.user().then(t=>{t.ndk=this,this.activeUser=t})}async connect(e){var r,s;this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await((s=(r=this._signer).relays)==null?void 0:s.call(r,this))),this._signer.relays&&(await this._signer.relays(this)).forEach(a=>this.pool.addRelay(a)));const t=[this.pool.connect(e)];return this.outboxPool&&t.push(this.outboxPool.connect(e)),this.debug("Connecting to relays %o",{timeoutMs:e}),Promise.allSettled(t).then(()=>{})}getUser(e){const t=new NDKUser(e);return t.ndk=this,t}async getUserFromNip05(e,t=!1){return NDKUser.fromNip05(e,this,t)}subscribe(e,t,r,s=!0){var a;const o=new NDKSubscription(this,e,t,r);if(this.subManager.add(o),r)for(const c of r.relays)this.pool.useTemporaryRelay(c,void 0,o.filters);if(this.outboxPool&&o.hasAuthorsFilter()){const c=o.filters.filter(l=>{var u;return l.authors&&((u=l.authors)==null?void 0:u.length)>0}).map(l=>l.authors).flat();(a=this.outboxTracker)==null||a.trackUsers(c)}return s&&setTimeout(()=>o.start(),0),o}async publish(e,t,r){return this.debug("Deprecated: Use `event.publish()` instead"),e.publish(t,r)}async fetchEvent(e,t,r){let s,o;if(r instanceof NDKRelay?o=new NDKRelaySet(new Set([r]),this):r instanceof NDKRelaySet&&(o=r),!r&&typeof e=="string"&&!isNip33AValue(e)){const a=relaysFromBech32(e,this);a.length>0&&(o=new NDKRelaySet(new Set(a),this),o=correctRelaySet(o,this.pool))}if(typeof e=="string"?s=[filterFromId(e)]:Array.isArray(e)?s=e:s=[e],s.length===0)throw new Error(`Invalid filter: ${JSON.stringify(e)}`);return new Promise(a=>{let c=null;const l=this.subscribe(s,{...t||{},closeOnEose:!0},o,!1),u=setTimeout(()=>{l.stop(),a(c)},1e4);l.on("event",f=>{f.ndk=this,f.isReplaceable()?(!c||c.created_at<f.created_at)&&(c=f):(clearTimeout(u),a(f))}),l.on("eose",()=>{clearTimeout(u),a(c)}),l.start()})}async fetchEvents(e,t,r){return new Promise(s=>{const o=new Map,a=this.subscribe(e,{...t||{},closeOnEose:!0},r,!1),c=l=>{l instanceof NDKEvent||(l=new NDKEvent(void 0,l));const u=l.deduplicationKey(),f=o.get(u);f&&(l=dedup(f,l)),l.ndk=this,o.set(u,l)};a.on("event",c),a.on("eose",()=>{s(new Set(o.values()))}),a.start()})}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getNip96(e){return new Nip96(e,this)}async nwc(e,t=2e3){const r=await NDKNwc.fromURI(this,e);return t!==!1&&await r.blockUntilReady(t),r}zap(e,t,{comment:r,unit:s,signer:o,tags:a,onLnPay:c,onCashuPay:l,onComplete:u}){var h,p,g;o||this.assertSigner();const f=new NDKZapper(e,t,s,r,this,a,o);return c!==!1&&(f.onLnPay=c??((h=this.walletConfig)==null?void 0:h.onLnPay)),l!==!1&&(f.onCashuPay=l??((p=this.walletConfig)==null?void 0:p.onCashuPay)),f.onComplete=u??((g=this.walletConfig)==null?void 0:g.onPaymentComplete),c&&f.zap(),f}},node={};Object.defineProperty(node,"__esModule",{value:!0});node.is_node=void 0;function is_node(){return is_node_===null&&(is_node_=typeof commonjsGlobal=="object"&&is_node_process(commonjsGlobal)),is_node_}node.is_node=is_node;function is_node_process(n){return n!==null&&typeof n.process=="object"&&n.process!==null&&typeof n.process.versions=="object"&&n.process.versions!==null&&typeof n.process.versions.node<"u"}var is_node_=null,WebSocket$1={},global$1,hasRequiredGlobal$2;function requireGlobal$2(){if(hasRequiredGlobal$2)return global$1;hasRequiredGlobal$2=1;var n=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return global$1=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return n()}try{return __global__||n()}finally{delete Object.prototype.__global__}}(),global$1}const name="websocket",description="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",contributors=["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],version$1="1.0.35",repository={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},homepage="https://github.com/theturtle32/WebSocket-Node",engines={node:">=4.0.0"},dependencies={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.63","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},devDependencies={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},config={verbose:!1},scripts={test:"tape test/unit/*.js",gulp:"gulp"},main="index",directories={lib:"./lib"},browser$1="lib/browser.js",license="Apache-2.0",require$$0={name,description,keywords,author,contributors,version:version$1,repository,homepage,engines,dependencies,devDependencies,config,scripts,main,directories,browser:browser$1,license};var version,hasRequiredVersion;function requireVersion(){return hasRequiredVersion||(hasRequiredVersion=1,version=require$$0.version),version}var browser,hasRequiredBrowser;function requireBrowser(){if(hasRequiredBrowser)return browser;hasRequiredBrowser=1;var n;if(typeof globalThis=="object")n=globalThis;else try{n=requireGlobal$2()}catch{}finally{if(!n&&typeof window<"u"&&(n=window),!n)throw new Error("Could not determine global this")}var e=n.WebSocket||n.MozWebSocket,t=requireVersion();function r(s,o){var a;return o?a=new e(s,o):a=new e(s),a}return e&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(s){Object.defineProperty(r,s,{get:function(){return e[s]}})}),browser={w3cwebsocket:e?r:null,version:t},browser}var EventTarget={},HashSet={},UniqueSet={},SetContainer={},Container={},ForOfAdaptor={},hasRequiredForOfAdaptor;function requireForOfAdaptor(){if(hasRequiredForOfAdaptor)return ForOfAdaptor;hasRequiredForOfAdaptor=1,Object.defineProperty(ForOfAdaptor,"__esModule",{value:!0}),ForOfAdaptor.ForOfAdaptor=void 0;var n=function(){function e(t,r){this.it_=t,this.last_=r}return e.prototype.next=function(){if(this.it_.equals(this.last_))return{done:!0,value:void 0};var t=this.it_;return this.it_=this.it_.next(),{done:!1,value:t.value}},e.prototype[Symbol.iterator]=function(){return this},e}();return ForOfAdaptor.ForOfAdaptor=n,ForOfAdaptor}var hasRequiredContainer;function requireContainer(){if(hasRequiredContainer)return Container;hasRequiredContainer=1;var n=commonjsGlobal&&commonjsGlobal.__values||function(r){var s=typeof Symbol=="function"&&Symbol.iterator,o=s&&r[s],a=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&a>=r.length&&(r=void 0),{value:r&&r[a++],done:!r}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(Container,"__esModule",{value:!0}),Container.Container=void 0;var e=requireForOfAdaptor(),t=function(){function r(){}return r.prototype.empty=function(){return this.size()===0},r.prototype.rbegin=function(){return this.end().reverse()},r.prototype.rend=function(){return this.begin().reverse()},r.prototype[Symbol.iterator]=function(){return new e.ForOfAdaptor(this.begin(),this.end())},r.prototype.toJSON=function(){var s,o,a=[];try{for(var c=n(this),l=c.next();!l.done;l=c.next()){var u=l.value;a.push(u)}}catch(f){s={error:f}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(s)throw s.error}}return a},r}();return Container.Container=t,Container}var NativeArrayIterator={},hasRequiredNativeArrayIterator;function requireNativeArrayIterator(){if(hasRequiredNativeArrayIterator)return NativeArrayIterator;hasRequiredNativeArrayIterator=1;var n=commonjsGlobal&&commonjsGlobal.__read||function(t,r){var s=typeof Symbol=="function"&&t[Symbol.iterator];if(!s)return t;var o=s.call(t),a,c=[],l;try{for(;(r===void 0||r-- >0)&&!(a=o.next()).done;)c.push(a.value)}catch(u){l={error:u}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(l)throw l.error}}return c};Object.defineProperty(NativeArrayIterator,"__esModule",{value:!0}),NativeArrayIterator.NativeArrayIterator=void 0;var e=function(){function t(r,s){this.data_=r,this.index_=s}return t.prototype.index=function(){return this.index_},Object.defineProperty(t.prototype,"value",{get:function(){return this.data_[this.index_]},enumerable:!1,configurable:!0}),t.prototype.prev=function(){return--this.index_,this},t.prototype.next=function(){return++this.index_,this},t.prototype.advance=function(r){return this.index_+=r,this},t.prototype.equals=function(r){return this.data_===r.data_&&this.index_===r.index_},t.prototype.swap=function(r){var s,o;s=n([r.data_,this.data_],2),this.data_=s[0],r.data_=s[1],o=n([r.index_,this.index_],2),this.index_=o[0],r.index_=o[1]},t}();return NativeArrayIterator.NativeArrayIterator=e,NativeArrayIterator}var hasRequiredSetContainer;function requireSetContainer(){if(hasRequiredSetContainer)return SetContainer;hasRequiredSetContainer=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var s=function(o,a){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,l){c.__proto__=l}||function(c,l){for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(c[u]=l[u])},s(o,a)};return function(o,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");s(o,a);function c(){this.constructor=o}o.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c)}}();Object.defineProperty(SetContainer,"__esModule",{value:!0}),SetContainer.SetContainer=void 0;var e=requireContainer(),t=requireNativeArrayIterator(),r=function(s){n(o,s);function o(a){var c=s.call(this)||this;return c.data_=a(c),c}return o.prototype.assign=function(a,c){this.clear(),this.insert(a,c)},o.prototype.clear=function(){this.data_.clear()},o.prototype.begin=function(){return this.data_.begin()},o.prototype.end=function(){return this.data_.end()},o.prototype.has=function(a){return!this.find(a).equals(this.end())},o.prototype.size=function(){return this.data_.size()},o.prototype.push=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];if(a.length===0)return this.size();var l=new t.NativeArrayIterator(a,0),u=new t.NativeArrayIterator(a,a.length);return this._Insert_by_range(l,u),this.size()},o.prototype.insert=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];return a.length===1?this._Insert_by_key(a[0]):a[0].next instanceof Function&&a[1].next instanceof Function?this._Insert_by_range(a[0],a[1]):this._Insert_by_hint(a[0],a[1])},o.prototype.erase=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];return a.length===1&&!(a[0]instanceof this.end().constructor&&a[0].source()===this)?this._Erase_by_val(a[0]):a.length===1?this._Erase_by_range(a[0]):this._Erase_by_range(a[0],a[1])},o.prototype._Erase_by_range=function(a,c){c===void 0&&(c=a.next());var l=this.data_.erase(a,c);return this._Handle_erase(a,c),l},o}(e.Container);return SetContainer.SetContainer=r,SetContainer}var ErrorGenerator={},InvalidArgument={},LogicError={},Exception={},hasRequiredException;function requireException(){if(hasRequiredException)return Exception;hasRequiredException=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var t=function(r,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(o[c]=a[c])},t(r,s)};return function(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");t(r,s);function o(){this.constructor=r}r.prototype=s===null?Object.create(s):(o.prototype=s.prototype,new o)}}();Object.defineProperty(Exception,"__esModule",{value:!0}),Exception.Exception=void 0;var e=function(t){n(r,t);function r(s){var o=this.constructor,a=t.call(this,s)||this,c=o.prototype;return Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c,a}return Object.defineProperty(r.prototype,"name",{get:function(){return this.constructor.name},enumerable:!1,configurable:!0}),r.prototype.what=function(){return this.message},r.prototype.toJSON=function(){return{name:this.name,message:this.message,stack:this.stack}},r}(Error);return Exception.Exception=e,Exception}var hasRequiredLogicError;function requireLogicError(){if(hasRequiredLogicError)return LogicError;hasRequiredLogicError=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(s,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(a[l]=c[l])},r(s,o)};return function(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");r(s,o);function a(){this.constructor=s}s.prototype=o===null?Object.create(o):(a.prototype=o.prototype,new a)}}();Object.defineProperty(LogicError,"__esModule",{value:!0}),LogicError.LogicError=void 0;var e=requireException(),t=function(r){n(s,r);function s(o){return r.call(this,o)||this}return s}(e.Exception);return LogicError.LogicError=t,LogicError}var hasRequiredInvalidArgument;function requireInvalidArgument(){if(hasRequiredInvalidArgument)return InvalidArgument;hasRequiredInvalidArgument=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(s,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(a[l]=c[l])},r(s,o)};return function(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");r(s,o);function a(){this.constructor=s}s.prototype=o===null?Object.create(o):(a.prototype=o.prototype,new a)}}();Object.defineProperty(InvalidArgument,"__esModule",{value:!0}),InvalidArgument.InvalidArgument=void 0;var e=requireLogicError(),t=function(r){n(s,r);function s(o){return r.call(this,o)||this}return s}(e.LogicError);return InvalidArgument.InvalidArgument=t,InvalidArgument}var OutOfRange={},hasRequiredOutOfRange;function requireOutOfRange(){if(hasRequiredOutOfRange)return OutOfRange;hasRequiredOutOfRange=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(s,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(a[l]=c[l])},r(s,o)};return function(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");r(s,o);function a(){this.constructor=s}s.prototype=o===null?Object.create(o):(a.prototype=o.prototype,new a)}}();Object.defineProperty(OutOfRange,"__esModule",{value:!0}),OutOfRange.OutOfRange=void 0;var e=requireLogicError(),t=function(r){n(s,r);function s(o){return r.call(this,o)||this}return s}(e.LogicError);return OutOfRange.OutOfRange=t,OutOfRange}var hasRequiredErrorGenerator;function requireErrorGenerator(){return hasRequiredErrorGenerator||(hasRequiredErrorGenerator=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ErrorGenerator=void 0;var e=requireInvalidArgument(),t=requireOutOfRange();(function(r){function s(g){if(typeof g=="string")return g;var y=g.constructor.name;return g.constructor.__MODULE&&(y="".concat(g.constructor.__MODULE,".").concat(y)),"std.".concat(y)}r.get_class_name=s;function o(g,y){return new t.OutOfRange("Error on ".concat(s(g),".").concat(y,"(): it's empty container."))}r.empty=o;function a(g,y,m){return new t.OutOfRange("Error on ".concat(s(g),".").concat(y,"(): parametric index is negative -> (index = ").concat(m,")."))}r.negative_index=a;function c(g,y,m,b){return new t.OutOfRange("Error on ".concat(s(g),".").concat(y,"(): parametric index is equal or greater than size -> (index = ").concat(m,", size: ").concat(b,")."))}r.excessive_index=c;function l(g,y){return new e.InvalidArgument("Error on ".concat(s(g),".").concat(y,"(): parametric iterator is not this container's own."))}r.not_my_iterator=l;function u(g,y){return new e.InvalidArgument("Error on ".concat(s(g),".").concat(y,"(): parametric iterator, it already has been erased."))}r.erased_iterator=u;function f(g,y,m){return new t.OutOfRange("Error on ".concat(s(g),".").concat(y,"(): parametric iterator is directing negative position -> (index = ").concat(m,")."))}r.negative_iterator=f;function h(g,y){y===void 0&&(y="end");var m=s(g);return new t.OutOfRange("Error on ".concat(m,".Iterator.value: cannot access to the ").concat(m,".").concat(y,"().value."))}r.iterator_end_value=h;function p(g,y,m){throw new t.OutOfRange("Error on ".concat(s(g),".").concat(y,"(): unable to find the matched key -> ").concat(m))}r.key_nout_found=p})(n.ErrorGenerator||(n.ErrorGenerator={}))}(ErrorGenerator)),ErrorGenerator}var hasRequiredUniqueSet;function requireUniqueSet(){if(hasRequiredUniqueSet)return UniqueSet;hasRequiredUniqueSet=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var a=function(c,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var h in f)Object.prototype.hasOwnProperty.call(f,h)&&(u[h]=f[h])},a(c,l)};return function(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");a(c,l);function u(){this.constructor=c}c.prototype=l===null?Object.create(l):(u.prototype=l.prototype,new u)}}(),e=commonjsGlobal&&commonjsGlobal.__read||function(a,c){var l=typeof Symbol=="function"&&a[Symbol.iterator];if(!l)return a;var u=l.call(a),f,h=[],p;try{for(;(c===void 0||c-- >0)&&!(f=u.next()).done;)h.push(f.value)}catch(g){p={error:g}}finally{try{f&&!f.done&&(l=u.return)&&l.call(u)}finally{if(p)throw p.error}}return h},t=commonjsGlobal&&commonjsGlobal.__spreadArray||function(a,c,l){if(l||arguments.length===2)for(var u=0,f=c.length,h;u<f;u++)(h||!(u in c))&&(h||(h=Array.prototype.slice.call(c,0,u)),h[u]=c[u]);return a.concat(h||Array.prototype.slice.call(c))};Object.defineProperty(UniqueSet,"__esModule",{value:!0}),UniqueSet.UniqueSet=void 0;var r=requireSetContainer(),s=requireErrorGenerator(),o=function(a){n(c,a);function c(){return a!==null&&a.apply(this,arguments)||this}return c.prototype.count=function(l){return this.find(l).equals(this.end())?0:1},c.prototype.insert=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.prototype.insert.apply(this,t([],e(l),!1))},c.prototype._Insert_by_range=function(l,u){for(;!l.equals(u);l=l.next())this._Insert_by_key(l.value)},c.prototype.extract=function(l){return l instanceof this.end().constructor?this._Extract_by_iterator(l):this._Extract_by_val(l)},c.prototype._Extract_by_val=function(l){var u=this.find(l);if(u.equals(this.end())===!0)throw s.ErrorGenerator.key_nout_found(this,"extract",l);return this._Erase_by_range(u),l},c.prototype._Extract_by_iterator=function(l){return l.equals(this.end())===!0||this.has(l.value)===!1?this.end():(this._Erase_by_range(l),l)},c.prototype._Erase_by_val=function(l){var u=this.find(l);return u.equals(this.end())===!0?0:(this._Erase_by_range(u),1)},c.prototype.merge=function(l){for(var u=l.begin();!u.equals(l.end());)this.has(u.value)===!1?(this.insert(u.value),u=l.erase(u)):u=u.next()},c}(r.SetContainer);return UniqueSet.UniqueSet=o,UniqueSet}var IHashContainer={},IAssociativeContainer={},hasRequiredIAssociativeContainer;function requireIAssociativeContainer(){return hasRequiredIAssociativeContainer||(hasRequiredIAssociativeContainer=1,function(n){var e=commonjsGlobal&&commonjsGlobal.__read||function(r,s){var o=typeof Symbol=="function"&&r[Symbol.iterator];if(!o)return r;var a=o.call(r),c,l=[],u;try{for(;(s===void 0||s-- >0)&&!(c=a.next()).done;)l.push(c.value)}catch(f){u={error:f}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(u)throw u.error}}return l},t=commonjsGlobal&&commonjsGlobal.__spreadArray||function(r,s,o){if(o||arguments.length===2)for(var a=0,c=s.length,l;a<c;a++)(l||!(a in s))&&(l||(l=Array.prototype.slice.call(s,0,a)),l[a]=s[a]);return r.concat(l||Array.prototype.slice.call(s))};Object.defineProperty(n,"__esModule",{value:!0}),n.IAssociativeContainer=void 0,function(r){function s(o){for(var a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];var l,u;return a.length>=1&&a[0]instanceof Array?(l=function(){var f=a[0];o.push.apply(o,t([],e(f),!1))},u=a.slice(1)):a.length>=2&&a[0].next instanceof Function&&a[1].next instanceof Function?(l=function(){var f=a[0],h=a[1];o.assign(f,h)},u=a.slice(2)):(l=null,u=a),{ramda:l,tail:u}}r.construct=s}(n.IAssociativeContainer||(n.IAssociativeContainer={}))}(IAssociativeContainer)),IAssociativeContainer}var hash={},uid={},Global={},hasRequiredGlobal$1;function requireGlobal$1(){if(hasRequiredGlobal$1)return Global;hasRequiredGlobal$1=1,Object.defineProperty(Global,"__esModule",{value:!0}),Global._Get_root=void 0;var n=node;function e(){return t===null&&(t=(0,n.is_node)()?commonjsGlobal:self,t.__s_iUID===void 0&&(t.__s_iUID=0)),t}Global._Get_root=e;var t=null;return Global}var hasRequiredUid;function requireUid(){if(hasRequiredUid)return uid;hasRequiredUid=1,Object.defineProperty(uid,"__esModule",{value:!0}),uid.get_uid=void 0;var n=requireGlobal$1();function e(t){if(t instanceof Object){if(t.hasOwnProperty("__get_m_iUID")===!1){var r=++(0,n._Get_root)().__s_iUID;Object.defineProperty(t,"__get_m_iUID",{value:function(){return r}})}return t.__get_m_iUID()}else return t===void 0?-1:0}return uid.get_uid=e,uid}var hasRequiredHash;function requireHash(){if(hasRequiredHash)return hash;hasRequiredHash=1;var n=commonjsGlobal&&commonjsGlobal.__values||function(l){var u=typeof Symbol=="function"&&Symbol.iterator,f=u&&l[u],h=0;if(f)return f.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&h>=l.length&&(l=void 0),{value:l&&l[h++],done:!l}}};throw new TypeError(u?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(hash,"__esModule",{value:!0}),hash.hash=void 0;var e=requireUid();function t(){for(var l,u,f=[],h=0;h<arguments.length;h++)f[h]=arguments[h];var p=a;try{for(var g=n(f),y=g.next();!y.done;y=g.next()){var m=y.value;m=m&&m.valueOf();var b=typeof m;if(b==="boolean")p=r(m,p);else if(b==="number"||b==="bigint")p=s(m,p);else if(b==="string")p=o(m,p);else if(m instanceof Object&&m.hashCode instanceof Function){var v=m.hashCode();if(f.length===1)return v;p=p^v,p*=c}else p=s((0,e.get_uid)(m),p)}}catch($){l={error:$}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(l)throw l.error}}return Math.abs(p)}hash.hash=t;function r(l,u){return u^=l?1:0,u*=c,u}function s(l,u){return o(l.toString(),u)}function o(l,u){for(var f=0;f<l.length;++f)u^=l.charCodeAt(f),u*=c;return Math.abs(u)}var a=2166136261,c=16777619;return hash}var comparators={},hasRequiredComparators;function requireComparators(){if(hasRequiredComparators)return comparators;hasRequiredComparators=1,Object.defineProperty(comparators,"__esModule",{value:!0}),comparators.greater_equal=comparators.greater=comparators.less_equal=comparators.less=comparators.not_equal_to=comparators.equal_to=void 0;var n=requireUid();function e(c,l){return c=c&&c.valueOf(),l=l&&l.valueOf(),c instanceof Object&&c.equals instanceof Function?c.equals(l):c===l}comparators.equal_to=e;function t(c,l){return!e(c,l)}comparators.not_equal_to=t;function r(c,l){return c=c.valueOf(),l=l.valueOf(),c instanceof Object?c.less instanceof Function?c.less(l):(0,n.get_uid)(c)<(0,n.get_uid)(l):c<l}comparators.less=r;function s(c,l){return r(c,l)||e(c,l)}comparators.less_equal=s;function o(c,l){return!s(c,l)}comparators.greater=o;function a(c,l){return!r(c,l)}return comparators.greater_equal=a,comparators}var hasRequiredIHashContainer;function requireIHashContainer(){return hasRequiredIHashContainer||(hasRequiredIHashContainer=1,function(n){var e=commonjsGlobal&&commonjsGlobal.__read||function(a,c){var l=typeof Symbol=="function"&&a[Symbol.iterator];if(!l)return a;var u=l.call(a),f,h=[],p;try{for(;(c===void 0||c-- >0)&&!(f=u.next()).done;)h.push(f.value)}catch(g){p={error:g}}finally{try{f&&!f.done&&(l=u.return)&&l.call(u)}finally{if(p)throw p.error}}return h},t=commonjsGlobal&&commonjsGlobal.__spreadArray||function(a,c,l){if(l||arguments.length===2)for(var u=0,f=c.length,h;u<f;u++)(h||!(u in c))&&(h||(h=Array.prototype.slice.call(c,0,u)),h[u]=c[u]);return a.concat(h||Array.prototype.slice.call(c))};Object.defineProperty(n,"__esModule",{value:!0}),n.IHashContainer=void 0;var r=requireIAssociativeContainer(),s=requireHash(),o=requireComparators();(function(a){function c(l,u,f){for(var h=[],p=3;p<arguments.length;p++)h[p-3]=arguments[p];var g=null,y=s.hash,m=o.equal_to;if(h.length===1&&h[0]instanceof u){var b=h[0];y=b.hash_function(),m=b.key_eq(),g=function(){var $=b.begin(),I=b.end();l.assign($,I)}}else{var v=r.IAssociativeContainer.construct.apply(r.IAssociativeContainer,t([l],e(h),!1));g=v.ramda,v.tail.length>=1&&(y=v.tail[0]),v.tail.length>=2&&(m=v.tail[1])}f(y,m),g!==null&&g()}a.construct=c})(n.IHashContainer||(n.IHashContainer={}))}(IHashContainer)),IHashContainer}var SetElementList={},ListContainer={},ListIterator={},hasRequiredListIterator;function requireListIterator(){if(hasRequiredListIterator)return ListIterator;hasRequiredListIterator=1,Object.defineProperty(ListIterator,"__esModule",{value:!0}),ListIterator.ListIterator=void 0;var n=requireErrorGenerator(),e=function(){function t(r,s,o){this.prev_=r,this.next_=s,this.value_=o}return t._Set_prev=function(r,s){r.prev_=s},t._Set_next=function(r,s){r.next_=s},t.prototype.prev=function(){return this.prev_},t.prototype.next=function(){return this.next_},Object.defineProperty(t.prototype,"value",{get:function(){return this._Try_value(),this.value_},enumerable:!1,configurable:!0}),t.prototype._Try_value=function(){if(this.value_===void 0&&this.equals(this.source().end())===!0)throw n.ErrorGenerator.iterator_end_value(this.source())},t.prototype.equals=function(r){return this===r},t}();return ListIterator.ListIterator=e,ListIterator}var Repeater={},hasRequiredRepeater;function requireRepeater(){if(hasRequiredRepeater)return Repeater;hasRequiredRepeater=1,Object.defineProperty(Repeater,"__esModule",{value:!0}),Repeater.Repeater=void 0;var n=function(){function e(t,r){this.index_=t,this.value_=r}return e.prototype.index=function(){return this.index_},Object.defineProperty(e.prototype,"value",{get:function(){return this.value_},enumerable:!1,configurable:!0}),e.prototype.next=function(){return++this.index_,this},e.prototype.equals=function(t){return this.index_===t.index_},e}();return Repeater.Repeater=n,Repeater}var global={},hasRequiredGlobal;function requireGlobal(){if(hasRequiredGlobal)return global;hasRequiredGlobal=1,Object.defineProperty(global,"__esModule",{value:!0}),global.next=global.prev=global.advance=global.distance=global.size=global.empty=void 0;var n=requireInvalidArgument();function e(l){return l instanceof Array?l.length!==0:l.empty()}global.empty=e;function t(l){return l instanceof Array?l.length:l.size()}global.size=t;function r(l,u){if(l.index instanceof Function)return s(l,u);for(var f=0;!l.equals(u);l=l.next())++f;return f}global.distance=r;function s(l,u){var f=l.index(),h=u.index();return l.base instanceof Function?f-h:h-f}function o(l,u){if(u===0)return l;if(l.advance instanceof Function)return l.advance(u);var f;if(u<0){if(!(l.prev instanceof Function))throw new n.InvalidArgument("Error on std.advance(): parametric iterator is not a bi-directional iterator, thus advancing to negative direction is not possible.");f=function(h){return h.prev()},u=-u}else f=function(h){return h.next()};for(;u-- >0;)l=f(l);return l}global.advance=o;function a(l,u){return u===void 0&&(u=1),u===1?l.prev():o(l,-u)}global.prev=a;function c(l,u){return u===void 0&&(u=1),u===1?l.next():o(l,u)}return global.next=c,global}var hasRequiredListContainer;function requireListContainer(){if(hasRequiredListContainer)return ListContainer;hasRequiredListContainer=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var u=function(f,h){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,g){p.__proto__=g}||function(p,g){for(var y in g)Object.prototype.hasOwnProperty.call(g,y)&&(p[y]=g[y])},u(f,h)};return function(f,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");u(f,h);function p(){this.constructor=f}f.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}}(),e=commonjsGlobal&&commonjsGlobal.__read||function(u,f){var h=typeof Symbol=="function"&&u[Symbol.iterator];if(!h)return u;var p=h.call(u),g,y=[],m;try{for(;(f===void 0||f-- >0)&&!(g=p.next()).done;)y.push(g.value)}catch(b){m={error:b}}finally{try{g&&!g.done&&(h=p.return)&&h.call(p)}finally{if(m)throw m.error}}return y};Object.defineProperty(ListContainer,"__esModule",{value:!0}),ListContainer.ListContainer=void 0;var t=requireContainer(),r=requireListIterator(),s=requireRepeater(),o=requireNativeArrayIterator(),a=requireGlobal(),c=requireErrorGenerator(),l=function(u){n(f,u);function f(){var h=u.call(this)||this;return h.end_=h._Create_iterator(null,null),h.clear(),h}return f.prototype.assign=function(h,p){this.clear(),this.insert(this.end(),h,p)},f.prototype.clear=function(){r.ListIterator._Set_prev(this.end_,this.end_),r.ListIterator._Set_next(this.end_,this.end_),this.begin_=this.end_,this.size_=0},f.prototype.resize=function(h){var p=h-this.size();p>0?this.insert(this.end(),p,void 0):p<0&&this.erase((0,a.advance)(this.end(),-p),this.end())},f.prototype.begin=function(){return this.begin_},f.prototype.end=function(){return this.end_},f.prototype.size=function(){return this.size_},f.prototype.push_front=function(h){this.insert(this.begin_,h)},f.prototype.push_back=function(h){this.insert(this.end_,h)},f.prototype.pop_front=function(){if(this.empty()===!0)throw c.ErrorGenerator.empty(this.end_.source().constructor.name,"pop_front");this.erase(this.begin_)},f.prototype.pop_back=function(){if(this.empty()===!0)throw c.ErrorGenerator.empty(this.end_.source().constructor.name,"pop_back");this.erase(this.end_.prev())},f.prototype.push=function(){for(var h=[],p=0;p<arguments.length;p++)h[p]=arguments[p];if(h.length===0)return this.size();var g=new o.NativeArrayIterator(h,0),y=new o.NativeArrayIterator(h,h.length);return this._Insert_by_range(this.end(),g,y),this.size()},f.prototype.insert=function(h){for(var p=[],g=1;g<arguments.length;g++)p[g-1]=arguments[g];if(h.source()!==this.end_.source())throw c.ErrorGenerator.not_my_iterator(this.end_.source(),"insert");if(h.erased_===!0)throw c.ErrorGenerator.erased_iterator(this.end_.source(),"insert");return p.length===1?this._Insert_by_repeating_val(h,1,p[0]):p.length===2&&typeof p[0]=="number"?this._Insert_by_repeating_val(h,p[0],p[1]):this._Insert_by_range(h,p[0],p[1])},f.prototype._Insert_by_repeating_val=function(h,p,g){var y=new s.Repeater(0,g),m=new s.Repeater(p);return this._Insert_by_range(h,y,m)},f.prototype._Insert_by_range=function(h,p,g){for(var y=h.prev(),m=null,b=0,v=p;v.equals(g)===!1;v=v.next()){var $=this._Create_iterator(y,null,v.value);b===0&&(m=$),r.ListIterator._Set_next(y,$),y=$,++b}return h.equals(this.begin())===!0&&(this.begin_=m),r.ListIterator._Set_next(y,h),r.ListIterator._Set_prev(h,y),this.size_+=b,m},f.prototype.erase=function(h,p){return p===void 0&&(p=h.next()),this._Erase_by_range(h,p)},f.prototype._Erase_by_range=function(h,p){if(h.source()!==this.end_.source())throw c.ErrorGenerator.not_my_iterator(this.end_.source(),"insert");if(h.erased_===!0)throw c.ErrorGenerator.erased_iterator(this.end_.source(),"insert");if(h.equals(this.end_))return this.end_;var g=h.prev();r.ListIterator._Set_next(g,p),r.ListIterator._Set_prev(p,g);for(var y=h;!y.equals(p);y=y.next())y.erased_=!0,--this.size_;return h.equals(this.begin_)&&(this.begin_=p),p},f.prototype.swap=function(h){var p,g,y;p=e([h.begin_,this.begin_],2),this.begin_=p[0],h.begin_=p[1],g=e([h.end_,this.end_],2),this.end_=g[0],h.end_=g[1],y=e([h.size_,this.size_],2),this.size_=y[0],h.size_=y[1]},f}(t.Container);return ListContainer.ListContainer=l,ListContainer}var ReverseIterator={},hasRequiredReverseIterator;function requireReverseIterator(){if(hasRequiredReverseIterator)return ReverseIterator;hasRequiredReverseIterator=1,Object.defineProperty(ReverseIterator,"__esModule",{value:!0}),ReverseIterator.ReverseIterator=void 0;var n=function(){function e(t){this.base_=t.prev()}return e.prototype.source=function(){return this.base_.source()},e.prototype.base=function(){return this.base_.next()},Object.defineProperty(e.prototype,"value",{get:function(){return this.base_.value},enumerable:!1,configurable:!0}),e.prototype.prev=function(){return this._Create_neighbor(this.base().next())},e.prototype.next=function(){return this._Create_neighbor(this.base_)},e.prototype.equals=function(t){return this.base_.equals(t.base_)},e}();return ReverseIterator.ReverseIterator=n,ReverseIterator}var hasRequiredSetElementList;function requireSetElementList(){return hasRequiredSetElementList||(hasRequiredSetElementList=1,function(n){var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var c=function(l,u){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(f[p]=h[p])},c(l,u)};return function(l,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");c(l,u);function f(){this.constructor=l}l.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)}}(),t=commonjsGlobal&&commonjsGlobal.__read||function(c,l){var u=typeof Symbol=="function"&&c[Symbol.iterator];if(!u)return c;var f=u.call(c),h,p=[],g;try{for(;(l===void 0||l-- >0)&&!(h=f.next()).done;)p.push(h.value)}catch(y){g={error:y}}finally{try{h&&!h.done&&(u=f.return)&&u.call(f)}finally{if(g)throw g.error}}return p};Object.defineProperty(n,"__esModule",{value:!0}),n.SetElementList=void 0;var r=requireListContainer(),s=requireListIterator(),o=requireReverseIterator(),a=function(c){e(l,c);function l(u){var f=c.call(this)||this;return f.associative_=u,f}return l.prototype._Create_iterator=function(u,f,h){return l.Iterator.create(this,u,f,h)},l._Swap_associative=function(u,f){var h;h=t([f.associative_,u.associative_],2),u.associative_=h[0],f.associative_=h[1]},l.prototype.associative=function(){return this.associative_},l}(r.ListContainer);n.SetElementList=a,function(c){var l=function(f){e(h,f);function h(p,g,y,m){var b=f.call(this,g,y,m)||this;return b.source_=p,b}return h.create=function(p,g,y,m){return new h(p,g,y,m)},h.prototype.reverse=function(){return new u(this)},h.prototype.source=function(){return this.source_.associative()},h}(s.ListIterator);c.Iterator=l;var u=function(f){e(h,f);function h(){return f!==null&&f.apply(this,arguments)||this}return h.prototype._Create_neighbor=function(p){return new h(p)},h}(o.ReverseIterator);c.ReverseIterator=u}(a=n.SetElementList||(n.SetElementList={})),n.SetElementList=a}(SetElementList)),SetElementList}var SetHashBuckets={},HashBuckets={},hasRequiredHashBuckets;function requireHashBuckets(){if(hasRequiredHashBuckets)return HashBuckets;hasRequiredHashBuckets=1;var n=commonjsGlobal&&commonjsGlobal.__values||function(s){var o=typeof Symbol=="function"&&Symbol.iterator,a=o&&s[o],c=0;if(a)return a.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&c>=s.length&&(s=void 0),{value:s&&s[c++],done:!s}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(HashBuckets,"__esModule",{value:!0}),HashBuckets.HashBuckets=void 0;var e=function(){function s(o,a){this.fetcher_=o,this.hasher_=a,this.max_load_factor_=r,this.data_=[],this.size_=0,this.initialize()}return s.prototype.clear=function(){this.data_=[],this.size_=0,this.initialize()},s.prototype.rehash=function(o){var a,c,l,u;o=Math.max(o,t);for(var f=[],h=0;h<o;++h)f.push([]);try{for(var p=n(this.data_),g=p.next();!g.done;g=p.next()){var y=g.value;try{for(var m=(l=void 0,n(y)),b=m.next();!b.done;b=m.next()){var v=b.value,$=this.hasher_(this.fetcher_(v))%f.length;f[$].push(v)}}catch(I){l={error:I}}finally{try{b&&!b.done&&(u=m.return)&&u.call(m)}finally{if(l)throw l.error}}}}catch(I){a={error:I}}finally{try{g&&!g.done&&(c=p.return)&&c.call(p)}finally{if(a)throw a.error}}this.data_=f},s.prototype.reserve=function(o){o>this.capacity()&&(o=Math.floor(o/this.max_load_factor_),this.rehash(o))},s.prototype.initialize=function(){for(var o=0;o<t;++o)this.data_.push([])},s.prototype.length=function(){return this.data_.length},s.prototype.capacity=function(){return this.data_.length*this.max_load_factor_},s.prototype.at=function(o){return this.data_[o]},s.prototype.load_factor=function(){return this.size_/this.length()},s.prototype.max_load_factor=function(o){if(o===void 0&&(o=null),o===null)return this.max_load_factor_;this.max_load_factor_=o},s.prototype.hash_function=function(){return this.hasher_},s.prototype.index=function(o){return this.hasher_(this.fetcher_(o))%this.length()},s.prototype.insert=function(o){var a=this.capacity();++this.size_>a&&this.reserve(a*2);var c=this.index(o);this.data_[c].push(o)},s.prototype.erase=function(o){for(var a=this.index(o),c=this.data_[a],l=0;l<c.length;++l)if(c[l]===o){c.splice(l,1),--this.size_;break}},s}();HashBuckets.HashBuckets=e;var t=10,r=1;return HashBuckets}var hasRequiredSetHashBuckets;function requireSetHashBuckets(){if(hasRequiredSetHashBuckets)return SetHashBuckets;hasRequiredSetHashBuckets=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var a=function(c,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var h in f)Object.prototype.hasOwnProperty.call(f,h)&&(u[h]=f[h])},a(c,l)};return function(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");a(c,l);function u(){this.constructor=c}c.prototype=l===null?Object.create(l):(u.prototype=l.prototype,new u)}}(),e=commonjsGlobal&&commonjsGlobal.__read||function(a,c){var l=typeof Symbol=="function"&&a[Symbol.iterator];if(!l)return a;var u=l.call(a),f,h=[],p;try{for(;(c===void 0||c-- >0)&&!(f=u.next()).done;)h.push(f.value)}catch(g){p={error:g}}finally{try{f&&!f.done&&(l=u.return)&&l.call(u)}finally{if(p)throw p.error}}return h},t=commonjsGlobal&&commonjsGlobal.__values||function(a){var c=typeof Symbol=="function"&&Symbol.iterator,l=c&&a[c],u=0;if(l)return l.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&u>=a.length&&(a=void 0),{value:a&&a[u++],done:!a}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(SetHashBuckets,"__esModule",{value:!0}),SetHashBuckets.SetHashBuckets=void 0;var r=requireHashBuckets(),s=function(a){n(c,a);function c(l,u,f){var h=a.call(this,o,u)||this;return h.source_=l,h.key_eq_=f,h}return c._Swap_source=function(l,u){var f;f=e([u.source_,l.source_],2),l.source_=f[0],u.source_=f[1]},c.prototype.key_eq=function(){return this.key_eq_},c.prototype.find=function(l){var u,f,h=this.hash_function()(l)%this.length(),p=this.at(h);try{for(var g=t(p),y=g.next();!y.done;y=g.next()){var m=y.value;if(this.key_eq_(m.value,l))return m}}catch(b){u={error:b}}finally{try{y&&!y.done&&(f=g.return)&&f.call(g)}finally{if(u)throw u.error}}return this.source_.end()},c}(r.HashBuckets);SetHashBuckets.SetHashBuckets=s;function o(a){return a.value}return SetHashBuckets}var Pair={},hasRequiredPair;function requirePair(){if(hasRequiredPair)return Pair;hasRequiredPair=1,Object.defineProperty(Pair,"__esModule",{value:!0}),Pair.make_pair=Pair.Pair=void 0;var n=requireHash(),e=requireComparators(),t=function(){function s(o,a){this.first=o,this.second=a}return s.prototype.equals=function(o){return(0,e.equal_to)(this.first,o.first)&&(0,e.equal_to)(this.second,o.second)},s.prototype.less=function(o){return(0,e.equal_to)(this.first,o.first)===!1?(0,e.less)(this.first,o.first):(0,e.less)(this.second,o.second)},s.prototype.hashCode=function(){return(0,n.hash)(this.first,this.second)},s}();Pair.Pair=t;function r(s,o){return new t(s,o)}return Pair.make_pair=r,Pair}var hasRequiredHashSet;function requireHashSet(){return hasRequiredHashSet||(hasRequiredHashSet=1,function(n){var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var f=function(h,p){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,y){g.__proto__=y}||function(g,y){for(var m in y)Object.prototype.hasOwnProperty.call(y,m)&&(g[m]=y[m])},f(h,p)};return function(h,p){if(typeof p!="function"&&p!==null)throw new TypeError("Class extends value "+String(p)+" is not a constructor or null");f(h,p);function g(){this.constructor=h}h.prototype=p===null?Object.create(p):(g.prototype=p.prototype,new g)}}(),t=commonjsGlobal&&commonjsGlobal.__read||function(f,h){var p=typeof Symbol=="function"&&f[Symbol.iterator];if(!p)return f;var g=p.call(f),y,m=[],b;try{for(;(h===void 0||h-- >0)&&!(y=g.next()).done;)m.push(y.value)}catch(v){b={error:v}}finally{try{y&&!y.done&&(p=g.return)&&p.call(g)}finally{if(b)throw b.error}}return m},r=commonjsGlobal&&commonjsGlobal.__spreadArray||function(f,h,p){if(p||arguments.length===2)for(var g=0,y=h.length,m;g<y;g++)(m||!(g in h))&&(m||(m=Array.prototype.slice.call(h,0,g)),m[g]=h[g]);return f.concat(m||Array.prototype.slice.call(h))};Object.defineProperty(n,"__esModule",{value:!0}),n.HashSet=void 0;var s=requireUniqueSet(),o=requireIHashContainer(),a=requireSetElementList(),c=requireSetHashBuckets(),l=requirePair(),u=function(f){e(h,f);function h(){for(var p=[],g=0;g<arguments.length;g++)p[g]=arguments[g];var y=f.call(this,function(m){return new a.SetElementList(m)})||this;return o.IHashContainer.construct.apply(o.IHashContainer,r([y,h,function(m,b){y.buckets_=new c.SetHashBuckets(y,m,b)}],t(p),!1)),y}return h.prototype.clear=function(){this.buckets_.clear(),f.prototype.clear.call(this)},h.prototype.swap=function(p){var g,y;g=t([p.data_,this.data_],2),this.data_=g[0],p.data_=g[1],a.SetElementList._Swap_associative(this.data_,p.data_),c.SetHashBuckets._Swap_source(this.buckets_,p.buckets_),y=t([p.buckets_,this.buckets_],2),this.buckets_=y[0],p.buckets_=y[1]},h.prototype.find=function(p){return this.buckets_.find(p)},h.prototype.begin=function(p){return p===void 0&&(p=null),p===null?f.prototype.begin.call(this):this.buckets_.at(p)[0]},h.prototype.end=function(p){if(p===void 0&&(p=null),p===null)return f.prototype.end.call(this);var g=this.buckets_.at(p);return g[g.length-1].next()},h.prototype.rbegin=function(p){return p===void 0&&(p=null),this.end(p).reverse()},h.prototype.rend=function(p){return p===void 0&&(p=null),this.begin(p).reverse()},h.prototype.bucket_count=function(){return this.buckets_.length()},h.prototype.bucket_size=function(p){return this.buckets_.at(p).length},h.prototype.load_factor=function(){return this.buckets_.load_factor()},h.prototype.hash_function=function(){return this.buckets_.hash_function()},h.prototype.key_eq=function(){return this.buckets_.key_eq()},h.prototype.bucket=function(p){return this.hash_function()(p)%this.buckets_.length()},h.prototype.max_load_factor=function(p){return p===void 0&&(p=null),this.buckets_.max_load_factor(p)},h.prototype.reserve=function(p){this.buckets_.reserve(p)},h.prototype.rehash=function(p){this.buckets_.rehash(p)},h.prototype._Insert_by_key=function(p){var g=this.find(p);return g.equals(this.end())===!1?new l.Pair(g,!1):(this.data_.push(p),g=g.prev(),this._Handle_insert(g,g.next()),new l.Pair(g,!0))},h.prototype._Insert_by_hint=function(p,g){var y=this.find(g);return y.equals(this.end())===!0&&(y=this.data_.insert(p,g),this._Handle_insert(y,y.next())),y},h.prototype._Handle_insert=function(p,g){for(;!p.equals(g);p=p.next())this.buckets_.insert(p)},h.prototype._Handle_erase=function(p,g){for(;!p.equals(g);p=p.next())this.buckets_.erase(p)},h}(s.UniqueSet);n.HashSet=u,function(f){f.Iterator=a.SetElementList.Iterator,f.ReverseIterator=a.SetElementList.ReverseIterator}(u=n.HashSet||(n.HashSet={})),n.HashSet=u}(HashSet)),HashSet}var HashMap={},UniqueMap={},MapContainer={},hasRequiredMapContainer;function requireMapContainer(){if(hasRequiredMapContainer)return MapContainer;hasRequiredMapContainer=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var s=function(o,a){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,l){c.__proto__=l}||function(c,l){for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(c[u]=l[u])},s(o,a)};return function(o,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");s(o,a);function c(){this.constructor=o}o.prototype=a===null?Object.create(a):(c.prototype=a.prototype,new c)}}();Object.defineProperty(MapContainer,"__esModule",{value:!0}),MapContainer.MapContainer=void 0;var e=requireContainer(),t=requireNativeArrayIterator(),r=function(s){n(o,s);function o(a){var c=s.call(this)||this;return c.data_=a(c),c}return o.prototype.assign=function(a,c){this.clear(),this.insert(a,c)},o.prototype.clear=function(){this.data_.clear()},o.prototype.begin=function(){return this.data_.begin()},o.prototype.end=function(){return this.data_.end()},o.prototype.has=function(a){return!this.find(a).equals(this.end())},o.prototype.size=function(){return this.data_.size()},o.prototype.push=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];var l=new t.NativeArrayIterator(a,0),u=new t.NativeArrayIterator(a,a.length);return this.insert(l,u),this.size()},o.prototype.insert=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];return a.length===1?this.emplace(a[0].first,a[0].second):a[0].next instanceof Function&&a[1].next instanceof Function?this._Insert_by_range(a[0],a[1]):this.emplace_hint(a[0],a[1].first,a[1].second)},o.prototype.erase=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];return a.length===1&&(!(a[0]instanceof this.end().constructor)||a[0].source()!==this)?this._Erase_by_key(a[0]):a.length===1?this._Erase_by_range(a[0]):this._Erase_by_range(a[0],a[1])},o.prototype._Erase_by_range=function(a,c){c===void 0&&(c=a.next());var l=this.data_.erase(a,c);return this._Handle_erase(a,c),l},o}(e.Container);return MapContainer.MapContainer=r,MapContainer}var hasRequiredUniqueMap;function requireUniqueMap(){if(hasRequiredUniqueMap)return UniqueMap;hasRequiredUniqueMap=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var a=function(c,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var h in f)Object.prototype.hasOwnProperty.call(f,h)&&(u[h]=f[h])},a(c,l)};return function(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");a(c,l);function u(){this.constructor=c}c.prototype=l===null?Object.create(l):(u.prototype=l.prototype,new u)}}(),e=commonjsGlobal&&commonjsGlobal.__read||function(a,c){var l=typeof Symbol=="function"&&a[Symbol.iterator];if(!l)return a;var u=l.call(a),f,h=[],p;try{for(;(c===void 0||c-- >0)&&!(f=u.next()).done;)h.push(f.value)}catch(g){p={error:g}}finally{try{f&&!f.done&&(l=u.return)&&l.call(u)}finally{if(p)throw p.error}}return h},t=commonjsGlobal&&commonjsGlobal.__spreadArray||function(a,c,l){if(l||arguments.length===2)for(var u=0,f=c.length,h;u<f;u++)(h||!(u in c))&&(h||(h=Array.prototype.slice.call(c,0,u)),h[u]=c[u]);return a.concat(h||Array.prototype.slice.call(c))};Object.defineProperty(UniqueMap,"__esModule",{value:!0}),UniqueMap.UniqueMap=void 0;var r=requireMapContainer(),s=requireErrorGenerator(),o=function(a){n(c,a);function c(){return a!==null&&a.apply(this,arguments)||this}return c.prototype.count=function(l){return this.find(l).equals(this.end())?0:1},c.prototype.get=function(l){var u=this.find(l);if(u.equals(this.end())===!0)throw s.ErrorGenerator.key_nout_found(this,"get",l);return u.second},c.prototype.take=function(l,u){var f=this.find(l);return f.equals(this.end())?this.emplace(l,u()).first.second:f.second},c.prototype.set=function(l,u){this.insert_or_assign(l,u)},c.prototype.insert=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];return a.prototype.insert.apply(this,t([],e(l),!1))},c.prototype._Insert_by_range=function(l,u){for(var f=l;!f.equals(u);f=f.next())this.emplace(f.value.first,f.value.second)},c.prototype.insert_or_assign=function(){for(var l=[],u=0;u<arguments.length;u++)l[u]=arguments[u];if(l.length===2)return this._Insert_or_assign_with_key_value(l[0],l[1]);if(l.length===3)return this._Insert_or_assign_with_hint(l[0],l[1],l[2])},c.prototype._Insert_or_assign_with_key_value=function(l,u){var f=this.emplace(l,u);return f.second===!1&&(f.first.second=u),f},c.prototype._Insert_or_assign_with_hint=function(l,u,f){var h=this.emplace_hint(l,u,f);return h.second!==f&&(h.second=f),h},c.prototype.extract=function(l){return l instanceof this.end().constructor?this._Extract_by_iterator(l):this._Extract_by_key(l)},c.prototype._Extract_by_key=function(l){var u=this.find(l);if(u.equals(this.end())===!0)throw s.ErrorGenerator.key_nout_found(this,"extract",l);var f=u.value;return this._Erase_by_range(u),f},c.prototype._Extract_by_iterator=function(l){return l.equals(this.end())===!0?this.end():(this._Erase_by_range(l),l)},c.prototype._Erase_by_key=function(l){var u=this.find(l);return u.equals(this.end())===!0?0:(this._Erase_by_range(u),1)},c.prototype.merge=function(l){for(var u=l.begin();!u.equals(l.end());)this.has(u.first)===!1?(this.insert(u.value),u=l.erase(u)):u=u.next()},c}(r.MapContainer);return UniqueMap.UniqueMap=o,UniqueMap}var MapElementList={},hasRequiredMapElementList;function requireMapElementList(){return hasRequiredMapElementList||(hasRequiredMapElementList=1,function(n){var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var c=function(l,u){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(f,h){f.__proto__=h}||function(f,h){for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(f[p]=h[p])},c(l,u)};return function(l,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");c(l,u);function f(){this.constructor=l}l.prototype=u===null?Object.create(u):(f.prototype=u.prototype,new f)}}(),t=commonjsGlobal&&commonjsGlobal.__read||function(c,l){var u=typeof Symbol=="function"&&c[Symbol.iterator];if(!u)return c;var f=u.call(c),h,p=[],g;try{for(;(l===void 0||l-- >0)&&!(h=f.next()).done;)p.push(h.value)}catch(y){g={error:y}}finally{try{h&&!h.done&&(u=f.return)&&u.call(f)}finally{if(g)throw g.error}}return p};Object.defineProperty(n,"__esModule",{value:!0}),n.MapElementList=void 0;var r=requireListContainer(),s=requireListIterator(),o=requireReverseIterator(),a=function(c){e(l,c);function l(u){var f=c.call(this)||this;return f.associative_=u,f}return l.prototype._Create_iterator=function(u,f,h){return l.Iterator.create(this,u,f,h)},l._Swap_associative=function(u,f){var h;h=t([f.associative_,u.associative_],2),u.associative_=h[0],f.associative_=h[1]},l.prototype.associative=function(){return this.associative_},l}(r.ListContainer);n.MapElementList=a,function(c){var l=function(f){e(h,f);function h(p,g,y,m){var b=f.call(this,g,y,m)||this;return b.list_=p,b}return h.create=function(p,g,y,m){return new h(p,g,y,m)},h.prototype.reverse=function(){return new u(this)},h.prototype.source=function(){return this.list_.associative()},Object.defineProperty(h.prototype,"first",{get:function(){return this.value.first},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"second",{get:function(){return this.value.second},set:function(p){this.value.second=p},enumerable:!1,configurable:!0}),h}(s.ListIterator);c.Iterator=l;var u=function(f){e(h,f);function h(){return f!==null&&f.apply(this,arguments)||this}return h.prototype._Create_neighbor=function(p){return new h(p)},Object.defineProperty(h.prototype,"first",{get:function(){return this.base_.first},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"second",{get:function(){return this.base_.second},set:function(p){this.base_.second=p},enumerable:!1,configurable:!0}),h}(o.ReverseIterator);c.ReverseIterator=u}(a=n.MapElementList||(n.MapElementList={})),n.MapElementList=a}(MapElementList)),MapElementList}var MapHashBuckets={},hasRequiredMapHashBuckets;function requireMapHashBuckets(){if(hasRequiredMapHashBuckets)return MapHashBuckets;hasRequiredMapHashBuckets=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var a=function(c,l){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,f){u.__proto__=f}||function(u,f){for(var h in f)Object.prototype.hasOwnProperty.call(f,h)&&(u[h]=f[h])},a(c,l)};return function(c,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");a(c,l);function u(){this.constructor=c}c.prototype=l===null?Object.create(l):(u.prototype=l.prototype,new u)}}(),e=commonjsGlobal&&commonjsGlobal.__read||function(a,c){var l=typeof Symbol=="function"&&a[Symbol.iterator];if(!l)return a;var u=l.call(a),f,h=[],p;try{for(;(c===void 0||c-- >0)&&!(f=u.next()).done;)h.push(f.value)}catch(g){p={error:g}}finally{try{f&&!f.done&&(l=u.return)&&l.call(u)}finally{if(p)throw p.error}}return h},t=commonjsGlobal&&commonjsGlobal.__values||function(a){var c=typeof Symbol=="function"&&Symbol.iterator,l=c&&a[c],u=0;if(l)return l.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&u>=a.length&&(a=void 0),{value:a&&a[u++],done:!a}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(MapHashBuckets,"__esModule",{value:!0}),MapHashBuckets.MapHashBuckets=void 0;var r=requireHashBuckets(),s=function(a){n(c,a);function c(l,u,f){var h=a.call(this,o,u)||this;return h.source_=l,h.key_eq_=f,h}return c._Swap_source=function(l,u){var f;f=e([u.source_,l.source_],2),l.source_=f[0],u.source_=f[1]},c.prototype.key_eq=function(){return this.key_eq_},c.prototype.find=function(l){var u,f,h=this.hash_function()(l)%this.length(),p=this.at(h);try{for(var g=t(p),y=g.next();!y.done;y=g.next()){var m=y.value;if(this.key_eq_(m.first,l))return m}}catch(b){u={error:b}}finally{try{y&&!y.done&&(f=g.return)&&f.call(g)}finally{if(u)throw u.error}}return this.source_.end()},c}(r.HashBuckets);MapHashBuckets.MapHashBuckets=s;function o(a){return a.first}return MapHashBuckets}var Entry={},hasRequiredEntry;function requireEntry(){if(hasRequiredEntry)return Entry;hasRequiredEntry=1,Object.defineProperty(Entry,"__esModule",{value:!0}),Entry.Entry=void 0;var n=requireHash(),e=requireComparators(),t=function(){function r(s,o){this.first=s,this.second=o}return r.prototype.equals=function(s){return(0,e.equal_to)(this.first,s.first)},r.prototype.less=function(s){return(0,e.less)(this.first,s.first)},r.prototype.hashCode=function(){return(0,n.hash)(this.first)},r}();return Entry.Entry=t,Entry}var hasRequiredHashMap;function requireHashMap(){return hasRequiredHashMap||(hasRequiredHashMap=1,function(n){var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var h=function(p,g){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,m){y.__proto__=m}||function(y,m){for(var b in m)Object.prototype.hasOwnProperty.call(m,b)&&(y[b]=m[b])},h(p,g)};return function(p,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");h(p,g);function y(){this.constructor=p}p.prototype=g===null?Object.create(g):(y.prototype=g.prototype,new y)}}(),t=commonjsGlobal&&commonjsGlobal.__read||function(h,p){var g=typeof Symbol=="function"&&h[Symbol.iterator];if(!g)return h;var y=g.call(h),m,b=[],v;try{for(;(p===void 0||p-- >0)&&!(m=y.next()).done;)b.push(m.value)}catch($){v={error:$}}finally{try{m&&!m.done&&(g=y.return)&&g.call(y)}finally{if(v)throw v.error}}return b},r=commonjsGlobal&&commonjsGlobal.__spreadArray||function(h,p,g){if(g||arguments.length===2)for(var y=0,m=p.length,b;y<m;y++)(b||!(y in p))&&(b||(b=Array.prototype.slice.call(p,0,y)),b[y]=p[y]);return h.concat(b||Array.prototype.slice.call(p))};Object.defineProperty(n,"__esModule",{value:!0}),n.HashMap=void 0;var s=requireUniqueMap(),o=requireIHashContainer(),a=requireMapElementList(),c=requireMapHashBuckets(),l=requireEntry(),u=requirePair(),f=function(h){e(p,h);function p(){for(var g=[],y=0;y<arguments.length;y++)g[y]=arguments[y];var m=h.call(this,function(b){return new a.MapElementList(b)})||this;return o.IHashContainer.construct.apply(o.IHashContainer,r([m,p,function(b,v){m.buckets_=new c.MapHashBuckets(m,b,v)}],t(g),!1)),m}return p.prototype.clear=function(){this.buckets_.clear(),h.prototype.clear.call(this)},p.prototype.swap=function(g){var y,m;y=t([g.data_,this.data_],2),this.data_=y[0],g.data_=y[1],a.MapElementList._Swap_associative(this.data_,g.data_),c.MapHashBuckets._Swap_source(this.buckets_,g.buckets_),m=t([g.buckets_,this.buckets_],2),this.buckets_=m[0],g.buckets_=m[1]},p.prototype.find=function(g){return this.buckets_.find(g)},p.prototype.begin=function(g){return g===void 0&&(g=null),g===null?h.prototype.begin.call(this):this.buckets_.at(g)[0]},p.prototype.end=function(g){if(g===void 0&&(g=null),g===null)return h.prototype.end.call(this);var y=this.buckets_.at(g);return y[y.length-1].next()},p.prototype.rbegin=function(g){return g===void 0&&(g=null),this.end(g).reverse()},p.prototype.rend=function(g){return g===void 0&&(g=null),this.begin(g).reverse()},p.prototype.bucket_count=function(){return this.buckets_.length()},p.prototype.bucket_size=function(g){return this.buckets_.at(g).length},p.prototype.load_factor=function(){return this.buckets_.load_factor()},p.prototype.hash_function=function(){return this.buckets_.hash_function()},p.prototype.key_eq=function(){return this.buckets_.key_eq()},p.prototype.bucket=function(g){return this.hash_function()(g)%this.buckets_.length()},p.prototype.max_load_factor=function(g){return g===void 0&&(g=null),this.buckets_.max_load_factor(g)},p.prototype.reserve=function(g){this.buckets_.reserve(g)},p.prototype.rehash=function(g){this.buckets_.rehash(g)},p.prototype.emplace=function(g,y){var m=this.find(g);return m.equals(this.end())===!1?new u.Pair(m,!1):(this.data_.push(new l.Entry(g,y)),m=m.prev(),this._Handle_insert(m,m.next()),new u.Pair(m,!0))},p.prototype.emplace_hint=function(g,y,m){var b=this.find(y);return b.equals(this.end())===!0&&(b=this.data_.insert(g,new l.Entry(y,m)),this._Handle_insert(b,b.next())),b},p.prototype._Handle_insert=function(g,y){for(;!g.equals(y);g=g.next())this.buckets_.insert(g)},p.prototype._Handle_erase=function(g,y){for(;!g.equals(y);g=g.next())this.buckets_.erase(g)},p}(s.UniqueMap);n.HashMap=f,function(h){h.Iterator=a.MapElementList.Iterator,h.ReverseIterator=a.MapElementList.ReverseIterator}(f=n.HashMap||(n.HashMap={})),n.HashMap=f}(HashMap)),HashMap}var hasRequiredEventTarget;function requireEventTarget(){if(hasRequiredEventTarget)return EventTarget;hasRequiredEventTarget=1;var n=commonjsGlobal&&commonjsGlobal.__values||function(s){var o=typeof Symbol=="function"&&s[Symbol.iterator],a=0;return o?o.call(s):{next:function(){return s&&a>=s.length&&(s=void 0),{value:s&&s[a++],done:!s}}}};Object.defineProperty(EventTarget,"__esModule",{value:!0});var e=requireHashSet(),t=requireHashMap(),r=function(){function s(){this.listeners_=new t.HashMap,this.created_at_=new Date}return s.prototype.dispatchEvent=function(o){var a,c,l=this.listeners_.find(o.type);if(!l.equals(this.listeners_.end())){o.target=this,o.timeStamp=new Date().getTime()-this.created_at_.getTime();try{for(var u=n(l.second),f=u.next();!f.done;f=u.next()){var h=f.value;h(o)}}catch(p){a={error:p}}finally{try{f&&!f.done&&(c=u.return)&&c.call(u)}finally{if(a)throw a.error}}}},s.prototype.addEventListener=function(o,a){var c=this.listeners_.find(o);c.equals(this.listeners_.end())&&(c=this.listeners_.emplace(o,new e.HashSet).first),c.second.insert(a)},s.prototype.removeEventListener=function(o,a){var c=this.listeners_.find(o);c.equals(this.listeners_.end())||(c.second.erase(a),c.second.empty()&&this.listeners_.erase(c))},s}();return EventTarget.EventTarget=r,EventTarget}var Event={},hasRequiredEvent;function requireEvent(){if(hasRequiredEvent)return Event;hasRequiredEvent=1,Object.defineProperty(Event,"__esModule",{value:!0});var n=function(){function e(t,r){this.type=t,r&&Object.assign(this,r)}return e}();return Event.Event=n,Event}var CloseEvent={},hasRequiredCloseEvent;function requireCloseEvent(){if(hasRequiredCloseEvent)return CloseEvent;hasRequiredCloseEvent=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(s,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var l in c)c.hasOwnProperty(l)&&(a[l]=c[l])},r(s,o)};return function(s,o){r(s,o);function a(){this.constructor=s}s.prototype=o===null?Object.create(o):(a.prototype=o.prototype,new a)}}();Object.defineProperty(CloseEvent,"__esModule",{value:!0});var e=requireEvent(),t=function(r){n(s,r);function s(o,a){return r.call(this,o,a)||this}return s}(e.Event);return CloseEvent.CloseEvent=t,CloseEvent}var MessageEvent={},hasRequiredMessageEvent;function requireMessageEvent(){if(hasRequiredMessageEvent)return MessageEvent;hasRequiredMessageEvent=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(s,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var l in c)c.hasOwnProperty(l)&&(a[l]=c[l])},r(s,o)};return function(s,o){r(s,o);function a(){this.constructor=s}s.prototype=o===null?Object.create(o):(a.prototype=o.prototype,new a)}}();Object.defineProperty(MessageEvent,"__esModule",{value:!0});var e=requireEvent(),t=function(r){n(s,r);function s(o,a){return r.call(this,o,a)||this}return s}(e.Event);return MessageEvent.MessageEvent=t,MessageEvent}var ErrorEvent={},hasRequiredErrorEvent;function requireErrorEvent(){if(hasRequiredErrorEvent)return ErrorEvent;hasRequiredErrorEvent=1;var n=commonjsGlobal&&commonjsGlobal.__extends||function(){var r=function(s,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,c){a.__proto__=c}||function(a,c){for(var l in c)c.hasOwnProperty(l)&&(a[l]=c[l])},r(s,o)};return function(s,o){r(s,o);function a(){this.constructor=s}s.prototype=o===null?Object.create(o):(a.prototype=o.prototype,new a)}}();Object.defineProperty(ErrorEvent,"__esModule",{value:!0});var e=requireEvent(),t=function(r){n(s,r);function s(o,a){return r.call(this,o,a)||this}return s}(e.Event);return ErrorEvent.ErrorEvent=t,ErrorEvent}var hasRequiredWebSocket;function requireWebSocket(){return hasRequiredWebSocket||(hasRequiredWebSocket=1,function(n){var e=commonjsGlobal&&commonjsGlobal.__extends||function(){var h=function(p,g){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,m){y.__proto__=m}||function(y,m){for(var b in m)m.hasOwnProperty(b)&&(y[b]=m[b])},h(p,g)};return function(p,g){h(p,g);function y(){this.constructor=p}p.prototype=g===null?Object.create(g):(y.prototype=g.prototype,new y)}}(),t=commonjsGlobal&&commonjsGlobal.__assign||function(){return t=Object.assign||function(h){for(var p,g=1,y=arguments.length;g<y;g++){p=arguments[g];for(var m in p)Object.prototype.hasOwnProperty.call(p,m)&&(h[m]=p[m])}return h},t.apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});var r=requireBrowser(),s=requireEventTarget(),o=requireEvent(),a=requireCloseEvent(),c=requireMessageEvent(),l=requireErrorEvent(),u=function(h){e(p,h);function p(g,y){var m=h.call(this)||this;return m.on_={},m.state_=p.CONNECTING,m.client_=new r.client,m.client_.on("connect",m._Handle_connect.bind(m)),m.client_.on("connectFailed",m._Handle_error.bind(m)),typeof y=="string"&&(y=[y]),m.client_.connect(g,y),m}return p.prototype.close=function(g,y){this.state_=p.CLOSING,g===void 0?this.connection_.sendCloseFrame():this.connection_.sendCloseFrame(g,y,!0)},p.prototype.send=function(g){if(typeof g.valueOf()=="string")this.connection_.sendUTF(g);else{var y=void 0;g instanceof Buffer?y=g:g instanceof Blob?y=new Buffer(g,"blob"):g.buffer?y=new Buffer(g.buffer):y=new Buffer(g),this.connection_.sendBytes(y)}},Object.defineProperty(p.prototype,"url",{get:function(){return this.client_.url.href},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"protocol",{get:function(){return this.client_.protocols?this.client_.protocols[0]:""},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"extensions",{get:function(){return this.connection_&&this.connection_.extensions?this.connection_.extensions[0].name:""},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"readyState",{get:function(){return this.state_},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"bufferedAmount",{get:function(){return this.connection_.bytesWaitingToFlush},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"binaryType",{get:function(){return"arraybuffer"},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onopen",{get:function(){return this.on_.open},set:function(g){this._Set_on("open",g)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onclose",{get:function(){return this.on_.close},set:function(g){this._Set_on("close",g)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onmessage",{get:function(){return this.on_.message},set:function(g){this._Set_on("message",g)},enumerable:!0,configurable:!0}),Object.defineProperty(p.prototype,"onerror",{get:function(){return this.on_.error},set:function(g){this._Set_on("error",g)},enumerable:!0,configurable:!0}),p.prototype._Set_on=function(g,y){this.on_[g]&&this.removeEventListener(g,this.on_[g]),this.addEventListener(g,y),this.on_[g]=y},p.prototype._Handle_connect=function(g){this.connection_=g,this.state_=p.OPEN,this.connection_.on("message",this._Handle_message.bind(this)),this.connection_.on("error",this._Handle_error.bind(this)),this.connection_.on("close",this._Handle_close.bind(this));var y=new o.Event("open",f);this.dispatchEvent(y)},p.prototype._Handle_close=function(g,y){var m=new a.CloseEvent("close",t({},f,{code:g,reason:y}));this.state_=p.CLOSED,this.dispatchEvent(m)},p.prototype._Handle_message=function(g){var y=new c.MessageEvent("message",t({},f,{data:g.binaryData?g.binaryData:g.utf8Data}));this.dispatchEvent(y)},p.prototype._Handle_error=function(g){var y=new l.ErrorEvent("error",t({},f,{error:g,message:g.message}));this.state_===p.CONNECTING&&(this.state_=p.CLOSED),this.dispatchEvent(y)},p}(s.EventTarget);n.WebSocket=u,function(h){h.CONNECTING=0,h.OPEN=1,h.CLOSING=2,h.CLOSED=3}(u=n.WebSocket||(n.WebSocket={})),n.WebSocket=u;var f={bubbles:!1,cancelable:!1}}(WebSocket$1)),WebSocket$1}var node_1=node;node_1.is_node()&&(commonjsGlobal.WebSocket=requireWebSocket().WebSocket);export{Browser as B,NDKPrivateKeySigner as N,getPublicKey as a,bytesToHex$1 as b,NDK as c,NDKEvent as d,generateSecretKey as g,instance as i,nip19_exports as n,schedulerExports as s};
