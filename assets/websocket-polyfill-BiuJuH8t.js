import{c as v}from"./debug-BtKHo6Hi.js";import{r as H,a as N,n as x}from"./tstl-CBngGbWh.js";import{r as k}from"./websocket-CFkA9TXo.js";var j={},y={},P;function L(){if(P)return y;P=1;var _=v&&v.__values||function(t){var n=typeof Symbol=="function"&&t[Symbol.iterator],r=0;return n?n.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}};Object.defineProperty(y,"__esModule",{value:!0});var p=H(),l=N(),a=function(){function t(){this.listeners_=new l.HashMap,this.created_at_=new Date}return t.prototype.dispatchEvent=function(n){var r,s,c=this.listeners_.find(n.type);if(!c.equals(this.listeners_.end())){n.target=this,n.timeStamp=new Date().getTime()-this.created_at_.getTime();try{for(var d=_(c.second),h=d.next();!h.done;h=d.next()){var f=h.value;f(n)}}catch(o){r={error:o}}finally{try{h&&!h.done&&(s=d.return)&&s.call(d)}finally{if(r)throw r.error}}}},t.prototype.addEventListener=function(n,r){var s=this.listeners_.find(n);s.equals(this.listeners_.end())&&(s=this.listeners_.emplace(n,new p.HashSet).first),s.second.insert(r)},t.prototype.removeEventListener=function(n,r){var s=this.listeners_.find(n);s.equals(this.listeners_.end())||(s.second.erase(r),s.second.empty()&&this.listeners_.erase(s))},t}();return y.EventTarget=a,y}var E={},w;function m(){if(w)return E;w=1,Object.defineProperty(E,"__esModule",{value:!0});var _=function(){function p(l,a){this.type=l,a&&Object.assign(this,a)}return p}();return E.Event=_,E}var g={},C;function W(){if(C)return g;C=1;var _=v&&v.__extends||function(){var a=function(t,n){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var c in s)s.hasOwnProperty(c)&&(r[c]=s[c])},a(t,n)};return function(t,n){a(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(g,"__esModule",{value:!0});var p=m(),l=function(a){_(t,a);function t(n,r){return a.call(this,n,r)||this}return t}(p.Event);return g.CloseEvent=l,g}var b={},q;function D(){if(q)return b;q=1;var _=v&&v.__extends||function(){var a=function(t,n){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var c in s)s.hasOwnProperty(c)&&(r[c]=s[c])},a(t,n)};return function(t,n){a(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(b,"__esModule",{value:!0});var p=m(),l=function(a){_(t,a);function t(n,r){return a.call(this,n,r)||this}return t}(p.Event);return b.MessageEvent=l,b}var O={},T;function B(){if(T)return O;T=1;var _=v&&v.__extends||function(){var a=function(t,n){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var c in s)s.hasOwnProperty(c)&&(r[c]=s[c])},a(t,n)};return function(t,n){a(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(O,"__esModule",{value:!0});var p=m(),l=function(a){_(t,a);function t(n,r){return a.call(this,n,r)||this}return t}(p.Event);return O.ErrorEvent=l,O}var M;function I(){return M||(M=1,function(_){var p=v&&v.__extends||function(){var f=function(o,e){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,u){i.__proto__=u}||function(i,u){for(var S in u)u.hasOwnProperty(S)&&(i[S]=u[S])},f(o,e)};return function(o,e){f(o,e);function i(){this.constructor=o}o.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),l=v&&v.__assign||function(){return l=Object.assign||function(f){for(var o,e=1,i=arguments.length;e<i;e++){o=arguments[e];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(f[u]=o[u])}return f},l.apply(this,arguments)};Object.defineProperty(_,"__esModule",{value:!0});var a=k(),t=L(),n=m(),r=W(),s=D(),c=B(),d=function(f){p(o,f);function o(e,i){var u=f.call(this)||this;return u.on_={},u.state_=o.CONNECTING,u.client_=new a.client,u.client_.on("connect",u._Handle_connect.bind(u)),u.client_.on("connectFailed",u._Handle_error.bind(u)),typeof i=="string"&&(i=[i]),u.client_.connect(e,i),u}return o.prototype.close=function(e,i){this.state_=o.CLOSING,e===void 0?this.connection_.sendCloseFrame():this.connection_.sendCloseFrame(e,i,!0)},o.prototype.send=function(e){if(typeof e.valueOf()=="string")this.connection_.sendUTF(e);else{var i=void 0;e instanceof Buffer?i=e:e instanceof Blob?i=new Buffer(e,"blob"):e.buffer?i=new Buffer(e.buffer):i=new Buffer(e),this.connection_.sendBytes(i)}},Object.defineProperty(o.prototype,"url",{get:function(){return this.client_.url.href},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"protocol",{get:function(){return this.client_.protocols?this.client_.protocols[0]:""},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"extensions",{get:function(){return this.connection_&&this.connection_.extensions?this.connection_.extensions[0].name:""},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"readyState",{get:function(){return this.state_},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"bufferedAmount",{get:function(){return this.connection_.bytesWaitingToFlush},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"binaryType",{get:function(){return"arraybuffer"},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onopen",{get:function(){return this.on_.open},set:function(e){this._Set_on("open",e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onclose",{get:function(){return this.on_.close},set:function(e){this._Set_on("close",e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onmessage",{get:function(){return this.on_.message},set:function(e){this._Set_on("message",e)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onerror",{get:function(){return this.on_.error},set:function(e){this._Set_on("error",e)},enumerable:!0,configurable:!0}),o.prototype._Set_on=function(e,i){this.on_[e]&&this.removeEventListener(e,this.on_[e]),this.addEventListener(e,i),this.on_[e]=i},o.prototype._Handle_connect=function(e){this.connection_=e,this.state_=o.OPEN,this.connection_.on("message",this._Handle_message.bind(this)),this.connection_.on("error",this._Handle_error.bind(this)),this.connection_.on("close",this._Handle_close.bind(this));var i=new n.Event("open",h);this.dispatchEvent(i)},o.prototype._Handle_close=function(e,i){var u=new r.CloseEvent("close",l({},h,{code:e,reason:i}));this.state_=o.CLOSED,this.dispatchEvent(u)},o.prototype._Handle_message=function(e){var i=new s.MessageEvent("message",l({},h,{data:e.binaryData?e.binaryData:e.utf8Data}));this.dispatchEvent(i)},o.prototype._Handle_error=function(e){var i=new c.ErrorEvent("error",l({},h,{error:e,message:e.message}));this.state_===o.CONNECTING&&(this.state_=o.CLOSED),this.dispatchEvent(i)},o}(t.EventTarget);_.WebSocket=d,function(f){f.CONNECTING=0,f.OPEN=1,f.CLOSING=2,f.CLOSED=3}(d=_.WebSocket||(_.WebSocket={})),_.WebSocket=d;var h={bubbles:!1,cancelable:!1}}(j)),j}var G=x;G.is_node()&&(v.WebSocket=I().WebSocket);
